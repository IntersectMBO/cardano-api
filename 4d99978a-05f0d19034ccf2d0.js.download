"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[447],{7777:function(e,r,s){let l,u;s.d(r,{C5:function(){return preloadFont},xv:function(){return Text}});var h=s(9477),p=s(568),v=s(2368),m=s(4103),S=s(2934);let b=(0,p.Ch)({name:"Typr Font Parser",dependencies:[/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function(){var e,r,s;return"undefined"==typeof window&&(self.window=self),(e={},(r={parse:function(e){var s=r._bin,l=new Uint8Array(e);if("ttcf"==s.readASCII(l,0,4)){var u=4;s.readUshort(l,u),u+=2,s.readUshort(l,u),u+=2;var h=s.readUint(l,u);u+=4;for(var p=[],v=0;v<h;v++){var m=s.readUint(l,u);u+=4,p.push(r._readFont(l,m))}return p}return[r._readFont(l,0)]},_readFont:function(e,s){var l=r._bin,u=s;l.readFixed(e,s),s+=4;var h=l.readUshort(e,s);s+=2,l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2;for(var p=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],v={_data:e,_offset:u},m={},S=0;S<h;S++){var b=l.readASCII(e,s,4);s+=4,l.readUint(e,s),s+=4;var x=l.readUint(e,s);s+=4;var k=l.readUint(e,s);s+=4,m[b]={offset:x,length:k}}for(S=0;S<p.length;S++){var F=p[S];m[F]&&(v[F.trim()]=r[F.trim()].parse(e,m[F].offset,m[F].length,v))}return v},_tabOffset:function(e,s,l){for(var u=r._bin,h=u.readUshort(e,l+4),p=l+12,v=0;v<h;v++){var m=u.readASCII(e,p,4);p+=4,u.readUint(e,p),p+=4;var S=u.readUint(e,p);if(p+=4,u.readUint(e,p),p+=4,m==s)return S}return 0}})._bin={readFixed:function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<8|e[r+3])/65540},readF2dot14:function(e,s){return r._bin.readShort(e,s)/16384},readInt:function(e,s){return r._bin._view(e).getInt32(s)},readInt8:function(e,s){return r._bin._view(e).getInt8(s)},readShort:function(e,s){return r._bin._view(e).getInt16(s)},readUshort:function(e,s){return r._bin._view(e).getUint16(s)},readUshorts:function(e,s,l){for(var u=[],h=0;h<l;h++)u.push(r._bin.readUshort(e,s+2*h));return u},readUint:function(e,s){return r._bin._view(e).getUint32(s)},readUint64:function(e,s){return 4294967296*r._bin.readUint(e,s)+r._bin.readUint(e,s+4)},readASCII:function(e,r,s){for(var l="",u=0;u<s;u++)l+=String.fromCharCode(e[r+u]);return l},readUnicode:function(e,r,s){for(var l="",u=0;u<s;u++)l+=String.fromCharCode(e[r++]<<8|e[r++]);return l},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,s,l){var u=r._bin._tdec;return u&&0==s&&l==e.length?u.decode(e):r._bin.readASCII(e,s,l)},readBytes:function(e,r,s){for(var l=[],u=0;u<s;u++)l.push(e[r+u]);return l},readASCIIArray:function(e,r,s){for(var l=[],u=0;u<s;u++)l.push(String.fromCharCode(e[r+u]));return l},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},r._lctf={},r._lctf.parse=function(e,s,l,u,h){var p=r._bin,v={},m=s;p.readFixed(e,s),s+=4;var S=p.readUshort(e,s);s+=2;var b=p.readUshort(e,s);s+=2;var x=p.readUshort(e,s);return s+=2,v.scriptList=r._lctf.readScriptList(e,m+S),v.featureList=r._lctf.readFeatureList(e,m+b),v.lookupList=r._lctf.readLookupList(e,m+x,h),v},r._lctf.readLookupList=function(e,s,l){var u=r._bin,h=s,p=[],v=u.readUshort(e,s);s+=2;for(var m=0;m<v;m++){var S=u.readUshort(e,s);s+=2;var b=r._lctf.readLookupTable(e,h+S,l);p.push(b)}return p},r._lctf.readLookupTable=function(e,s,l){var u=r._bin,h=s,p={tabs:[]};p.ltype=u.readUshort(e,s),s+=2,p.flag=u.readUshort(e,s),s+=2;var v=u.readUshort(e,s);s+=2;for(var m=p.ltype,S=0;S<v;S++){var b=u.readUshort(e,s);s+=2;var x=l(e,m,h+b,p);p.tabs.push(x)}return p},r._lctf.numOfOnes=function(e){for(var r=0,s=0;s<32;s++)0!=(e>>>s&1)&&r++;return r},r._lctf.readClassDef=function(e,s){var l=r._bin,u=[],h=l.readUshort(e,s);if(s+=2,1==h){var p=l.readUshort(e,s);s+=2;var v=l.readUshort(e,s);s+=2;for(var m=0;m<v;m++)u.push(p+m),u.push(p+m),u.push(l.readUshort(e,s)),s+=2}if(2==h){var S=l.readUshort(e,s);for(s+=2,m=0;m<S;m++)u.push(l.readUshort(e,s)),s+=2,u.push(l.readUshort(e,s)),s+=2,u.push(l.readUshort(e,s)),s+=2}return u},r._lctf.getInterval=function(e,r){for(var s=0;s<e.length;s+=3){var l=e[s],u=e[s+1];if(e[s+2],l<=r&&r<=u)return s}return -1},r._lctf.readCoverage=function(e,s){var l=r._bin,u={};u.fmt=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);return s+=2,1==u.fmt&&(u.tab=l.readUshorts(e,s,h)),2==u.fmt&&(u.tab=l.readUshorts(e,s,3*h)),u},r._lctf.coverageIndex=function(e,s){var l=e.tab;if(1==e.fmt)return l.indexOf(s);if(2==e.fmt){var u=r._lctf.getInterval(l,s);if(-1!=u)return l[u+2]+(s-l[u])}return -1},r._lctf.readFeatureList=function(e,s){var l=r._bin,u=s,h=[],p=l.readUshort(e,s);s+=2;for(var v=0;v<p;v++){var m=l.readASCII(e,s,4);s+=4;var S=l.readUshort(e,s);s+=2;var b=r._lctf.readFeatureTable(e,u+S);b.tag=m.trim(),h.push(b)}return h},r._lctf.readFeatureTable=function(e,s){var l=r._bin,u=s,h={},p=l.readUshort(e,s);s+=2,p>0&&(h.featureParams=u+p);var v=l.readUshort(e,s);s+=2,h.tab=[];for(var m=0;m<v;m++)h.tab.push(l.readUshort(e,s+2*m));return h},r._lctf.readScriptList=function(e,s){var l=r._bin,u=s,h={},p=l.readUshort(e,s);s+=2;for(var v=0;v<p;v++){var m=l.readASCII(e,s,4);s+=4;var S=l.readUshort(e,s);s+=2,h[m.trim()]=r._lctf.readScriptTable(e,u+S)}return h},r._lctf.readScriptTable=function(e,s){var l=r._bin,u=s,h={},p=l.readUshort(e,s);s+=2,p>0&&(h.default=r._lctf.readLangSysTable(e,u+p));var v=l.readUshort(e,s);s+=2;for(var m=0;m<v;m++){var S=l.readASCII(e,s,4);s+=4;var b=l.readUshort(e,s);s+=2,h[S.trim()]=r._lctf.readLangSysTable(e,u+b)}return h},r._lctf.readLangSysTable=function(e,s){var l=r._bin,u={};l.readUshort(e,s),s+=2,u.reqFeature=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);return s+=2,u.features=l.readUshorts(e,s,h),u},r.CFF={},r.CFF.parse=function(e,s,l){var u=r._bin;(e=new Uint8Array(e.buffer,s,l))[s=0],e[++s],e[++s],e[++s],s++;var h=[];s=r.CFF.readIndex(e,s,h);for(var p=[],v=0;v<h.length-1;v++)p.push(u.readASCII(e,s+h[v],h[v+1]-h[v]));s+=h[h.length-1];var m=[];s=r.CFF.readIndex(e,s,m);var S=[];for(v=0;v<m.length-1;v++)S.push(r.CFF.readDict(e,s+m[v],s+m[v+1]));s+=m[m.length-1];var b=S[0],x=[];s=r.CFF.readIndex(e,s,x);var k=[];for(v=0;v<x.length-1;v++)k.push(u.readASCII(e,s+x[v],x[v+1]-x[v]));if(s+=x[x.length-1],r.CFF.readSubrs(e,s,b),b.CharStrings){s=b.CharStrings,x=[],s=r.CFF.readIndex(e,s,x);var F=[];for(v=0;v<x.length-1;v++)F.push(u.readBytes(e,s+x[v],x[v+1]-x[v]));b.CharStrings=F}if(b.ROS){s=b.FDArray;var C=[];for(s=r.CFF.readIndex(e,s,C),b.FDArray=[],v=0;v<C.length-1;v++){var _=r.CFF.readDict(e,s+C[v],s+C[v+1]);r.CFF._readFDict(e,_,k),b.FDArray.push(_)}s+=C[C.length-1],s=b.FDSelect,b.FDSelect=[];var D=e[s];if(s++,3!=D)throw D;var G=u.readUshort(e,s);for(s+=2,v=0;v<G+1;v++)b.FDSelect.push(u.readUshort(e,s),e[s+2]),s+=3}return b.Encoding&&(b.Encoding=r.CFF.readEncoding(e,b.Encoding,b.CharStrings.length)),b.charset&&(b.charset=r.CFF.readCharset(e,b.charset,b.CharStrings.length)),r.CFF._readFDict(e,b,k),b},r.CFF._readFDict=function(e,s,l){var u;for(var h in s.Private&&(u=s.Private[1],s.Private=r.CFF.readDict(e,u,u+s.Private[0]),s.Private.Subrs&&r.CFF.readSubrs(e,u+s.Private.Subrs,s.Private)),s)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(h)&&(s[h]=l[s[h]-426+35])},r.CFF.readSubrs=function(e,s,l){var u=r._bin,h=[];s=r.CFF.readIndex(e,s,h);var p=h.length;l.Bias=p<1240?107:p<33900?1131:32768,l.Subrs=[];for(var v=0;v<h.length-1;v++)l.Subrs.push(u.readBytes(e,s+h[v],h[v+1]-h[v]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(e,r){for(var s=0;s<e.charset.length;s++)if(e.charset[s]==r)return s;return -1},r.CFF.glyphBySE=function(e,s){return s<0||s>255?-1:r.CFF.glyphByUnicode(e,r.CFF.tableSE[s])},r.CFF.readEncoding=function(e,s,l){r._bin;var u=[".notdef"],h=e[s];if(s++,0!=h)throw"error: unknown encoding format: "+h;var p=e[s];s++;for(var v=0;v<p;v++)u.push(e[s+v]);return u},r.CFF.readCharset=function(e,s,l){var u=r._bin,h=[".notdef"],p=e[s];if(s++,0==p)for(var v=0;v<l;v++){var m=u.readUshort(e,s);s+=2,h.push(m)}else{if(1!=p&&2!=p)throw"error: format: "+p;for(;h.length<l;){m=u.readUshort(e,s),s+=2;var S=0;for(1==p?(S=e[s],s++):(S=u.readUshort(e,s),s+=2),v=0;v<=S;v++)h.push(m),m++}}return h},r.CFF.readIndex=function(e,s,l){var u=r._bin,h=u.readUshort(e,s)+1,p=e[s+=2];if(s++,1==p)for(var v=0;v<h;v++)l.push(e[s+v]);else if(2==p)for(v=0;v<h;v++)l.push(u.readUshort(e,s+2*v));else if(3==p)for(v=0;v<h;v++)l.push(16777215&u.readUint(e,s+3*v-1));else if(1!=h)throw"unsupported offset size: "+p+", count: "+h;return(s+=h*p)-1},r.CFF.getCharString=function(e,s,l){var u=r._bin,h=e[s],p=e[s+1];e[s+2],e[s+3],e[s+4];var v=1,m=null,S=null;h<=20&&(m=h,v=1),12==h&&(m=100*h+p,v=2),21<=h&&h<=27&&(m=h,v=1),28==h&&(S=u.readShort(e,s+1),v=3),29<=h&&h<=31&&(m=h,v=1),32<=h&&h<=246&&(S=h-139,v=1),247<=h&&h<=250&&(S=256*(h-247)+p+108,v=2),251<=h&&h<=254&&(S=-(256*(h-251))-p-108,v=2),255==h&&(S=u.readInt(e,s+1)/65535,v=5),l.val=null!=S?S:"o"+m,l.size=v},r.CFF.readCharString=function(e,s,l){for(var u=s+l,h=r._bin,p=[];s<u;){var v=e[s],m=e[s+1];e[s+2],e[s+3],e[s+4];var S=1,b=null,x=null;v<=20&&(b=v,S=1),12==v&&(b=100*v+m,S=2),19!=v&&20!=v||(b=v,S=2),21<=v&&v<=27&&(b=v,S=1),28==v&&(x=h.readShort(e,s+1),S=3),29<=v&&v<=31&&(b=v,S=1),32<=v&&v<=246&&(x=v-139,S=1),247<=v&&v<=250&&(x=256*(v-247)+m+108,S=2),251<=v&&v<=254&&(x=-(256*(v-251))-m-108,S=2),255==v&&(x=h.readInt(e,s+1)/65535,S=5),p.push(null!=x?x:"o"+b),s+=S}return p},r.CFF.readDict=function(e,s,l){for(var u=r._bin,h={},p=[];s<l;){var v=e[s],m=e[s+1];e[s+2],e[s+3],e[s+4];var S=1,b=null,x=null;if(28==v&&(x=u.readShort(e,s+1),S=3),29==v&&(x=u.readInt(e,s+1),S=5),32<=v&&v<=246&&(x=v-139,S=1),247<=v&&v<=250&&(x=256*(v-247)+m+108,S=2),251<=v&&v<=254&&(x=-(256*(v-251))-m-108,S=2),255==v)throw x=u.readInt(e,s+1)/65535,S=5,"unknown number";if(30==v){var k=[];for(S=1;;){var F=e[s+S];S++;var C=F>>4,_=15&F;if(15!=C&&k.push(C),15!=_&&k.push(_),15==_)break}for(var D="",G=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],A=0;A<k.length;A++)D+=G[k[A]];x=parseFloat(D)}v<=21&&(b=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][v],S=1,12==v&&(b=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][m],S=2)),null!=b?(h[b]=1==p.length?p[0]:p,p=[]):p.push(x),s+=S}return h},r.cmap={},r.cmap.parse=function(e,s,l){e=new Uint8Array(e.buffer,s,l),s=0;var u=r._bin,h={};u.readUshort(e,s),s+=2;var p=u.readUshort(e,s);s+=2;var v=[];h.tables=[];for(var m=0;m<p;m++){var S=u.readUshort(e,s);s+=2;var b=u.readUshort(e,s);s+=2;var x=u.readUint(e,s);s+=4;var k="p"+S+"e"+b,F=v.indexOf(x);if(-1==F){F=h.tables.length,v.push(x);var C,_=u.readUshort(e,x);0==_?C=r.cmap.parse0(e,x):4==_?C=r.cmap.parse4(e,x):6==_?C=r.cmap.parse6(e,x):12==_?C=r.cmap.parse12(e,x):console.debug("unknown format: "+_,S,b,x),h.tables.push(C)}if(null!=h[k])throw"multiple tables for one platform+encoding";h[k]=F}return h},r.cmap.parse0=function(e,s){var l=r._bin,u={};u.format=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);s+=2,l.readUshort(e,s),s+=2,u.map=[];for(var p=0;p<h-6;p++)u.map.push(e[s+p]);return u},r.cmap.parse4=function(e,s){var l=r._bin,u=s,h={};h.format=l.readUshort(e,s),s+=2;var p=l.readUshort(e,s);s+=2,l.readUshort(e,s),s+=2;var v=l.readUshort(e,s);s+=2;var m=v/2;h.searchRange=l.readUshort(e,s),s+=2,h.entrySelector=l.readUshort(e,s),s+=2,h.rangeShift=l.readUshort(e,s),s+=2,h.endCount=l.readUshorts(e,s,m),s+=2*m+2,h.startCount=l.readUshorts(e,s,m),s+=2*m,h.idDelta=[];for(var S=0;S<m;S++)h.idDelta.push(l.readShort(e,s)),s+=2;for(h.idRangeOffset=l.readUshorts(e,s,m),s+=2*m,h.glyphIdArray=[];s<u+p;)h.glyphIdArray.push(l.readUshort(e,s)),s+=2;return h},r.cmap.parse6=function(e,s){var l=r._bin,u={};u.format=l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2,u.firstCode=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);s+=2,u.glyphIdArray=[];for(var p=0;p<h;p++)u.glyphIdArray.push(l.readUshort(e,s)),s+=2;return u},r.cmap.parse12=function(e,s){var l=r._bin,u={};u.format=l.readUshort(e,s),s+=4,l.readUint(e,s),s+=4,l.readUint(e,s),s+=4;var h=l.readUint(e,s);s+=4,u.groups=[];for(var p=0;p<h;p++){var v=s+12*p,m=l.readUint(e,v+0),S=l.readUint(e,v+4),b=l.readUint(e,v+8);u.groups.push([m,S,b])}return u},r.glyf={},r.glyf.parse=function(e,r,s,l){for(var u=[],h=0;h<l.maxp.numGlyphs;h++)u.push(null);return u},r.glyf._parseGlyf=function(e,s){var l,u=r._bin,h=e._data,p=r._tabOffset(h,"glyf",e._offset)+e.loca[s];if(e.loca[s]==e.loca[s+1])return null;var v={};if(v.noc=u.readShort(h,p),p+=2,v.xMin=u.readShort(h,p),p+=2,v.yMin=u.readShort(h,p),p+=2,v.xMax=u.readShort(h,p),p+=2,v.yMax=u.readShort(h,p),p+=2,v.xMin>=v.xMax||v.yMin>=v.yMax)return null;if(v.noc>0){v.endPts=[];for(var m=0;m<v.noc;m++)v.endPts.push(u.readUshort(h,p)),p+=2;var S=u.readUshort(h,p);if(p+=2,h.length-p<S)return null;v.instructions=u.readBytes(h,p,S),p+=S;var b=v.endPts[v.noc-1]+1;for(m=0,v.flags=[];m<b;m++){var x=h[p];if(p++,v.flags.push(x),0!=(8&x)){var k=h[p];p++;for(var F=0;F<k;F++)v.flags.push(x),m++}}for(m=0,v.xs=[];m<b;m++){var C=0!=(2&v.flags[m]),_=0!=(16&v.flags[m]);C?(v.xs.push(_?h[p]:-h[p]),p++):_?v.xs.push(0):(v.xs.push(u.readShort(h,p)),p+=2)}for(m=0,v.ys=[];m<b;m++)C=0!=(4&v.flags[m]),_=0!=(32&v.flags[m]),C?(v.ys.push(_?h[p]:-h[p]),p++):_?v.ys.push(0):(v.ys.push(u.readShort(h,p)),p+=2);var D=0,G=0;for(m=0;m<b;m++)D+=v.xs[m],G+=v.ys[m],v.xs[m]=D,v.ys[m]=G}else{v.parts=[];do{l=u.readUshort(h,p),p+=2;var A={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(v.parts.push(A),A.glyphIndex=u.readUshort(h,p),p+=2,1&l){var P=u.readShort(h,p);p+=2;var B=u.readShort(h,p);p+=2}else P=u.readInt8(h,p),p++,B=u.readInt8(h,p),p++;2&l?(A.m.tx=P,A.m.ty=B):(A.p1=P,A.p2=B),8&l?(A.m.a=A.m.d=u.readF2dot14(h,p),p+=2):64&l?(A.m.a=u.readF2dot14(h,p),p+=2,A.m.d=u.readF2dot14(h,p),p+=2):128&l&&(A.m.a=u.readF2dot14(h,p),p+=2,A.m.b=u.readF2dot14(h,p),p+=2,A.m.c=u.readF2dot14(h,p),p+=2,A.m.d=u.readF2dot14(h,p),p+=2)}while(32&l);if(256&l){var I=u.readUshort(h,p);for(p+=2,v.instr=[],m=0;m<I;m++)v.instr.push(h[p]),p++}}return v},r.GDEF={},r.GDEF.parse=function(e,s,l,u){var h=s;s+=4;var p=r._bin.readUshort(e,s);return{glyphClassDef:0===p?null:r._lctf.readClassDef(e,h+p)}},r.GPOS={},r.GPOS.parse=function(e,s,l,u){return r._lctf.parse(e,s,l,u,r.GPOS.subt)},r.GPOS.subt=function(e,s,l,u){var h=r._bin,p=l,v={};if(v.fmt=h.readUshort(e,l),l+=2,1==s||2==s||3==s||7==s||8==s&&v.fmt<=2){var m=h.readUshort(e,l);l+=2,v.coverage=r._lctf.readCoverage(e,m+p)}if(1==s&&1==v.fmt){var S=h.readUshort(e,l);l+=2,0!=S&&(v.pos=r.GPOS.readValueRecord(e,l,S))}else if(2==s&&v.fmt>=1&&v.fmt<=2){S=h.readUshort(e,l),l+=2;var b=h.readUshort(e,l);l+=2;var x=r._lctf.numOfOnes(S),k=r._lctf.numOfOnes(b);if(1==v.fmt){v.pairsets=[];var F=h.readUshort(e,l);l+=2;for(var C=0;C<F;C++){var _=p+h.readUshort(e,l);l+=2;var D=h.readUshort(e,_);_+=2;for(var G=[],A=0;A<D;A++){var P=h.readUshort(e,_);_+=2,0!=S&&(z=r.GPOS.readValueRecord(e,_,S),_+=2*x),0!=b&&(V=r.GPOS.readValueRecord(e,_,b),_+=2*k),G.push({gid2:P,val1:z,val2:V})}v.pairsets.push(G)}}if(2==v.fmt){var B=h.readUshort(e,l);l+=2;var I=h.readUshort(e,l);l+=2;var R=h.readUshort(e,l);l+=2;var E=h.readUshort(e,l);for(l+=2,v.classDef1=r._lctf.readClassDef(e,p+B),v.classDef2=r._lctf.readClassDef(e,p+I),v.matrix=[],C=0;C<R;C++){var W=[];for(A=0;A<E;A++){var z=null,V=null;0!=S&&(z=r.GPOS.readValueRecord(e,l,S),l+=2*x),0!=b&&(V=r.GPOS.readValueRecord(e,l,b),l+=2*k),W.push({val1:z,val2:V})}v.matrix.push(W)}}}else if(4==s&&1==v.fmt)v.markCoverage=r._lctf.readCoverage(e,h.readUshort(e,l)+p),v.baseCoverage=r._lctf.readCoverage(e,h.readUshort(e,l+2)+p),v.markClassCount=h.readUshort(e,l+4),v.markArray=r.GPOS.readMarkArray(e,h.readUshort(e,l+6)+p),v.baseArray=r.GPOS.readBaseArray(e,h.readUshort(e,l+8)+p,v.markClassCount);else if(6==s&&1==v.fmt)v.mark1Coverage=r._lctf.readCoverage(e,h.readUshort(e,l)+p),v.mark2Coverage=r._lctf.readCoverage(e,h.readUshort(e,l+2)+p),v.markClassCount=h.readUshort(e,l+4),v.mark1Array=r.GPOS.readMarkArray(e,h.readUshort(e,l+6)+p),v.mark2Array=r.GPOS.readBaseArray(e,h.readUshort(e,l+8)+p,v.markClassCount);else{if(9==s&&1==v.fmt){var j=h.readUshort(e,l);l+=2;var N=h.readUint(e,l);if(l+=4,9==u.ltype)u.ltype=j;else if(u.ltype!=j)throw"invalid extension substitution";return r.GPOS.subt(e,u.ltype,p+N)}console.debug("unsupported GPOS table LookupType",s,"format",v.fmt)}return v},r.GPOS.readValueRecord=function(e,s,l){var u=r._bin,h=[];return h.push(1&l?u.readShort(e,s):0),s+=1&l?2:0,h.push(2&l?u.readShort(e,s):0),s+=2&l?2:0,h.push(4&l?u.readShort(e,s):0),s+=4&l?2:0,h.push(8&l?u.readShort(e,s):0),s+=8&l?2:0,h},r.GPOS.readBaseArray=function(e,s,l){var u=r._bin,h=[],p=s,v=u.readUshort(e,s);s+=2;for(var m=0;m<v;m++){for(var S=[],b=0;b<l;b++)S.push(r.GPOS.readAnchorRecord(e,p+u.readUshort(e,s))),s+=2;h.push(S)}return h},r.GPOS.readMarkArray=function(e,s){var l=r._bin,u=[],h=s,p=l.readUshort(e,s);s+=2;for(var v=0;v<p;v++){var m=r.GPOS.readAnchorRecord(e,l.readUshort(e,s+2)+h);m.markClass=l.readUshort(e,s),u.push(m),s+=4}return u},r.GPOS.readAnchorRecord=function(e,s){var l=r._bin,u={};return u.fmt=l.readUshort(e,s),u.x=l.readShort(e,s+2),u.y=l.readShort(e,s+4),u},r.GSUB={},r.GSUB.parse=function(e,s,l,u){return r._lctf.parse(e,s,l,u,r.GSUB.subt)},r.GSUB.subt=function(e,s,l,u){var h=r._bin,p=l,v={};if(v.fmt=h.readUshort(e,l),l+=2,1!=s&&2!=s&&4!=s&&5!=s&&6!=s)return null;if(1==s||2==s||4==s||5==s&&v.fmt<=2||6==s&&v.fmt<=2){var m=h.readUshort(e,l);l+=2,v.coverage=r._lctf.readCoverage(e,p+m)}if(1==s&&v.fmt>=1&&v.fmt<=2){if(1==v.fmt)v.delta=h.readShort(e,l),l+=2;else if(2==v.fmt){var S=h.readUshort(e,l);l+=2,v.newg=h.readUshorts(e,l,S),l+=2*v.newg.length}}else if(2==s&&1==v.fmt){S=h.readUshort(e,l),l+=2,v.seqs=[];for(var b=0;b<S;b++){var x=h.readUshort(e,l)+p;l+=2;var k=h.readUshort(e,x);v.seqs.push(h.readUshorts(e,x+2,k))}}else if(4==s)for(v.vals=[],S=h.readUshort(e,l),l+=2,b=0;b<S;b++){var F=h.readUshort(e,l);l+=2,v.vals.push(r.GSUB.readLigatureSet(e,p+F))}else if(5==s&&2==v.fmt){if(2==v.fmt){var C=h.readUshort(e,l);l+=2,v.cDef=r._lctf.readClassDef(e,p+C),v.scset=[];var _=h.readUshort(e,l);for(l+=2,b=0;b<_;b++){var D=h.readUshort(e,l);l+=2,v.scset.push(0==D?null:r.GSUB.readSubClassSet(e,p+D))}}}else if(6==s&&3==v.fmt){if(3==v.fmt){for(b=0;b<3;b++){S=h.readUshort(e,l),l+=2;for(var G=[],A=0;A<S;A++)G.push(r._lctf.readCoverage(e,p+h.readUshort(e,l+2*A)));l+=2*S,0==b&&(v.backCvg=G),1==b&&(v.inptCvg=G),2==b&&(v.ahedCvg=G)}S=h.readUshort(e,l),l+=2,v.lookupRec=r.GSUB.readSubstLookupRecords(e,l,S)}}else{if(7==s&&1==v.fmt){var P=h.readUshort(e,l);l+=2;var B=h.readUint(e,l);if(l+=4,9==u.ltype)u.ltype=P;else if(u.ltype!=P)throw"invalid extension substitution";return r.GSUB.subt(e,u.ltype,p+B)}console.debug("unsupported GSUB table LookupType",s,"format",v.fmt)}return v},r.GSUB.readSubClassSet=function(e,s){var l=r._bin.readUshort,u=s,h=[],p=l(e,s);s+=2;for(var v=0;v<p;v++){var m=l(e,s);s+=2,h.push(r.GSUB.readSubClassRule(e,u+m))}return h},r.GSUB.readSubClassRule=function(e,s){var l=r._bin.readUshort,u={},h=l(e,s),p=l(e,s+=2);s+=2,u.input=[];for(var v=0;v<h-1;v++)u.input.push(l(e,s)),s+=2;return u.substLookupRecords=r.GSUB.readSubstLookupRecords(e,s,p),u},r.GSUB.readSubstLookupRecords=function(e,s,l){for(var u=r._bin.readUshort,h=[],p=0;p<l;p++)h.push(u(e,s),u(e,s+2)),s+=4;return h},r.GSUB.readChainSubClassSet=function(e,s){var l=r._bin,u=s,h=[],p=l.readUshort(e,s);s+=2;for(var v=0;v<p;v++){var m=l.readUshort(e,s);s+=2,h.push(r.GSUB.readChainSubClassRule(e,u+m))}return h},r.GSUB.readChainSubClassRule=function(e,s){for(var l=r._bin,u={},h=["backtrack","input","lookahead"],p=0;p<h.length;p++){var v=l.readUshort(e,s);s+=2,1==p&&v--,u[h[p]]=l.readUshorts(e,s,v),s+=2*u[h[p]].length}return v=l.readUshort(e,s),s+=2,u.subst=l.readUshorts(e,s,2*v),s+=2*u.subst.length,u},r.GSUB.readLigatureSet=function(e,s){var l=r._bin,u=s,h=[],p=l.readUshort(e,s);s+=2;for(var v=0;v<p;v++){var m=l.readUshort(e,s);s+=2,h.push(r.GSUB.readLigature(e,u+m))}return h},r.GSUB.readLigature=function(e,s){var l=r._bin,u={chain:[]};u.nglyph=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);s+=2;for(var p=0;p<h-1;p++)u.chain.push(l.readUshort(e,s)),s+=2;return u},r.head={},r.head.parse=function(e,s,l){var u=r._bin,h={};return u.readFixed(e,s),s+=4,h.fontRevision=u.readFixed(e,s),s+=4,u.readUint(e,s),s+=4,u.readUint(e,s),s+=4,h.flags=u.readUshort(e,s),s+=2,h.unitsPerEm=u.readUshort(e,s),s+=2,h.created=u.readUint64(e,s),s+=8,h.modified=u.readUint64(e,s),s+=8,h.xMin=u.readShort(e,s),s+=2,h.yMin=u.readShort(e,s),s+=2,h.xMax=u.readShort(e,s),s+=2,h.yMax=u.readShort(e,s),s+=2,h.macStyle=u.readUshort(e,s),s+=2,h.lowestRecPPEM=u.readUshort(e,s),s+=2,h.fontDirectionHint=u.readShort(e,s),s+=2,h.indexToLocFormat=u.readShort(e,s),s+=2,h.glyphDataFormat=u.readShort(e,s),s+=2,h},r.hhea={},r.hhea.parse=function(e,s,l){var u=r._bin,h={};return u.readFixed(e,s),s+=4,h.ascender=u.readShort(e,s),s+=2,h.descender=u.readShort(e,s),s+=2,h.lineGap=u.readShort(e,s),s+=2,h.advanceWidthMax=u.readUshort(e,s),s+=2,h.minLeftSideBearing=u.readShort(e,s),s+=2,h.minRightSideBearing=u.readShort(e,s),s+=2,h.xMaxExtent=u.readShort(e,s),s+=2,h.caretSlopeRise=u.readShort(e,s),s+=2,h.caretSlopeRun=u.readShort(e,s),s+=2,h.caretOffset=u.readShort(e,s),s+=10,h.metricDataFormat=u.readShort(e,s),s+=2,h.numberOfHMetrics=u.readUshort(e,s),s+=2,h},r.hmtx={},r.hmtx.parse=function(e,s,l,u){for(var h=r._bin,p={aWidth:[],lsBearing:[]},v=0,m=0,S=0;S<u.maxp.numGlyphs;S++)S<u.hhea.numberOfHMetrics&&(v=h.readUshort(e,s),s+=2,m=h.readShort(e,s),s+=2),p.aWidth.push(v),p.lsBearing.push(m);return p},r.kern={},r.kern.parse=function(e,s,l,u){var h=r._bin,p=h.readUshort(e,s);if(s+=2,1==p)return r.kern.parseV1(e,s-2,l,u);var v=h.readUshort(e,s);s+=2;for(var m={glyph1:[],rval:[]},S=0;S<v;S++){s+=2,l=h.readUshort(e,s),s+=2;var b=h.readUshort(e,s);s+=2;var x=b>>>8;if(0!=(x&=15))throw"unknown kern table format: "+x;s=r.kern.readFormat0(e,s,m)}return m},r.kern.parseV1=function(e,s,l,u){var h=r._bin;h.readFixed(e,s),s+=4;var p=h.readUint(e,s);s+=4;for(var v={glyph1:[],rval:[]},m=0;m<p;m++){h.readUint(e,s),s+=4;var S=h.readUshort(e,s);s+=2,h.readUshort(e,s),s+=2;var b=S>>>8;if(0!=(b&=15))throw"unknown kern table format: "+b;s=r.kern.readFormat0(e,s,v)}return v},r.kern.readFormat0=function(e,s,l){var u=r._bin,h=-1,p=u.readUshort(e,s);s+=2,u.readUshort(e,s),s+=2,u.readUshort(e,s),s+=2,u.readUshort(e,s),s+=2;for(var v=0;v<p;v++){var m=u.readUshort(e,s);s+=2;var S=u.readUshort(e,s);s+=2;var b=u.readShort(e,s);s+=2,m!=h&&(l.glyph1.push(m),l.rval.push({glyph2:[],vals:[]}));var x=l.rval[l.rval.length-1];x.glyph2.push(S),x.vals.push(b),h=m}return s},r.loca={},r.loca.parse=function(e,s,l,u){var h=r._bin,p=[],v=u.head.indexToLocFormat,m=u.maxp.numGlyphs+1;if(0==v)for(var S=0;S<m;S++)p.push(h.readUshort(e,s+(S<<1))<<1);if(1==v)for(S=0;S<m;S++)p.push(h.readUint(e,s+(S<<2)));return p},r.maxp={},r.maxp.parse=function(e,s,l){var u=r._bin,h={},p=u.readUint(e,s);return s+=4,h.numGlyphs=u.readUshort(e,s),s+=2,65536==p&&(h.maxPoints=u.readUshort(e,s),s+=2,h.maxContours=u.readUshort(e,s),s+=2,h.maxCompositePoints=u.readUshort(e,s),s+=2,h.maxCompositeContours=u.readUshort(e,s),s+=2,h.maxZones=u.readUshort(e,s),s+=2,h.maxTwilightPoints=u.readUshort(e,s),s+=2,h.maxStorage=u.readUshort(e,s),s+=2,h.maxFunctionDefs=u.readUshort(e,s),s+=2,h.maxInstructionDefs=u.readUshort(e,s),s+=2,h.maxStackElements=u.readUshort(e,s),s+=2,h.maxSizeOfInstructions=u.readUshort(e,s),s+=2,h.maxComponentElements=u.readUshort(e,s),s+=2,h.maxComponentDepth=u.readUshort(e,s),s+=2),h},r.name={},r.name.parse=function(e,s,l){var u=r._bin,h={};u.readUshort(e,s),s+=2;var p=u.readUshort(e,s);s+=2,u.readUshort(e,s);for(var v,m=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],S=s+=2,b=0;b<p;b++){var x=u.readUshort(e,s);s+=2;var k=u.readUshort(e,s);s+=2;var F=u.readUshort(e,s);s+=2;var C=u.readUshort(e,s);s+=2;var _=u.readUshort(e,s);s+=2;var D=u.readUshort(e,s);s+=2;var G,A=m[C],P=S+12*p+D;if(0==x)G=u.readUnicode(e,P,_/2);else if(3==x&&0==k)G=u.readUnicode(e,P,_/2);else if(0==k)G=u.readASCII(e,P,_);else if(1==k)G=u.readUnicode(e,P,_/2);else if(3==k)G=u.readUnicode(e,P,_/2);else{if(1!=x)throw"unknown encoding "+k+", platformID: "+x;G=u.readASCII(e,P,_),console.debug("reading unknown MAC encoding "+k+" as ASCII")}var B="p"+x+","+F.toString(16);null==h[B]&&(h[B]={}),h[B][void 0!==A?A:C]=G,h[B]._lang=F}for(var I in h)if(null!=h[I].postScriptName&&1033==h[I]._lang)return h[I];for(var I in h)if(null!=h[I].postScriptName&&0==h[I]._lang)return h[I];for(var I in h)if(null!=h[I].postScriptName&&3084==h[I]._lang)return h[I];for(var I in h)if(null!=h[I].postScriptName)return h[I];for(var I in h){v=I;break}return console.debug("returning name table with languageID "+h[v]._lang),h[v]},r["OS/2"]={},r["OS/2"].parse=function(e,s,l){var u=r._bin.readUshort(e,s);s+=2;var h={};if(0==u)r["OS/2"].version0(e,s,h);else if(1==u)r["OS/2"].version1(e,s,h);else if(2==u||3==u||4==u)r["OS/2"].version2(e,s,h);else{if(5!=u)throw"unknown OS/2 table version: "+u;r["OS/2"].version5(e,s,h)}return h},r["OS/2"].version0=function(e,s,l){var u=r._bin;return l.xAvgCharWidth=u.readShort(e,s),s+=2,l.usWeightClass=u.readUshort(e,s),s+=2,l.usWidthClass=u.readUshort(e,s),s+=2,l.fsType=u.readUshort(e,s),s+=2,l.ySubscriptXSize=u.readShort(e,s),s+=2,l.ySubscriptYSize=u.readShort(e,s),s+=2,l.ySubscriptXOffset=u.readShort(e,s),s+=2,l.ySubscriptYOffset=u.readShort(e,s),s+=2,l.ySuperscriptXSize=u.readShort(e,s),s+=2,l.ySuperscriptYSize=u.readShort(e,s),s+=2,l.ySuperscriptXOffset=u.readShort(e,s),s+=2,l.ySuperscriptYOffset=u.readShort(e,s),s+=2,l.yStrikeoutSize=u.readShort(e,s),s+=2,l.yStrikeoutPosition=u.readShort(e,s),s+=2,l.sFamilyClass=u.readShort(e,s),s+=2,l.panose=u.readBytes(e,s,10),s+=10,l.ulUnicodeRange1=u.readUint(e,s),s+=4,l.ulUnicodeRange2=u.readUint(e,s),s+=4,l.ulUnicodeRange3=u.readUint(e,s),s+=4,l.ulUnicodeRange4=u.readUint(e,s),s+=4,l.achVendID=[u.readInt8(e,s),u.readInt8(e,s+1),u.readInt8(e,s+2),u.readInt8(e,s+3)],s+=4,l.fsSelection=u.readUshort(e,s),s+=2,l.usFirstCharIndex=u.readUshort(e,s),s+=2,l.usLastCharIndex=u.readUshort(e,s),s+=2,l.sTypoAscender=u.readShort(e,s),s+=2,l.sTypoDescender=u.readShort(e,s),s+=2,l.sTypoLineGap=u.readShort(e,s),s+=2,l.usWinAscent=u.readUshort(e,s),s+=2,l.usWinDescent=u.readUshort(e,s),s+=2},r["OS/2"].version1=function(e,s,l){var u=r._bin;return s=r["OS/2"].version0(e,s,l),l.ulCodePageRange1=u.readUint(e,s),s+=4,l.ulCodePageRange2=u.readUint(e,s),s+=4},r["OS/2"].version2=function(e,s,l){var u=r._bin;return s=r["OS/2"].version1(e,s,l),l.sxHeight=u.readShort(e,s),s+=2,l.sCapHeight=u.readShort(e,s),s+=2,l.usDefault=u.readUshort(e,s),s+=2,l.usBreak=u.readUshort(e,s),s+=2,l.usMaxContext=u.readUshort(e,s),s+=2},r["OS/2"].version5=function(e,s,l){var u=r._bin;return s=r["OS/2"].version2(e,s,l),l.usLowerOpticalPointSize=u.readUshort(e,s),s+=2,l.usUpperOpticalPointSize=u.readUshort(e,s),s+=2},r.post={},r.post.parse=function(e,s,l){var u=r._bin,h={};return h.version=u.readFixed(e,s),s+=4,h.italicAngle=u.readFixed(e,s),s+=4,h.underlinePosition=u.readShort(e,s),s+=2,h.underlineThickness=u.readShort(e,s),s+=2,h},null==r&&(r={}),null==r.U&&(r.U={}),r.U.codeToGlyph=function(e,r){var s=e.cmap,l=-1;if(null!=s.p0e4?l=s.p0e4:null!=s.p3e1?l=s.p3e1:null!=s.p1e0?l=s.p1e0:null!=s.p0e3&&(l=s.p0e3),-1==l)throw"no familiar platform and encoding!";var u=s.tables[l];if(0==u.format)return r>=u.map.length?0:u.map[r];if(4==u.format){for(var h=-1,p=0;p<u.endCount.length;p++)if(r<=u.endCount[p]){h=p;break}return -1==h||u.startCount[h]>r?0:65535&(0!=u.idRangeOffset[h]?u.glyphIdArray[r-u.startCount[h]+(u.idRangeOffset[h]>>1)-(u.idRangeOffset.length-h)]:r+u.idDelta[h])}if(12==u.format){if(r>u.groups[u.groups.length-1][1])return 0;for(p=0;p<u.groups.length;p++){var v=u.groups[p];if(v[0]<=r&&r<=v[1])return v[2]+(r-v[0])}return 0}throw"unknown cmap table format "+u.format},r.U.glyphToPath=function(e,s){var l={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[s]){var u=e.SVG.entries[s];return null==u?l:("string"==typeof u&&(u=r.SVG.toPath(u),e.SVG.entries[s]=u),u)}if(e.CFF){var h={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},p=e.CFF,v=e.CFF.Private;if(p.ROS){for(var m=0;p.FDSelect[m+2]<=s;)m+=2;v=p.FDArray[p.FDSelect[m+1]].Private}r.U._drawCFF(e.CFF.CharStrings[s],h,p,v,l)}else e.glyf&&r.U._drawGlyf(s,e,l);return l},r.U._drawGlyf=function(e,s,l){var u=s.glyf[e];null==u&&(u=s.glyf[e]=r.glyf._parseGlyf(s,e)),null!=u&&(u.noc>-1?r.U._simpleGlyph(u,l):r.U._compoGlyph(u,s,l))},r.U._simpleGlyph=function(e,s){for(var l=0;l<e.noc;l++){for(var u=0==l?0:e.endPts[l-1]+1,h=e.endPts[l],p=u;p<=h;p++){var v=p==u?h:p-1,m=p==h?u:p+1,S=1&e.flags[p],b=1&e.flags[v],x=1&e.flags[m],k=e.xs[p],F=e.ys[p];if(p==u){if(S){if(!b){r.U.P.moveTo(s,k,F);continue}r.U.P.moveTo(s,e.xs[v],e.ys[v])}else b?r.U.P.moveTo(s,e.xs[v],e.ys[v]):r.U.P.moveTo(s,(e.xs[v]+k)/2,(e.ys[v]+F)/2)}S?b&&r.U.P.lineTo(s,k,F):x?r.U.P.qcurveTo(s,k,F,e.xs[m],e.ys[m]):r.U.P.qcurveTo(s,k,F,(k+e.xs[m])/2,(F+e.ys[m])/2)}r.U.P.closePath(s)}},r.U._compoGlyph=function(e,s,l){for(var u=0;u<e.parts.length;u++){var h={cmds:[],crds:[]},p=e.parts[u];r.U._drawGlyf(p.glyphIndex,s,h);for(var v=p.m,m=0;m<h.crds.length;m+=2){var S=h.crds[m],b=h.crds[m+1];l.crds.push(S*v.a+b*v.b+v.tx),l.crds.push(S*v.c+b*v.d+v.ty)}for(m=0;m<h.cmds.length;m++)l.cmds.push(h.cmds[m])}},r.U._getGlyphClass=function(e,s){var l=r._lctf.getInterval(s,e);return -1==l?0:s[l+2]},r.U._applySubs=function(e,s,l,u){for(var h=e.length-s-1,p=0;p<l.tabs.length;p++)if(null!=l.tabs[p]){var v,m=l.tabs[p];if(!m.coverage||-1!=(v=r._lctf.coverageIndex(m.coverage,e[s]))){if(1==l.ltype)e[s],1==m.fmt?e[s]=e[s]+m.delta:e[s]=m.newg[v];else if(4==l.ltype)for(var S=m.vals[v],b=0;b<S.length;b++){var x=S[b],k=x.chain.length;if(!(k>h)){for(var F=!0,C=0,_=0;_<k;_++){for(;-1==e[s+C+(1+_)];)C++;x.chain[_]!=e[s+C+(1+_)]&&(F=!1)}if(F){for(_=0,e[s]=x.nglyph;_<k+C;_++)e[s+_+1]=-1;break}}}else if(5==l.ltype&&2==m.fmt)for(var D=r._lctf.getInterval(m.cDef,e[s]),G=m.cDef[D+2],A=m.scset[G],P=0;P<A.length;P++){var B=A[P],I=B.input;if(!(I.length>h)){for(F=!0,_=0;_<I.length;_++){var R=r._lctf.getInterval(m.cDef,e[s+1+_]);if(-1==D&&m.cDef[R+2]!=I[_]){F=!1;break}}if(F){var E=B.substLookupRecords;for(b=0;b<E.length;b+=2)E[b],E[b+1]}}}else if(6==l.ltype&&3==m.fmt){if(!r.U._glsCovered(e,m.backCvg,s-m.backCvg.length)||!r.U._glsCovered(e,m.inptCvg,s)||!r.U._glsCovered(e,m.ahedCvg,s+m.inptCvg.length))continue;var W=m.lookupRec;for(P=0;P<W.length;P+=2){D=W[P];var z=u[W[P+1]];r.U._applySubs(e,s+D,z,u)}}}}},r.U._glsCovered=function(e,s,l){for(var u=0;u<s.length;u++)if(-1==r._lctf.coverageIndex(s[u],e[l+u]))return!1;return!0},r.U.glyphsToPath=function(e,s,l){for(var u={cmds:[],crds:[]},h=0,p=0;p<s.length;p++){var v=s[p];if(-1!=v){for(var m=p<s.length-1&&-1!=s[p+1]?s[p+1]:0,S=r.U.glyphToPath(e,v),b=0;b<S.crds.length;b+=2)u.crds.push(S.crds[b]+h),u.crds.push(S.crds[b+1]);for(l&&u.cmds.push(l),b=0;b<S.cmds.length;b++)u.cmds.push(S.cmds[b]);l&&u.cmds.push("X"),h+=e.hmtx.aWidth[v],p<s.length-1&&(h+=r.U.getPairAdjustment(e,v,m))}}return u},r.U.P={},r.U.P.moveTo=function(e,r,s){e.cmds.push("M"),e.crds.push(r,s)},r.U.P.lineTo=function(e,r,s){e.cmds.push("L"),e.crds.push(r,s)},r.U.P.curveTo=function(e,r,s,l,u,h,p){e.cmds.push("C"),e.crds.push(r,s,l,u,h,p)},r.U.P.qcurveTo=function(e,r,s,l,u){e.cmds.push("Q"),e.crds.push(r,s,l,u)},r.U.P.closePath=function(e){e.cmds.push("Z")},r.U._drawCFF=function(e,s,l,u,h){for(var p=s.stack,v=s.nStems,m=s.haveWidth,S=s.width,b=s.open,x=0,k=s.x,F=s.y,C=0,_=0,D=0,G=0,A=0,P=0,B=0,I=0,R=0,E=0,W={val:0,size:0};x<e.length;){r.CFF.getCharString(e,x,W);var z=W.val;if(x+=W.size,"o1"==z||"o18"==z)p.length%2==0||m||(S=p.shift()+u.nominalWidthX),v+=p.length>>1,p.length=0,m=!0;else if("o3"==z||"o23"==z)p.length%2==0||m||(S=p.shift()+u.nominalWidthX),v+=p.length>>1,p.length=0,m=!0;else if("o4"==z)p.length>1&&!m&&(S=p.shift()+u.nominalWidthX,m=!0),b&&r.U.P.closePath(h),F+=p.pop(),r.U.P.moveTo(h,k,F),b=!0;else if("o5"==z)for(;p.length>0;)k+=p.shift(),F+=p.shift(),r.U.P.lineTo(h,k,F);else if("o6"==z||"o7"==z)for(var V=p.length,j="o6"==z,N=0;N<V;N++){var H=p.shift();j?k+=H:F+=H,j=!j,r.U.P.lineTo(h,k,F)}else if("o8"==z||"o24"==z){V=p.length;for(var X=0;X+6<=V;)C=k+p.shift(),_=F+p.shift(),D=C+p.shift(),G=_+p.shift(),k=D+p.shift(),F=G+p.shift(),r.U.P.curveTo(h,C,_,D,G,k,F),X+=6;"o24"==z&&(k+=p.shift(),F+=p.shift(),r.U.P.lineTo(h,k,F))}else{if("o11"==z)break;if("o1234"==z||"o1235"==z||"o1236"==z||"o1237"==z)"o1234"==z&&(_=F,D=(C=k+p.shift())+p.shift(),E=G=_+p.shift(),P=G,I=F,k=(B=(A=(R=D+p.shift())+p.shift())+p.shift())+p.shift(),r.U.P.curveTo(h,C,_,D,G,R,E),r.U.P.curveTo(h,A,P,B,I,k,F)),"o1235"==z&&(C=k+p.shift(),_=F+p.shift(),D=C+p.shift(),G=_+p.shift(),R=D+p.shift(),E=G+p.shift(),A=R+p.shift(),P=E+p.shift(),B=A+p.shift(),I=P+p.shift(),k=B+p.shift(),F=I+p.shift(),p.shift(),r.U.P.curveTo(h,C,_,D,G,R,E),r.U.P.curveTo(h,A,P,B,I,k,F)),"o1236"==z&&(C=k+p.shift(),_=F+p.shift(),D=C+p.shift(),E=G=_+p.shift(),P=G,B=(A=(R=D+p.shift())+p.shift())+p.shift(),I=P+p.shift(),k=B+p.shift(),r.U.P.curveTo(h,C,_,D,G,R,E),r.U.P.curveTo(h,A,P,B,I,k,F)),"o1237"==z&&(C=k+p.shift(),_=F+p.shift(),D=C+p.shift(),G=_+p.shift(),R=D+p.shift(),E=G+p.shift(),A=R+p.shift(),P=E+p.shift(),Math.abs((B=A+p.shift())-k)>Math.abs((I=P+p.shift())-F)?k=B+p.shift():F=I+p.shift(),r.U.P.curveTo(h,C,_,D,G,R,E),r.U.P.curveTo(h,A,P,B,I,k,F));else if("o14"==z){if(p.length>0&&!m&&(S=p.shift()+l.nominalWidthX,m=!0),4==p.length){var q=p.shift(),$=p.shift(),Y=p.shift(),Z=p.shift(),J=r.CFF.glyphBySE(l,Y),Q=r.CFF.glyphBySE(l,Z);r.U._drawCFF(l.CharStrings[J],s,l,u,h),s.x=q,s.y=$,r.U._drawCFF(l.CharStrings[Q],s,l,u,h)}b&&(r.U.P.closePath(h),b=!1)}else if("o19"==z||"o20"==z)p.length%2==0||m||(S=p.shift()+u.nominalWidthX),v+=p.length>>1,p.length=0,m=!0,x+=v+7>>3;else if("o21"==z)p.length>2&&!m&&(S=p.shift()+u.nominalWidthX,m=!0),F+=p.pop(),k+=p.pop(),b&&r.U.P.closePath(h),r.U.P.moveTo(h,k,F),b=!0;else if("o22"==z)p.length>1&&!m&&(S=p.shift()+u.nominalWidthX,m=!0),k+=p.pop(),b&&r.U.P.closePath(h),r.U.P.moveTo(h,k,F),b=!0;else if("o25"==z){for(;p.length>6;)k+=p.shift(),F+=p.shift(),r.U.P.lineTo(h,k,F);C=k+p.shift(),_=F+p.shift(),D=C+p.shift(),G=_+p.shift(),k=D+p.shift(),F=G+p.shift(),r.U.P.curveTo(h,C,_,D,G,k,F)}else if("o26"==z)for(p.length%2&&(k+=p.shift());p.length>0;)C=k,_=F+p.shift(),k=D=C+p.shift(),F=(G=_+p.shift())+p.shift(),r.U.P.curveTo(h,C,_,D,G,k,F);else if("o27"==z)for(p.length%2&&(F+=p.shift());p.length>0;)_=F,D=(C=k+p.shift())+p.shift(),G=_+p.shift(),k=D+p.shift(),F=G,r.U.P.curveTo(h,C,_,D,G,k,F);else if("o10"==z||"o29"==z){var K="o10"==z?u:l;if(0==p.length)console.debug("error: empty stack");else{var ee=p.pop(),et=K.Subrs[ee+K.Bias];s.x=k,s.y=F,s.nStems=v,s.haveWidth=m,s.width=S,s.open=b,r.U._drawCFF(et,s,l,u,h),k=s.x,F=s.y,v=s.nStems,m=s.haveWidth,S=s.width,b=s.open}}else if("o30"==z||"o31"==z){var er=p.length,ea=(X=0,"o31"==z);for(X+=er-(V=-3&er);X<V;)ea?(_=F,D=(C=k+p.shift())+p.shift(),F=(G=_+p.shift())+p.shift(),V-X==5?(k=D+p.shift(),X++):k=D,ea=!1):(C=k,_=F+p.shift(),D=C+p.shift(),G=_+p.shift(),k=D+p.shift(),V-X==5?(F=G+p.shift(),X++):F=G,ea=!0),r.U.P.curveTo(h,C,_,D,G,k,F),X+=4}else{if("o"==(z+"").charAt(0))throw console.debug("Unknown operation: "+z,e),z;p.push(z)}}}s.x=k,s.y=F,s.nStems=v,s.haveWidth=m,s.width=S,s.open=b},s=r,e.Typr=s,e.default={Typr:s},Object.defineProperty(e,"__esModule",{value:!0}),e).Typr},/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function(){return function(e){var r=Uint8Array,s=Uint16Array,l=Uint32Array,u=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),p=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(e,r){for(var u=new s(31),h=0;h<31;++h)u[h]=r+=1<<e[h-1];var p=new l(u[30]);for(h=1;h<30;++h)for(var v=u[h];v<u[h+1];++v)p[v]=v-u[h]<<5|h;return[u,p]},v=f(u,2),m=v[0],S=v[1];m[28]=258,S[258]=28;for(var b=f(h,0)[0],x=new s(32768),k=0;k<32768;++k){var F=(43690&k)>>>1|(21845&k)<<1;F=(61680&(F=(52428&F)>>>2|(13107&F)<<2))>>>4|(3855&F)<<4,x[k]=((65280&F)>>>8|(255&F)<<8)>>>1}var w=function(e,r,l){for(var u=e.length,h=0,p=new s(r);h<u;++h)++p[e[h]-1];var v,m=new s(r);for(h=0;h<r;++h)m[h]=m[h-1]+p[h-1]<<1;if(l){v=new s(1<<r);var S=15-r;for(h=0;h<u;++h)if(e[h])for(var b=h<<4|e[h],k=r-e[h],F=m[e[h]-1]++<<k,C=F|(1<<k)-1;F<=C;++F)v[x[F]>>>S]=b}else for(v=new s(u),h=0;h<u;++h)e[h]&&(v[h]=x[m[e[h]-1]++]>>>15-e[h]);return v},C=new r(288);for(k=0;k<144;++k)C[k]=8;for(k=144;k<256;++k)C[k]=9;for(k=256;k<280;++k)C[k]=7;for(k=280;k<288;++k)C[k]=8;var _=new r(32);for(k=0;k<32;++k)_[k]=5;var D=w(C,9,1),G=w(_,5,1),y=function(e){for(var r=e[0],s=1;s<e.length;++s)e[s]>r&&(r=e[s]);return r},L=function(e,r,s){var l=r/8|0;return(e[l]|e[l+1]<<8)>>(7&r)&s},U=function(e,r){var s=r/8|0;return(e[s]|e[s+1]<<8|e[s+2]<<16)>>(7&r)},A=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(e,r,s){var l=Error(r||A[e]);if(l.code=e,Error.captureStackTrace&&Error.captureStackTrace(l,T),!s)throw l;return l},O=function(e,v,S){var x,k,F,C,_=e.length;if(!_||S&&!S.l&&_<5)return v||new r(0);var A=!v||S,P=!S||S.i;S||(S={}),v||(v=new r(3*_));var B,d=function(e){var s=v.length;if(e>s){var l=new r(Math.max(2*s,e));l.set(v),v=l}},I=S.f||0,R=S.p||0,E=S.b||0,W=S.l,z=S.d,V=S.m,j=S.n,N=8*_;do{if(!W){S.f=I=L(e,R,1);var H=L(e,R+1,3);if(R+=3,!H){var X=e[(ea=((B=R)/8|0)+(7&B&&1)+4)-4]|e[ea-3]<<8,q=ea+X;if(q>_){P&&T(0);break}A&&d(E+X),v.set(e.subarray(ea,q),E),S.b=E+=X,S.p=R=8*q;continue}if(1==H)W=D,z=G,V=9,j=5;else if(2==H){var $=L(e,R,31)+257,Y=L(e,R+10,15)+4,Z=$+L(e,R+5,31)+1;R+=14;for(var J=new r(Z),Q=new r(19),K=0;K<Y;++K)Q[p[K]]=L(e,R+3*K,7);R+=3*Y;var ee=y(Q),et=(1<<ee)-1,er=w(Q,ee,1);for(K=0;K<Z;){var ea,en=er[L(e,R,et)];if(R+=15&en,(ea=en>>>4)<16)J[K++]=ea;else{var eo=0,ei=0;for(16==ea?(ei=3+L(e,R,3),R+=2,eo=J[K-1]):17==ea?(ei=3+L(e,R,7),R+=3):18==ea&&(ei=11+L(e,R,127),R+=7);ei--;)J[K++]=eo}}var es=J.subarray(0,$),el=J.subarray($);V=y(es),j=y(el),W=w(es,V,1),z=w(el,j,1)}else T(1);if(R>N){P&&T(0);break}}A&&d(E+131072);for(var eu=(1<<V)-1,eh=(1<<j)-1,ef=R;;ef=R){var ed=(eo=W[U(e,R)&eu])>>>4;if((R+=15&eo)>N){P&&T(0);break}if(eo||T(2),ed<256)v[E++]=ed;else{if(256==ed){ef=R,W=null;break}var ec=ed-254;if(ed>264){var ep=u[K=ed-257];ec=L(e,R,(1<<ep)-1)+m[K],R+=ep}var ev=z[U(e,R)&eh],eg=ev>>>4;if(ev||T(3),R+=15&ev,el=b[eg],eg>3&&(ep=h[eg],el+=U(e,R)&(1<<ep)-1,R+=ep),R>N){P&&T(0);break}A&&d(E+131072);for(var ey=E+ec;E<ey;E+=4)v[E]=v[E-el],v[E+1]=v[E+1-el],v[E+2]=v[E+2-el],v[E+3]=v[E+3-el];E=ey}}S.l=W,S.p=ef,S.b=E,W&&(I=1,S.m=V,S.d=z,S.n=j)}while(!I);return E==v.length?v:(x=v,(k=0)<0&&(k=0),(null==(F=E)||F>x.length)&&(F=x.length),(C=new(x instanceof s?s:x instanceof l?l:r)(F-k)).set(x.subarray(k,F)),C)},P=new r(0),B="undefined"!=typeof TextDecoder&&new TextDecoder;try{B.decode(P,{stream:!0})}catch(e){}return e.convert_streams=function(e){var r=new DataView(e),s=0;function t(){var e=r.getUint16(s);return s+=2,e}function a(){var e=r.getUint32(s);return s+=4,e}function i(e){F.setUint16(C,e),C+=2}function o(e){F.setUint32(C,e),C+=4}for(var l={signature:a(),flavor:a(),length:a(),numTables:t(),reserved:t(),totalSfntSize:a(),majorVersion:t(),minorVersion:t(),metaOffset:a(),metaLength:a(),metaOrigLength:a(),privOffset:a(),privLength:a()},u=0;Math.pow(2,u)<=l.numTables;)u++;u--;for(var h=16*Math.pow(2,u),p=16*l.numTables-h,v=12,m=[],S=0;S<l.numTables;S++)m.push({tag:a(),offset:a(),compLength:a(),origLength:a(),origChecksum:a()}),v+=16;var b,x=new Uint8Array(12+16*m.length+m.reduce(function(e,r){return e+r.origLength+4},0)),k=x.buffer,F=new DataView(k),C=0;return o(l.flavor),i(l.numTables),i(h),i(u),i(p),m.forEach(function(e){o(e.tag),o(e.origChecksum),o(v),o(e.origLength),e.outOffset=v,(v+=e.origLength)%4!=0&&(v+=4-v%4)}),m.forEach(function(r){var s=e.slice(r.offset,r.offset+r.compLength);if(r.compLength!=r.origLength){var l=new Uint8Array(r.origLength);O(new Uint8Array(s,2),l)}else l=new Uint8Array(s);x.set(l,r.outOffset);var u=0;(v=r.outOffset+r.origLength)%4!=0&&(u=4-v%4),x.set(new Uint8Array(u).buffer,r.outOffset+r.origLength),b=v+u}),k.slice(0,b)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,r){let s;let l={M:2,L:2,Q:4,C:6,Z:0},u={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},h=[null,"isol","init","fina","medi"];function getGlyphClass(r,s){let l=r.GDEF&&r.GDEF.glyphClassDef;return l?e.U._getGlyphClass(s,l):0}function firstNum(...e){for(let r=0;r<e.length;r++)if("number"==typeof e[r])return e[r]}return function(p){let v=new Uint8Array(p,0,4),m=e._bin.readASCII(v,0,4);if("wOFF"===m)p=r(p);else if("wOF2"===m)throw Error("woff2 fonts not supported");return function(r){let p=Object.create(null),v=r["OS/2"],m=r.hhea,S=r.head.unitsPerEm,b=firstNum(v&&v.sTypoAscender,m&&m.ascender,S),x={unitsPerEm:S,ascender:b,descender:firstNum(v&&v.sTypoDescender,m&&m.descender,0),capHeight:firstNum(v&&v.sCapHeight,b),xHeight:firstNum(v&&v.sxHeight,b),lineGap:firstNum(v&&v.sTypoLineGap,m&&m.lineGap),supportsCodePoint:s=>e.U.codeToGlyph(r,s)>0,forEachGlyph(v,m,S,b){let k=0,F=1/x.unitsPerEm*m,C=function(r,l){let p=[];for(let s=0;s<l.length;s++){let u=l.codePointAt(s);u>65535&&s++,p.push(e.U.codeToGlyph(r,u))}let v=r.GSUB;if(v){let r;let{lookupList:m,featureList:S}=v,b=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,x=[];S.forEach(v=>{if(b.test(v.tag))for(let S=0;S<v.tab.length;S++){if(x[v.tab[S]])continue;x[v.tab[S]]=!0;let b=m[v.tab[S]],k=/^(isol|init|fina|medi)$/.test(v.tag);k&&!r&&(r=function(e){let r=new Uint8Array(e.length),l=32,h=1,p=-1;for(let v=0;v<e.length;v++){let m=e.codePointAt(v),S=0|function(e){if(!s){let e={R:2,L:1,D:4,C:16,U:32,T:8};for(let r in s=new Map,u){let l=0;u[r].split(",").forEach(u=>{let[h,p]=u.split("+");h=parseInt(h,36),p=p?parseInt(p,36):0,s.set(l+=h,e[r]);for(let u=p;u--;)s.set(++l,e[r])})}}return s.get(e)||32}(m),b=1;!(8&S)&&(21&l?22&S?(b=3,(1===h||3===h)&&r[p]++):33&S&&(2===h||4===h)&&r[p]--:34&l&&(2===h||4===h)&&r[p]--,h=r[v]=b,l=S,p=v,m>65535&&v++)}return r}(l));for(let s=0;s<p.length;s++)r&&k&&h[r[s]]!==v.tag||e.U._applySubs(p,s,b,m)}})}return p}(r,v),_=0,D=function(r,s){let l=new Int16Array(3*s.length),u=0;for(;u<s.length;u++){let h=s[u];if(-1===h)continue;l[3*u+2]=r.hmtx.aWidth[h];let p=r.GPOS;if(p){let v=p.lookupList;for(let p=0;p<v.length;p++){let m=v[p];for(let p=0;p<m.tabs.length;p++){let v=m.tabs[p];if(1===m.ltype){let r=e._lctf.coverageIndex(v.coverage,h);if(-1!==r&&v.pos){applyValueRecord(v.pos,u);break}}else if(2===m.ltype){let r=null,l=getPrevGlyphIndex();if(-1!==l){let p=e._lctf.coverageIndex(v.coverage,s[l]);if(-1!==p){if(1===v.fmt){let e=v.pairsets[p];for(let s=0;s<e.length;s++)e[s].gid2===h&&(r=e[s])}else if(2===v.fmt){let u=e.U._getGlyphClass(s[l],v.classDef1),p=e.U._getGlyphClass(h,v.classDef2);r=v.matrix[u][p]}if(r){r.val1&&applyValueRecord(r.val1,l),r.val2&&applyValueRecord(r.val2,u);break}}}}else if(4===m.ltype){let r=e._lctf.coverageIndex(v.markCoverage,h);if(-1!==r){let h=getPrevGlyphIndex(isBaseGlyph),p=-1===h?-1:e._lctf.coverageIndex(v.baseCoverage,s[h]);if(-1!==p){let e=v.markArray[r],s=v.baseArray[p][e.markClass];l[3*u]=s.x-e.x+l[3*h]-l[3*h+2],l[3*u+1]=s.y-e.y+l[3*h+1];break}}}else if(6===m.ltype){let p=e._lctf.coverageIndex(v.mark1Coverage,h);if(-1!==p){let h=getPrevGlyphIndex();if(-1!==h){let m=s[h];if(3===getGlyphClass(r,m)){let r=e._lctf.coverageIndex(v.mark2Coverage,m);if(-1!==r){let e=v.mark1Array[p],s=v.mark2Array[r][e.markClass];l[3*u]=s.x-e.x+l[3*h]-l[3*h+2],l[3*u+1]=s.y-e.y+l[3*h+1];break}}}}}}}}else if(r.kern&&!r.cff){let e=getPrevGlyphIndex();if(-1!==e){let u=r.kern.glyph1.indexOf(s[e]);if(-1!==u){let s=r.kern.rval[u].glyph2.indexOf(h);-1!==s&&(l[3*e+2]+=r.kern.rval[u].vals[s])}}}}return l;function getPrevGlyphIndex(e){for(let r=u-1;r>=0;r--)if(-1!==s[r]&&(!e||e(s[r])))return r;return -1}function isBaseGlyph(e){return 1===getGlyphClass(r,e)}function applyValueRecord(e,r){for(let s=0;s<3;s++)l[3*r+s]+=e[s]||0}}(r,C);return C.forEach((s,u)=>{if(-1!==s){let h=p[s];if(!h){let u,v,m,S;let{cmds:b,crds:x}=e.U.glyphToPath(r,s),k="",F=0;for(let e=0,r=b.length;e<r;e++){let r=l[b[e]];k+=b[e];for(let e=1;e<=r;e++)k+=(e>1?",":"")+x[F++]}if(x.length){u=v=1/0,m=S=-1/0;for(let e=0,r=x.length;e<r;e+=2){let r=x[e],s=x[e+1];r<u&&(u=r),s<v&&(v=s),r>m&&(m=r),s>S&&(S=s)}}else u=m=v=S=0;h=p[s]={index:s,advanceWidth:r.hmtx.aWidth[s],xMin:u,yMin:v,xMax:m,yMax:S,path:k}}b.call(null,h,k+D[3*u]*F,D[3*u+1]*F,_),k+=D[3*u+2]*F,S&&(k+=S*m)}_+=v.codePointAt(_)>65535?2:1}),k}};return x}(e.parse(p)[0])}}],init(e,r,s){let l=e(),u=r();return s(l,u)}}),x=(0,p.Ch)({name:"FontResolver",dependencies:[function(e,r){let s=Object.create(null),l=Object.create(null);function loadFont(r,u){let h=s[r];h?u(h):l[r]?l[r].push(u):(l[r]=[u],function(r,s){let onError=e=>{console.error(`Failure loading font ${r}`,e)};try{let l=new XMLHttpRequest;l.open("get",r,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status>=400)onError(Error(l.statusText));else if(l.status>0)try{let u=e(l.response);u.src=r,s(u)}catch(e){onError(e)}},l.onerror=onError,l.send()}catch(e){onError(e)}}(r,e=>{e.src=r,s[r]=e,l[r].forEach(r=>r(e)),delete l[r]}))}return function(e,l,{lang:u,fonts:h=[],style:p="normal",weight:v="normal",unicodeFontsURL:m}={}){let S=new Uint8Array(e.length),b=[];e.length||allDone();let x=new Map,k=[];if("italic"!==p&&(p="normal"),"number"!=typeof v&&(v="bold"===v?700:400),h&&!Array.isArray(h)&&(h=[h]),(h=h.slice().filter(e=>!e.lang||e.lang.test(u)).reverse()).length){let r=0;!function resolveUserFonts(l=0){for(let u=l,p=e.length;u<p;u++){let l=e.codePointAt(u);if(1===r&&b[S[u-1]].supportsCodePoint(l)||/\s/.test(e[u]))S[u]=S[u-1],2===r&&(k[k.length-1][1]=u);else for(let e=S[u],p=h.length;e<=p;e++)if(e===p){let e=2===r?k[k.length-1]:k[k.length]=[u,u];e[1]=u,r=2}else{S[u]=e;let{src:p,unicodeRange:v}=h[e];if(!v||function(e,r){for(let s=0;s<r.length;s++){let[l,u=l]=r[s];if(l<=e&&e<=u)return!0}return!1}(l,v)){let e=s[p];if(!e){loadFont(p,()=>{resolveUserFonts(u)});return}if(e.supportsCodePoint(l)){let s=x.get(e);"number"!=typeof s&&(s=b.length,b.push(e),x.set(e,s)),S[u]=s,r=1;break}}}l>65535&&u+1<p&&(S[u+1]=S[u],u++,2===r&&(k[k.length-1][1]=u))}resolveFallbacks()}()}else k.push([0,e.length-1]),resolveFallbacks();function resolveFallbacks(){if(k.length){let s=k.map(r=>e.substring(r[0],r[1]+1)).join("\n");r.getFontsForString(s,{lang:u||void 0,style:p,weight:v,dataUrl:m}).then(({fontUrls:e,chars:r})=>{let s=b.length,l=0;k.forEach(e=>{for(let u=0,h=e[1]-e[0];u<=h;u++)S[e[0]+u]=r[l++]+s;l++});let u=0;e.forEach((r,l)=>{loadFont(r,r=>{b[l+s]=r,++u===e.length&&allDone()})})})}else allDone()}function allDone(){l({chars:S,fonts:b})}}},b,/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function(){return function(e){var n=function(){this.buckets=new Map};function i(e,r){var s=255&e,l=r.codePointAt(s/6|0);return 0!=((l=(l||48)-48)&1<<s%6)}function c(e,r){!function(e,r){e.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(e){return e.split("-").map(function(e){return parseInt(e.trim(),16)})}).forEach(function(e){var s=e[0],l=e[1];void 0===l&&(l=s),r(s,l)})}(e,function(e,s){for(var l=e;l<=s;l++)r(l)})}n.prototype.add=function(e){var r=e>>5;this.buckets.set(r,(this.buckets.get(r)||0)|1<<(31&e))},n.prototype.has=function(e){var r=this.buckets.get(e>>5);return void 0!==r&&0!=(r&1<<(31&e))},n.prototype.serialize=function(){var e=[];return this.buckets.forEach(function(r,s){e.push((+s).toString(36)+":"+r.toString(36))}),e.join(",")},n.prototype.deserialize=function(e){var r=this;this.buckets.clear(),e.split(",").forEach(function(e){var s=e.split(":");r.buckets.set(parseInt(s[0],36),parseInt(s[1],36))})};var r,s={},l={},u=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data",p=new Map;function g(e,r,s){return e[r]?r:e[s]?s:function(e){for(var r in e)return r}(e)}return e.CodePointSet=n,e.clearCache=function(){s={},l={}},e.getFontsForString=function(e,v){void 0===v&&(v={});var m=v.lang;void 0===m&&(m=/\p{Script=Hangul}/u.test(e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(e)?"ja":"en");var S=v.category;void 0===S&&(S="sans-serif");var b=v.style;void 0===b&&(b="normal");var x=v.weight;void 0===x&&(x=400);var k=(v.dataUrl||h).replace(/\/$/g,""),F=new Map,C=new Uint8Array(e.length),_={},D={},G=Array(e.length),A=new Map,P=!1;function M(e){var r=p.get(e);return r||(r=fetch(k+"/"+e).then(function(e){if(!e.ok)throw Error(e.statusText);return e.json().then(function(e){if(!Array.isArray(e)||1!==e[0])throw Error("Incorrect schema version; need 1, got "+e[0]);return e[1]})}).catch(function(r){if(k!==h)return P||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+k+'", trying default CDN. '+r.message),P=!0),k=h,p.delete(e),M(e);throw r}),p.set(e,r)),r}for(var B=0;B<e.length;B++)(function(r){var l=e.codePointAt(r),u=function(e){var r=(-256&e).toString(16),s=((-256&e)+256-1).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+r+"-"+s+".json"}(l);G[r]=u,s[u]||A.has(u)||A.set(u,M(u).then(function(e){s[u]=e})),l>65535&&(B=++r)})(B);return Promise.all(A.values()).then(function(){A.clear();for(var r=0;r<e.length;r++)(function(u){var h=e.codePointAt(u),p=null,v=s[G[u]],S=void 0;for(var b in v){var x=D[b];if(void 0===x&&(x=D[b]=new RegExp(b).test(m||"en")),x){for(var k in S=b,v[b])if(i(h,v[b][k])){p=k;break}break}}if(!p){e:for(var F in v)if(F!==S){for(var C in v[F])if(i(h,v[F][C])){p=C;break e}}}p||(console.debug("No font coverage for U+"+h.toString(16)),p="latin"),G[u]=p,l[p]||A.has(p)||A.set(p,M("font-meta/"+p+".json").then(function(e){l[p]=e})),h>65535&&(r=++u)})(r);return Promise.all(A.values())}).then(function(){for(var s,h=null,p=0;p<e.length;p++){var v=e.codePointAt(p);if(h&&(r||(r=new Set,c("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(e){r.add(e)})),r.has(v)||(function(e){var r=u.get(e);return r||(r=new n,c(e.ranges,function(e){return r.add(e)}),u.set(e,r)),r})(h).has(v)))C[p]=C[p-1];else{var m=_[(h=l[G[p]]).id];if(!m){var D=h.typeforms,A=g(D,S,"sans-serif"),P=g(D[A],b,"normal"),B=function(e,r){var s=r;if(!e.includes(s)){s=1/0;for(var l=0;l<e.length;l++)Math.abs(e[l]-r)<Math.abs(s-r)&&(s=e[l])}return s}(null===(s=D[A])||void 0===s?void 0:s[P],x);m=_[h.id]=k+"/font-files/"+h.id+"/"+A+"."+P+"."+B+".woff"}var I=F.get(m);null==I&&(I=F.size,F.set(m,I)),C[p]=I}v>65535&&(C[++p]=C[p-1])}return{fontUrls:Array.from(F.keys()),chars:C}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,r,s)=>e(r,s())}),now=()=>(self.performance||Date).now(),k=(0,v.Z)(),F=[],C=0;function nextChunk(){let e=now();for(;F.length&&now()-e<5;)F.shift()();C=F.length?setTimeout(nextChunk,0):0}let generateSDF_GL=(...e)=>new Promise((r,s)=>{F.push(()=>{let l=now();try{k.webgl.generateIntoCanvas(...e),r({timing:now()-l})}catch(e){s(e)}}),C||(C=setTimeout(nextChunk,0))}),_={},D=0;function generateSDF_JS_Worker(e,r,s,l,u,h,m,S,b,x){let F="TroikaTextSDFGenerator_JS_"+D++%4,C=_[F];return C||(C=_[F]={workerModule:(0,p.Ch)({name:F,workerId:F,dependencies:[v.Z,now],init(e,r){let s=e().javascript.generate;return function(...e){let l=r(),u=s(...e);return{textureData:u,timing:r()-l}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),C.requests++,clearTimeout(C.idleTimer),C.workerModule(e,r,s,l,u,h).then(({textureData:s,timing:l})=>{let u=now(),h=new Uint8Array(4*s.length);for(let e=0;e<s.length;e++)h[4*e+x]=s[e];return k.webglUtils.renderImageData(m,h,S,b,e,r,1<<3-x),l+=now()-u,0==--C.requests&&(C.idleTimer=setTimeout(()=>{(0,p.Ae)(F)},2e3)),{timing:l}})}let G=k.webglUtils.resizeWebGLCanvasWithoutClearing,A={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},P=new h.Color;function now$1(){return(self.performance||Date).now()}let B=Object.create(null);function getTextRenderInfo(e,r){e=function(e,r){for(let s in r)r.hasOwnProperty(s)&&(e[s]=r[s]);return e}({},e);let s=now$1(),{defaultFontURL:l}=A,u=[];if(l&&u.push({label:"default",src:toAbsoluteURL(l)}),e.font&&u.push({label:"user",src:toAbsoluteURL(e.font)}),e.font=u,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||A.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||A.unicodeFontsURL,null!=e.colorRanges){let r={};for(let s in e.colorRanges)if(e.colorRanges.hasOwnProperty(s)){let l=e.colorRanges[s];"number"!=typeof l&&(l=P.set(l).getHex()),r[s]=l}e.colorRanges=r}Object.freeze(e);let{textureWidth:p,sdfExponent:v}=A,{sdfGlyphSize:m}=e,S=p/m*4,b=B[m];if(!b){let e=document.createElement("canvas");e.width=p,e.height=256*m/S,(b=B[m]={glyphCount:0,sdfGlyphSize:m,sdfCanvas:e,sdfTexture:new h.Texture(e,void 0,void 0,void 0,h.LinearFilter,h.LinearFilter),contextLost:!1,glyphsByFont:new Map}).sdfTexture.generateMipmaps=!1,function(e){let r=e.sdfCanvas;r.addEventListener("webglcontextlost",r=>{console.log("Context Lost",r),r.preventDefault(),e.contextLost=!0}),r.addEventListener("webglcontextrestored",r=>{console.log("Context Restored",r),e.contextLost=!1;let s=[];e.glyphsByFont.forEach(r=>{r.forEach(r=>{s.push(generateGlyphSDF(r,e,!0))})}),Promise.all(s).then(()=>{safariPre15Workaround(e),e.sdfTexture.needsUpdate=!0})})}(b)}let{sdfTexture:x,sdfCanvas:F}=b;R(e).then(l=>{let{glyphIds:u,glyphFontIndices:h,fontData:k,glyphPositions:C,fontSize:_,timings:D}=l,P=[],B=new Float32Array(4*u.length),I=0,R=0,E=now$1(),W=k.map(e=>{let r=b.glyphsByFont.get(e.src);return r||b.glyphsByFont.set(e.src,r=new Map),r});u.forEach((e,r)=>{let s=h[r],{src:p,unitsPerEm:v}=k[s],S=W[s].get(e);if(!S){let{path:r,pathBounds:u}=l.glyphData[p][e],h=Math.max(u[2]-u[0],u[3]-u[1])/m*(A.sdfMargin*m+.5),v=b.glyphCount++,x=[u[0]-h,u[1]-h,u[2]+h,u[3]+h];W[s].set(e,S={path:r,atlasIndex:v,sdfViewBox:x}),P.push(S)}let{sdfViewBox:x}=S,F=C[R++],D=C[R++],G=_/v;B[I++]=F+x[0]*G,B[I++]=D+x[1]*G,B[I++]=F+x[2]*G,B[I++]=D+x[3]*G,u[r]=S.atlasIndex}),D.quads=(D.quads||0)+(now$1()-E);let z=now$1();D.sdf={};let V=F.height,j=Math.ceil(b.glyphCount/S),N=Math.pow(2,Math.ceil(Math.log2(j*m)));N>V&&(console.info(`Increasing SDF texture size ${V}->${N}`),G(F,p,N),x.dispose()),Promise.all(P.map(r=>generateGlyphSDF(r,b,e.gpuAccelerateSDF).then(({timing:e})=>{D.sdf[r.atlasIndex]=e}))).then(()=>{P.length&&!b.contextLost&&(safariPre15Workaround(b),x.needsUpdate=!0),D.sdfTotal=now$1()-z,D.total=now$1()-s,r(Object.freeze({parameters:e,sdfTexture:x,sdfGlyphSize:m,sdfExponent:v,glyphBounds:B,glyphAtlasIndices:u,glyphColors:l.glyphColors,caretPositions:l.caretPositions,chunkedBounds:l.chunkedBounds,ascender:l.ascender,descender:l.descender,lineHeight:l.lineHeight,capHeight:l.capHeight,xHeight:l.xHeight,topBaseline:l.topBaseline,blockBounds:l.blockBounds,visibleBounds:l.visibleBounds,timings:l.timings}))})}),Promise.resolve().then(()=>{!b.contextLost&&(F._warm||(k.webgl.isSupported(F),F._warm=!0))})}function generateGlyphSDF({path:e,atlasIndex:r,sdfViewBox:s},{sdfGlyphSize:u,sdfCanvas:h,contextLost:p},v){if(p)return Promise.resolve({timing:-1});let{textureWidth:m,sdfExponent:S}=A,b=Math.max(s[2]-s[0],s[3]-s[1]),x=Math.floor(r/4),k=x%(m/u)*u,F=Math.floor(x/(m/u))*u;return function(e,r,s,u,h,p,v,m,S,b,x=!0){return x?generateSDF_GL(e,r,s,u,h,p,v,m,S,b).then(null,x=>(l||(console.warn("WebGL SDF generation failed, falling back to JS",x),l=!0),generateSDF_JS_Worker(e,r,s,u,h,p,v,m,S,b))):generateSDF_JS_Worker(e,r,s,u,h,p,v,m,S,b)}(u,u,e,s,b,S,h,k,F,r%4,v)}function preloadFont({font:e,characters:r,sdfGlyphSize:s},l){getTextRenderInfo({font:e,sdfGlyphSize:s,text:Array.isArray(r)?r.join("\n"):""+r},l)}function toAbsoluteURL(e){return u||(u="undefined"==typeof document?{}:document.createElement("a")),u.href=e,u.href}function safariPre15Workaround(e){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");let{sdfCanvas:r,sdfTexture:s}=e,{width:l,height:u}=r,h=e.sdfCanvas.getContext("webgl"),p=s.image.data;p&&p.length===l*u*4||(p=new Uint8Array(l*u*4),s.image={width:l,height:u,data:p},s.flipY=!1,s.isDataTexture=!0),h.readPixels(0,0,l,u,h.RGBA,h.UNSIGNED_BYTE,p)}}let I=(0,p.Ch)({name:"Typesetter",dependencies:[function(e,r){let s=1/0,l=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,u=`[^\\S\\u00A0]`,h=RegExp(`${u}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function typeset({text:p="",font:v,lang:m,sdfGlyphSize:S=64,fontSize:b=400,fontWeight:x=1,fontStyle:k="normal",letterSpacing:F=0,lineHeight:C="normal",maxWidth:_=s,direction:D,textAlign:G="left",textIndent:A=0,whiteSpace:P="normal",overflowWrap:B="normal",anchorX:I=0,anchorY:R=0,metricsOnly:E=!1,unicodeFontsURL:W,preResolvedFonts:z=null,includeCaretPositions:V=!1,chunkedBoundsSize:j=8192,colorRanges:N=null},H){let X=now(),q={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),b=+b,F=+F,_=+_,C=C||"normal",A=+A,function({text:r,lang:s,fonts:l,style:u,weight:h,preResolvedFonts:p,unicodeFontsURL:v},m){let onResolved=({chars:e,fonts:r})=>{let s,l;let u=[];for(let h=0;h<e.length;h++)e[h]!==l?(l=e[h],u.push(s={start:h,end:h,fontObj:r[e[h]]})):s.end=h;m(u)};p?onResolved(p):e(r,onResolved,{lang:s,fonts:l,style:u,weight:h,unicodeFontsURL:v})}({text:p,lang:m,style:k,weight:x,fonts:"string"==typeof v?[{src:v}]:v,unicodeFontsURL:W,preResolvedFonts:z},e=>{q.fontLoad=now()-X;let v=isFinite(_),m=null,S=null,x=null,k=null,W=null,z=null,$=null,Y=null,Z=0,J=0,Q="nowrap"!==P,K=new Map,ee=now(),et=A,er=0,ea=new TextLine,en=[ea];e.forEach(e=>{let r,s;let{fontObj:m}=e,{ascender:S,descender:x,unitsPerEm:k,lineGap:D,capHeight:G,xHeight:P}=m,I=K.get(m);if(!I){let e=b/k,r="normal"===C?(S-x+D)*e:C*b,s=(r-(S-x)*e)/2,l=Math.min(r,(S-x)*e),u=(S+x)/2*e+l/2;I={index:K.size,src:m.src,fontObj:m,fontSizeMult:e,unitsPerEm:k,ascender:S*e,descender:x*e,capHeight:G*e,xHeight:P*e,lineHeight:r,baseline:-s-S*e,caretTop:u,caretBottom:u-l},K.set(m,I)}let{fontSizeMult:R}=I,E=p.slice(e.start,e.end+1);m.forEachGlyph(E,b,F,(m,S,x,k)=>{let C;S+=er,k+=e.start,r=S,s=m;let D=p.charAt(k),G=m.advanceWidth*R,P=ea.count;if("isEmpty"in m||(m.isWhitespace=!!D&&new RegExp(u).test(D),m.canBreakAfter=!!D&&h.test(D),m.isEmpty=m.xMin===m.xMax||m.yMin===m.yMax||l.test(D)),!m.isWhitespace&&!m.isEmpty&&J++,Q&&v&&!m.isWhitespace&&S+G+et>_&&P){if(ea.glyphAt(P-1).glyphObj.canBreakAfter)C=new TextLine,et=-S;else for(let e=P;e--;){if(0===e&&"break-word"===B){C=new TextLine,et=-S;break}if(ea.glyphAt(e).glyphObj.canBreakAfter){C=ea.splitAt(e+1);let r=C.glyphAt(0).x;et-=r;for(let e=C.count;e--;)C.glyphAt(e).x-=r;break}}C&&(ea.isSoftWrapped=!0,ea=C,en.push(ea),Z=_)}let E=ea.glyphAt(ea.count);E.glyphObj=m,E.x=S+et,E.y=x,E.width=G,E.charIndex=k,E.fontData=I,"\n"===D&&(ea=new TextLine,en.push(ea),et=-(S+G+F*b)+A)}),er=r+s.advanceWidth*R+F*b});let eo=0;en.forEach(e=>{let r=!0;for(let s=e.count;s--;){let l=e.glyphAt(s);r&&!l.glyphObj.isWhitespace&&(e.width=l.x+l.width,e.width>Z&&(Z=e.width),r=!1);let{lineHeight:u,capHeight:h,xHeight:p,baseline:v}=l.fontData;u>e.lineHeight&&(e.lineHeight=u);let m=v-e.baseline;m<0&&(e.baseline+=m,e.cap+=m,e.ex+=m),e.cap=Math.max(e.cap,e.baseline+h),e.ex=Math.max(e.ex,e.baseline+p)}e.baseline-=eo,e.cap-=eo,e.ex-=eo,eo+=e.lineHeight});let ei=0,es=0;if(I&&("number"==typeof I?ei=-I:"string"==typeof I&&(ei=-Z*("left"===I?0:"center"===I?.5:"right"===I?1:parsePercent(I)))),R&&("number"==typeof R?es=-R:"string"==typeof R&&(es="top"===R?0:"top-baseline"===R?-en[0].baseline:"top-cap"===R?-en[0].cap:"top-ex"===R?-en[0].ex:"middle"===R?eo/2:"bottom"===R?eo:"bottom-baseline"===R?-en[en.length-1].baseline:parsePercent(R)*eo)),!E){let e,l;let u=r.getEmbeddingLevels(p,D);m=new Uint16Array(J),S=new Uint8Array(J),x=new Float32Array(2*J),k={},$=[s,s,-s,-s],Y=[],V&&(z=new Float32Array(4*p.length)),N&&(W=new Uint8Array(3*J));let h=0,v=-1,b=-1;if(en.forEach((F,C)=>{let{count:_,width:D}=F;if(_>0){let C,A=0;for(let e=_;e--&&F.glyphAt(e).glyphObj.isWhitespace;)A++;let P=0,B=0;if("center"===G)P=(Z-D)/2;else if("right"===G)P=Z-D;else if("justify"===G&&F.isSoftWrapped){let e=0;for(let r=_-A;r--;)F.glyphAt(r).glyphObj.isWhitespace&&e++;B=(Z-D)/e}if(B||P){let e=0;for(let r=0;r<_;r++){let s=F.glyphAt(r),l=s.glyphObj;s.x+=P+e,0!==B&&l.isWhitespace&&r<_-A&&(e+=B,s.width+=B)}}let I=r.getReorderSegments(p,u,F.glyphAt(0).charIndex,F.glyphAt(F.count-1).charIndex);for(let e=0;e<I.length;e++){let[r,s]=I[e],l=1/0,u=-1/0;for(let e=0;e<_;e++)if(F.glyphAt(e).charIndex>=r){let r=e,h=e;for(;h<_;h++){let e=F.glyphAt(h);if(e.charIndex>s)break;h<_-A&&(l=Math.min(l,e.x),u=Math.max(u,e.x+e.width))}for(let e=r;e<h;e++){let r=F.glyphAt(e);r.x=u-(r.x+r.width-l)}break}}let setGlyphObj=e=>C=e;for(let D=0;D<_;D++){let _=F.glyphAt(D);C=_.glyphObj;let G=C.index,A=1&u.levels[_.charIndex];if(A){let e=r.getMirroredCharacter(p[_.charIndex]);e&&_.fontData.fontObj.forEachGlyph(e,0,0,setGlyphObj)}if(V){let{charIndex:e,fontData:r}=_,s=_.x+ei,l=_.x+_.width+ei;z[4*e]=A?l:s,z[4*e+1]=A?s:l,z[4*e+2]=F.baseline+r.caretBottom+es,z[4*e+3]=F.baseline+r.caretTop+es;let u=e-v;u>1&&fillLigatureCaretPositions(z,v,u),v=e}if(N){let{charIndex:e}=_;for(;e>b;)b++,N.hasOwnProperty(b)&&(l=N[b])}if(!C.isWhitespace&&!C.isEmpty){let r=h++,{fontSizeMult:u,src:p,index:v}=_.fontData,b=k[p]||(k[p]={});b[G]||(b[G]={path:C.path,pathBounds:[C.xMin,C.yMin,C.xMax,C.yMax]});let D=_.x+ei,A=_.y+F.baseline+es;x[2*r]=D,x[2*r+1]=A;let P=D+C.xMin*u,B=A+C.yMin*u,I=D+C.xMax*u,R=A+C.yMax*u;P<$[0]&&($[0]=P),B<$[1]&&($[1]=B),I>$[2]&&($[2]=I),R>$[3]&&($[3]=R),r%j==0&&(e={start:r,end:r,rect:[s,s,-s,-s]},Y.push(e)),e.end++;let E=e.rect;if(P<E[0]&&(E[0]=P),B<E[1]&&(E[1]=B),I>E[2]&&(E[2]=I),R>E[3]&&(E[3]=R),m[r]=G,S[r]=v,N){let e=3*r;W[e]=l>>16&255,W[e+1]=l>>8&255,W[e+2]=255&l}}}}}),z){let e=p.length-v;e>1&&fillLigatureCaretPositions(z,v,e)}}let el=[];K.forEach(({index:e,src:r,unitsPerEm:s,ascender:l,descender:u,lineHeight:h,capHeight:p,xHeight:v})=>{el[e]={src:r,unitsPerEm:s,ascender:l,descender:u,lineHeight:h,capHeight:p,xHeight:v}}),q.typesetting=now()-ee,H({glyphIds:m,glyphFontIndices:S,glyphPositions:x,glyphData:k,fontData:el,caretPositions:z,glyphColors:W,chunkedBounds:Y,fontSize:b,topBaseline:es+en[0].baseline,blockBounds:[ei,es-eo,ei+Z,es],visibleBounds:$,timings:q})})}function parsePercent(e){let r=e.match(/^([\d.]+)%$/),s=r?parseFloat(r[1]):NaN;return isNaN(s)?0:s/100}function fillLigatureCaretPositions(e,r,s){let l=e[4*r],u=e[4*r+1],h=e[4*r+2],p=e[4*r+3],v=(u-l)/s;for(let u=0;u<s;u++){let s=(r+u)*4;e[s]=l+v*u,e[s+1]=l+v*(u+1),e[s+2]=h,e[s+3]=p}}function now(){return(self.performance||Date).now()}function TextLine(){this.data=[]}let p=["glyphObj","x","y","width","charIndex","fontData"];return TextLine.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(e){let r=TextLine.flyweight;return r.data=this.data,r.index=e,r},splitAt(e){let r=new TextLine;return r.data=this.data.splice(e*p.length),r}},TextLine.flyweight=p.reduce((e,r,s,l)=>(Object.defineProperty(e,r,{get(){return this.data[this.index*p.length+s]},set(e){this.data[this.index*p.length+s]=e}}),e),{data:null,index:0}),{typeset,measure:function(e,r){typeset({...e,metricsOnly:!0},e=>{let[s,l,u,h]=e.blockBounds;r({width:u-s,height:h-l})})}}},x,m.Z],init:(e,r,s)=>e(r,s())}),R=(0,p.Ch)({name:"Typesetter",dependencies:[I],init:e=>function(r){return new Promise(s=>{e.typeset(r,s)})},getTransferables(e){let r=[];for(let s in e)e[s]&&e[s].buffer&&r.push(e[s].buffer);return r}}),E={},W="aTroikaGlyphIndex";let GlyphsGeometry=class GlyphsGeometry extends h.InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new h.Sphere,this.boundingBox=new h.Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){let r=this.getIndex().count;this.setDrawRange(e===h.BackSide?r/2:0,e===h.DoubleSide?r:r/2)}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let r=function(e){let r=E[e];if(!r){let s=new h.PlaneGeometry(1,1,e,e),l=s.clone(),u=s.attributes,p=l.attributes,v=new h.BufferGeometry,m=u.uv.count;for(let e=0;e<m;e++)p.position.array[3*e]*=-1,p.normal.array[3*e+2]*=-1;["position","normal","uv"].forEach(e=>{v.setAttribute(e,new h.Float32BufferAttribute([...u[e].array,...p[e].array],u[e].itemSize))}),v.setIndex([...s.index.array,...l.index.array.map(e=>e+m)]),v.translate(.5,.5,0),r=E[e]=v}return r}(e);["position","normal","uv"].forEach(e=>{this.attributes[e]=r.attributes[e].clone()}),this.setIndex(r.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,r,s,l,u){updateBufferAttr(this,"aTroikaGlyphBounds",e,4),updateBufferAttr(this,W,r,1),updateBufferAttr(this,"aTroikaGlyphColor",u,3),this._blockBounds=s,this._chunkedBounds=l,this.instanceCount=r.length,this._updateBounds()}_updateBounds(){let e=this._blockBounds;if(e){let{curveRadius:r,boundingBox:s}=this;if(r){let{PI:l,floor:u,min:h,max:p,sin:v,cos:m}=Math,S=l/2,b=2*l,x=Math.abs(r),k=e[0]/x,F=e[2]/x,C=u((k+S)/b)!==u((F+S)/b)?-x:h(v(k)*x,v(F)*x),_=u((k-S)/b)!==u((F-S)/b)?x:p(v(k)*x,v(F)*x),D=u((k+l)/b)!==u((F+l)/b)?2*x:p(x-m(k)*x,x-m(F)*x);s.min.set(C,e[1],r<0?-D:0),s.max.set(_,e[3],r<0?0:D)}else s.min.set(e[0],e[1],0),s.max.set(e[2],e[3],0);s.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let r=this.getAttribute(W).count,s=this._chunkedBounds;if(s)for(let l=s.length;l--;){r=s[l].end;let u=s[l].rect;if(u[1]<e.w&&u[3]>e.y&&u[0]<e.z&&u[2]>e.x)break}this.instanceCount=r}};function updateBufferAttr(e,r,s,l){let u=e.getAttribute(r);s?u&&u.array.length===s.length?(u.array.set(s),u.needsUpdate=!0):(e.setAttribute(r,new h.InstancedBufferAttribute(s,l)),delete e._maxInstanceCount,e.dispose()):u&&e.deleteAttribute(r)}let z=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,V=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,j=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,N=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`,H=new h.MeshBasicMaterial({color:16777215,side:h.DoubleSide,transparent:!0}),X=new h.Matrix4,q=new h.Vector3,$=new h.Vector3,Y=[],Z=new h.Vector3,J="+x+y";function first(e){return Array.isArray(e)?e[0]:e}let getFlatRaycastMesh=()=>{let e=new h.Mesh(new h.PlaneGeometry(1,1),H);return getFlatRaycastMesh=()=>e,e},getCurvedRaycastMesh=()=>{let e=new h.Mesh(new h.PlaneGeometry(1,1,32,1),H);return getCurvedRaycastMesh=()=>e,e},Q={type:"syncstart"},K={type:"synccomplete"},ee=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],et=ee.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Text=class Text extends h.Mesh{constructor(){let e=new GlyphsGeometry;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=J,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(Q),getTextRenderInfo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},r=>{this._isSyncing=!1,this._textRenderInfo=r,this.geometry.updateGlyphs(r.glyphBounds,r.glyphAtlasIndices,r.blockBounds,r.chunkedBounds,r.glyphColors);let s=this._queuedSyncs;s&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{s.forEach(e=>e&&e())})),this.dispatchEvent(K),e&&e()})))}onBeforeRender(e,r,s,l,u,p){this.sync(),u.isTroikaTextMaterial&&this._prepareForRender(u),u._hadOwnSide=u.hasOwnProperty("side"),this.geometry.setSide(u._actualSide=u.side),u.side=h.FrontSide}onAfterRender(e,r,s,l,u,h){u._hadOwnSide?u.side=u._actualSide:delete u.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial,r=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=H.clone());if(e&&e.baseMaterial===r||(e=this._derivedMaterial=function(e){let r=(0,S.B$)(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new h.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new h.Vector4(0,0,0,0)},uTroikaClipRect:{value:new h.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new h.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new h.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new h.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:z,vertexTransform:V,fragmentDefs:j,fragmentColorTransform:N,customRewriter({vertexShader:e,fragmentShader:r}){let s=/\buniform\s+vec3\s+diffuse\b/;return s.test(r)&&(r=r.replace(s,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),s.test(e)||(e=e.replace(S.MW,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:r}}});return r.transparent=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}(r),r.addEventListener("dispose",function onDispose(){r.removeEventListener("dispose",onDispose),e.dispose()})),!this.outlineWidth&&!this.outlineBlur&&!this.outlineOffsetX&&!this.outlineOffsetY)return e;{let r=e._outlineMtl;return r||((r=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}})).isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,e.addEventListener("dispose",function onDispose(){e.removeEventListener("dispose",onDispose),r.dispose()})),[r,e]}}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(e){let r=e.isTextOutlineMaterial,s=e.uniforms,l=this.textRenderInfo;if(l){let e,u,h;let{sdfTexture:p,blockBounds:v}=l;s.uTroikaSDFTexture.value=p,s.uTroikaSDFTextureSize.value.set(p.image.width,p.image.height),s.uTroikaSDFGlyphSize.value=l.sdfGlyphSize,s.uTroikaSDFExponent.value=l.sdfExponent,s.uTroikaTotalBounds.value.fromArray(v),s.uTroikaUseGlyphColors.value=!r&&!!l.glyphColors;let m=0,S=0,b=0,x=0,k=0;if(r){let{outlineWidth:r,outlineOffsetX:s,outlineOffsetY:l,outlineBlur:u,outlineOpacity:h}=this;m=this._parsePercent(r)||0,S=Math.max(0,this._parsePercent(u)||0),e=h,x=this._parsePercent(s)||0,k=this._parsePercent(l)||0}else(b=Math.max(0,this._parsePercent(this.strokeWidth)||0))&&(h=this.strokeColor,s.uTroikaStrokeColor.value.set(null==h?8421504:h),null==(u=this.strokeOpacity)&&(u=1)),e=this.fillOpacity;s.uTroikaDistanceOffset.value=m,s.uTroikaPositionOffset.value.set(x,k),s.uTroikaBlurRadius.value=S,s.uTroikaStrokeWidth.value=b,s.uTroikaStrokeOpacity.value=u,s.uTroikaFillOpacity.value=null==e?1:e,s.uTroikaCurveRadius.value=this.curveRadius||0;let F=this.clipRect;if(F&&Array.isArray(F)&&4===F.length)s.uTroikaClipRect.value.fromArray(F);else{let e=100*(this.fontSize||.1);s.uTroikaClipRect.value.set(v[0]-e,v[1]-e,v[2]+e,v[3]+e)}this.geometry.applyClipRect(s.uTroikaClipRect.value)}s.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;let u=r?this.outlineColor||0:this.color;if(null==u)delete e.color;else{let r=e.hasOwnProperty("color")?e.color:e.color=new h.Color;(u!==r._input||"object"==typeof u)&&r.set(r._input=u)}let p=this.orientation||J;if(p!==e._orientation){let r=s.uTroikaOrient.value,l=(p=p.replace(/[^-+xyz]/g,""))!==J&&p.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,e,s,u,h]=l;q.set(0,0,0)[s]="-"===e?1:-1,$.set(0,0,0)[h]="-"===u?-1:1,X.lookAt(Z,q.cross($),$),r.setFromMatrix4(X)}else r.identity();e._orientation=p}}_parsePercent(e){if("string"==typeof e){let r=e.match(/^(-?[\d.]+)%$/),s=r?parseFloat(r[1]):NaN;e=(isNaN(s)?0:s/100)*this.fontSize}return e}localPositionToTextCoords(e,r=new h.Vector2){r.copy(e);let s=this.curveRadius;return s&&(r.x=Math.atan2(e.x,Math.abs(s)-Math.abs(e.z))*Math.abs(s)),r}worldPositionToTextCoords(e,r=new h.Vector2){return q.copy(e),this.localPositionToTextCoords(this.worldToLocal(q),r)}raycast(e,r){let{textRenderInfo:s,curveRadius:l}=this;if(s){let u=s.blockBounds,h=l?getCurvedRaycastMesh():getFlatRaycastMesh(),p=h.geometry,{position:v,uv:m}=p.attributes;for(let e=0;e<m.count;e++){let r=u[0]+m.getX(e)*(u[2]-u[0]),s=u[1]+m.getY(e)*(u[3]-u[1]),h=0;l&&(h=l-Math.cos(r/l)*l,r=Math.sin(r/l)*l),v.setXYZ(e,r,s,h)}p.boundingSphere=this.geometry.boundingSphere,p.boundingBox=this.geometry.boundingBox,h.matrixWorld=this.matrixWorld,h.material.side=this.material.side,Y.length=0,h.raycast(e,Y);for(let e=0;e<Y.length;e++)Y[e].object=this,r.push(Y[e])}}copy(e){let r=this.geometry;return super.copy(e),this.geometry=r,et.forEach(r=>{this[r]=e[r]}),this}clone(){return new this.constructor().copy(this)}};ee.forEach(e=>{let r="_private_"+e;Object.defineProperty(Text.prototype,e,{get(){return this[r]},set(e){e!==this[r]&&(this[r]=e,this._needsSync=!0)}})}),new WeakMap,new WeakMap}}]);