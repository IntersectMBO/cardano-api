<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | Handling of JavaScript foreign imports/exports</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html"><span class="hs-identifier">GHC.HsToCore.Foreign.JavaScript</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsImport"><span class="hs-identifier">dsJsImport</span></a></span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExport"><span class="hs-identifier">dsJsFExport</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExportDynamic"><span class="hs-identifier">dsJsFExportDynamic</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.Call.html"><span class="hs-identifier">GHC.HsToCore.Foreign.Call</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.Prim.html"><span class="hs-identifier">GHC.HsToCore.Foreign.Prim</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.Utils.html"><span class="hs-identifier">GHC.HsToCore.Foreign.Utils</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html"><span class="hs-identifier">GHC.HsToCore.Utils</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unfold.Make.html"><span class="hs-identifier">GHC.Core.Unfold.Make</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html"><span class="hs-identifier">GHC.Types.ForeignStubs</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html"><span class="hs-identifier">GHC.Types.ForeignCall</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html"><span class="hs-identifier">GHC.Cmm.Expr</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.JS.Ppr.html"><span class="hs-identifier">GHC.JS.Ppr</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.html"><span class="hs-identifier">GHC.Driver.Config</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.10.2-inplace/src/GHC.Utils.Encoding.html"><span class="hs-identifier">GHC.Utils.Encoding</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExport"><span class="hs-identifier hs-type">dsJsFExport</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>                 </span><span class="hs-comment">-- Either the exported Id,</span><span>
</span><span id="line-69"></span><span>                        </span><span class="hs-comment">-- or the foreign-export-dynamic constructor</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>           </span><span class="hs-comment">-- Coercion between the Haskell type callable</span><span>
</span><span id="line-71"></span><span>                        </span><span class="hs-comment">-- from C, and its representation type</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CLabelString"><span class="hs-identifier hs-type">CLabelString</span></a></span><span>       </span><span class="hs-comment">-- The name to export to C land</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>               </span><span class="hs-comment">-- True =&gt; foreign export dynamic</span><span>
</span><span id="line-75"></span><span>                        </span><span class="hs-comment">--         so invoke IO action that's hanging off</span><span>
</span><span id="line-76"></span><span>                        </span><span class="hs-comment">--         the first argument's stable pointer</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span>      </span><span class="hs-comment">-- contents of Module_stub.h</span><span>
</span><span id="line-78"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span>        </span><span class="hs-comment">-- contents of Module_stub.c</span><span>
</span><span id="line-79"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>       </span><span class="hs-comment">-- string describing type to pass to createAdj.</span><span>
</span><span id="line-80"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>          </span><span class="hs-comment">-- size of args to stub function</span><span>
</span><span id="line-81"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span id="dsJsFExport"><span class="annot"><span class="annottext">dsJsFExport :: Id
-&gt; Coercion
-&gt; CLabelString
-&gt; CCallConv
-&gt; Bool
-&gt; DsM (CHeader, CStub, String, Arity)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExport"><span class="hs-identifier hs-var hs-var">dsJsFExport</span></a></span></span><span> </span><span id="local-6989586621682917614"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917614"><span class="hs-identifier hs-var">fn_id</span></a></span></span><span> </span><span id="local-6989586621682917615"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917615"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682917616"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917616"><span class="hs-identifier hs-var">ext_name</span></a></span></span><span> </span><span id="local-6989586621682917617"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917617"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span id="local-6989586621682917618"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917618"><span class="hs-identifier hs-var">isDyn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-85"></span><span>       </span><span id="local-6989586621682917619"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682917619"><span class="hs-identifier hs-var hs-var hs-var">ty</span></a></span></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917615"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-86"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682917621"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917621"><span class="hs-identifier hs-var hs-var">_tvs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682917622"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917622"><span class="hs-identifier hs-var hs-var">sans_foralls</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Id], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVars"><span class="hs-identifier hs-var">tcSplitForAllTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917619"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-87"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682917624"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917624"><span class="hs-identifier hs-var hs-var">fe_arg_tys'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917625"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917625"><span class="hs-identifier hs-var hs-var">orig_res_ty</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917622"><span class="hs-identifier hs-var">sans_foralls</span></a></span><span>
</span><span id="line-88"></span><span>       </span><span class="hs-comment">-- We must use tcSplits here, because we want to see</span><span>
</span><span id="line-89"></span><span>       </span><span class="hs-comment">-- the (IO t) in the corner of the type!</span><span>
</span><span id="line-90"></span><span>       </span><span id="local-6989586621682917627"><span class="annot"><span class="annottext">fe_arg_tys :: [Scaled Type]
</span><a href="#local-6989586621682917627"><span class="hs-identifier hs-var hs-var hs-var">fe_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917618"><span class="hs-identifier hs-var">isDyn</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; [Scaled Type]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="GHC.Prelude.Basic.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917624"><span class="hs-identifier hs-var">fe_arg_tys'</span></a></span><span>
</span><span id="line-91"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917624"><span class="hs-identifier hs-var">fe_arg_tys'</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>       </span><span class="hs-comment">-- Look at the result type of the exported function, orig_res_ty</span><span>
</span><span id="line-94"></span><span>       </span><span class="hs-comment">-- If it's IO t, return         (t, True)</span><span>
</span><span id="line-95"></span><span>       </span><span class="hs-comment">-- If it's plain t, return      (t, False)</span><span>
</span><span id="line-96"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682917629"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917629"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917630"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917630"><span class="hs-identifier hs-var hs-var">is_IO_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917625"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-97"></span><span>                                </span><span class="hs-comment">-- The function already returns IO t</span><span>
</span><span id="line-98"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682917632"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917632"><span class="hs-identifier hs-var">_ioTyCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917633"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917633"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917633"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>                                </span><span class="hs-comment">-- The function returns t</span><span>
</span><span id="line-100"></span><span>                                </span><span class="annot"><span class="annottext">Maybe (TyCon, Type)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917625"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621682917634"><span class="annot"><a href="#local-6989586621682917634"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) DynFlags
-&gt; IOEnv (Env DsGblEnv DsLclEnv) Platform
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mkFExportJSBits"><span class="hs-identifier hs-type">mkFExportJSBits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917634"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917616"><span class="hs-identifier hs-type">ext_name</span></a></span><span>
</span><span id="line-104"></span><span>                     </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682917618"><span class="hs-identifier hs-type">isDyn</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682917614"><span class="hs-identifier hs-type">fn_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917627"><span class="hs-identifier hs-type">fe_arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682917629"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917630"><span class="hs-identifier hs-type">is_IO_res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917617"><span class="hs-identifier hs-type">cconv</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mkFExportJSBits"><span class="hs-identifier hs-type">mkFExportJSBits</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>      </span><span class="hs-comment">-- Just==static, Nothing==dynamic</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- True &lt;=&gt; returns an IO type</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- the argument reps</span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>          </span><span class="hs-comment">-- total size of arguments</span><span>
</span><span id="line-119"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span id="mkFExportJSBits"><span class="annot"><span class="annottext">mkFExportJSBits :: Platform
-&gt; CLabelString
-&gt; Maybe Id
-&gt; [Type]
-&gt; Type
-&gt; Bool
-&gt; CCallConv
-&gt; (CHeader, CStub, String, Arity)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#mkFExportJSBits"><span class="hs-identifier hs-var hs-var">mkFExportJSBits</span></a></span></span><span> </span><span id="local-6989586621682917641"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682917641"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621682917642"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917642"><span class="hs-identifier hs-var">c_nm</span></a></span></span><span> </span><span id="local-6989586621682917643"><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682917643"><span class="hs-identifier hs-var">maybe_target</span></a></span></span><span> </span><span id="local-6989586621682917644"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682917644"><span class="hs-identifier hs-var">arg_htys</span></a></span></span><span> </span><span id="local-6989586621682917645"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917645"><span class="hs-identifier hs-var">res_hty</span></a></span></span><span> </span><span id="local-6989586621682917646"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917646"><span class="hs-identifier hs-var">is_IO_res_ty</span></a></span></span><span> </span><span id="local-6989586621682917647"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917647"><span class="hs-identifier hs-var">_cconv</span></a></span></span><span>
</span><span id="line-121"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CHeader
</span><a href="#local-6989586621682917648"><span class="hs-identifier hs-var">header_bits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621682917649"><span class="hs-identifier hs-var">js_bits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682917650"><span class="hs-identifier hs-var">type_string</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">[Arity] -&gt; Arity
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Arity
</span><a href="GHC.Cmm.Type.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682917654"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682917654"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682917654"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682917655"><span class="hs-identifier hs-var">arg_info</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- all the args</span><span>
</span><span id="line-123"></span><span>         </span><span class="hs-comment">-- NB. the calculation here isn't strictly speaking correct.</span><span>
</span><span id="line-124"></span><span>         </span><span class="hs-comment">-- We have a primitive Haskell type (eg. Int#, Double#), and</span><span>
</span><span id="line-125"></span><span>         </span><span class="hs-comment">-- we want to know the size, when passed on the C stack, of</span><span>
</span><span id="line-126"></span><span>         </span><span class="hs-comment">-- the associated C type (eg. HsInt, HsDouble).  We don't have</span><span>
</span><span id="line-127"></span><span>         </span><span class="hs-comment">-- this information to hand, but we know what GHC's conventions</span><span>
</span><span id="line-128"></span><span>         </span><span class="hs-comment">-- are for passing around the primitive Haskell types, so we</span><span>
</span><span id="line-129"></span><span>         </span><span class="hs-comment">-- use that instead.  I hope the two coincide --SDM</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">-- list the arguments to the JS function</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="#local-6989586621682917655"><span class="hs-identifier hs-type">arg_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- arg name</span><span>
</span><span id="line-134"></span><span>                </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- C type</span><span>
</span><span id="line-135"></span><span>                </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- Haskell type</span><span>
</span><span id="line-136"></span><span>                </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- the CmmType</span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621682917655"><span class="annot"><span class="annottext">arg_info :: [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682917655"><span class="hs-identifier hs-var hs-var">arg_info</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682917656"><span class="annot"><span class="annottext">stg_type :: SDoc
</span><a href="#local-6989586621682917656"><span class="hs-identifier hs-var hs-var">stg_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#showStgType"><span class="hs-identifier hs-var">showStgType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917658"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-138"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
forall {doc} {a} {p}. (IsLine doc, Show a) =&gt; a -&gt; p -&gt; doc
</span><a href="#local-6989586621682917659"><span class="hs-identifier hs-var">arg_cname</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682917660"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917656"><span class="hs-identifier hs-var">stg_type</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>                 </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917656"><span class="hs-identifier hs-var">stg_type</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>                 </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917658"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>                 </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#typeCmmType"><span class="hs-identifier hs-var">typeCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682917641"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.HsToCore.Foreign.Utils.html#getPrimTyOf"><span class="hs-identifier hs-var">getPrimTyOf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917658"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682917658"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917658"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682917660"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682917660"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Arity] -&gt; [(Type, Arity)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682917644"><span class="hs-identifier hs-var">arg_htys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621682917659"><span class="annot"><span class="annottext">arg_cname :: a -&gt; p -&gt; doc
</span><a href="#local-6989586621682917659"><span class="hs-identifier hs-var hs-var">arg_cname</span></a></span></span><span> </span><span id="local-6989586621682917670"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682917670"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682917671"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682917671"><span class="hs-identifier hs-var">_stg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'a'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682917670"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span id="local-6989586621682917650"><span class="annot"><span class="annottext">type_string :: String
</span><a href="#local-6989586621682917650"><span class="hs-identifier hs-var hs-var">type_string</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; Char
</span><a href="GHC.HsToCore.Foreign.Utils.html#primTyDescChar"><span class="hs-identifier hs-var">primTyDescChar</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682917641"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917645"><span class="hs-identifier hs-var">res_hty</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682917675"><span class="hs-identifier hs-var">arg_type_string</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621682917675"><span class="annot"><span class="annottext">arg_type_string :: String
</span><a href="#local-6989586621682917675"><span class="hs-identifier hs-var hs-var">arg_type_string</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; Char
</span><a href="GHC.HsToCore.Foreign.Utils.html#primTyDescChar"><span class="hs-identifier hs-var">primTyDescChar</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682917641"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917676"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682917676"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917676"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682917655"><span class="hs-identifier hs-var">arg_info</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-comment">-- stuff to do with the return type of the JS function</span><span>
</span><span id="line-151"></span><span>  </span><span id="local-6989586621682917677"><span class="annot"><span class="annottext">res_hty_is_unit :: Bool
</span><a href="#local-6989586621682917677"><span class="hs-identifier hs-var hs-var">res_hty_is_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917645"><span class="hs-identifier hs-var">res_hty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span>     </span><span class="hs-comment">-- Look through any newtypes</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621682917680"><span class="annot"><span class="annottext">unboxResType :: SDoc
</span><a href="#local-6989586621682917680"><span class="hs-identifier hs-var hs-var">unboxResType</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917677"><span class="hs-identifier hs-var">res_hty_is_unit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$rts_getUnit&quot;</span></span><span>
</span><span id="line-154"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#unpackHObj"><span class="hs-identifier hs-var">unpackHObj</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917645"><span class="hs-identifier hs-var">res_hty</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621682917648"><span class="annot"><span class="annottext">header_bits :: CHeader
</span><a href="#local-6989586621682917648"><span class="hs-identifier hs-var hs-var">header_bits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CHeader -&gt; (Id -&gt; CHeader) -&gt; Maybe Id -&gt; CHeader
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">CHeader
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CHeader
forall {a}. Uniquable a =&gt; a -&gt; CHeader
</span><a href="#local-6989586621682917683"><span class="hs-identifier hs-var">idTag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682917643"><span class="hs-identifier hs-var">maybe_target</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621682917683"><span class="annot"><span class="annottext">idTag :: a -&gt; CHeader
</span><a href="#local-6989586621682917683"><span class="hs-identifier hs-var hs-var">idTag</span></a></span></span><span> </span><span id="local-6989586621682917689"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682917689"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682917690"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682917690"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917691"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682917691"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; (Char, Word64)
</span><a href="GHC.Types.Unique.html#unpkUnique"><span class="hs-identifier hs-var">unpkUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682917689"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>            </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; CHeader
</span><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-var">CHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682917690"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SDoc
forall doc. IsLine doc =&gt; Word64 -&gt; doc
</span><a href="GHC.Utils.Outputable.html#word64"><span class="hs-identifier hs-var">word64</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682917691"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621682917698"><span class="annot"><span class="annottext">normal_args :: [SDoc]
</span><a href="#local-6989586621682917698"><span class="hs-identifier hs-var hs-var">normal_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SDoc, SDoc, Type, CmmType) -&gt; SDoc)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682917699"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917699"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682917700"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917700"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917699"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682917655"><span class="hs-identifier hs-var">arg_info</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621682917701"><span class="annot"><span class="annottext">all_args :: [SDoc]
</span><a href="#local-6989586621682917701"><span class="hs-identifier hs-var hs-var">all_args</span></a></span></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Id -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682917643"><span class="hs-identifier hs-var">maybe_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;stableptr_offset&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682917698"><span class="hs-identifier hs-var">normal_args</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682917698"><span class="hs-identifier hs-var">normal_args</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621682917703"><span class="annot"><span class="annottext">fun_args :: SDoc
</span><a href="#local-6989586621682917703"><span class="hs-identifier hs-var hs-var">fun_args</span></a></span></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682917655"><span class="hs-identifier hs-var">arg_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-comment">-- text &quot;void&quot;</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682917701"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621682917709"><span class="annot"><span class="annottext">fun_proto :: SDoc
</span><a href="#local-6989586621682917709"><span class="hs-identifier hs-var hs-var">fun_proto</span></a></span></span><span>
</span><span id="line-170"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;function&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe Id -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682917643"><span class="hs-identifier hs-var">maybe_target</span></a></span><span>
</span><span id="line-172"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917642"><span class="hs-identifier hs-var">c_nm</span></a></span><span>
</span><span id="line-173"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917642"><span class="hs-identifier hs-var">c_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917703"><span class="hs-identifier hs-var">fun_args</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621682917713"><span class="annot"><span class="annottext">fun_export :: SDoc
</span><a href="#local-6989586621682917713"><span class="hs-identifier hs-var hs-var">fun_export</span></a></span></span><span>
</span><span id="line-177"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682917643"><span class="hs-identifier hs-var">maybe_target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917714"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917714"><span class="hs-identifier hs-var">hs_fn</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917715"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682917715"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Module
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917714"><span class="hs-identifier hs-var">hs_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$foreignExport&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-180"></span><span>                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-181"></span><span>                          </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917642"><span class="hs-identifier hs-var">c_nm</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-182"></span><span>                          </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="#local-6989586621682917718"><span class="hs-identifier hs-var">strlit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; CLabelString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682917715"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-183"></span><span>                          </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="#local-6989586621682917718"><span class="hs-identifier hs-var">strlit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; CLabelString
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682917715"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-184"></span><span>                          </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="#local-6989586621682917718"><span class="hs-identifier hs-var">strlit</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917642"><span class="hs-identifier hs-var">c_nm</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-185"></span><span>                          </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="#local-6989586621682917718"><span class="hs-identifier hs-var">strlit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682917650"><span class="hs-identifier hs-var">type_string</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>                        </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span>
</span><span id="line-187"></span><span>          </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621682917718"><span class="annot"><span class="annottext">strlit :: CLabelString -&gt; doc
</span><a href="#local-6989586621682917718"><span class="hs-identifier hs-var hs-var">strlit</span></a></span></span><span> </span><span id="local-6989586621682917729"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917729"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; doc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.JS.Ppr.html#pprStringLit"><span class="hs-identifier hs-var">pprStringLit</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917729"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-comment">-- the target which will form the root of what we ask rts_evalIO to run</span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621682917731"><span class="annot"><span class="annottext">the_cfun :: SDoc
</span><a href="#local-6989586621682917731"><span class="hs-identifier hs-var hs-var">the_cfun</span></a></span></span><span>
</span><span id="line-193"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682917643"><span class="hs-identifier hs-var">maybe_target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>          </span><span class="annot"><span class="annottext">Maybe Id
</span><span class="hs-identifier hs-var">Nothing</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$deRefStablePtr(stableptr_offset)&quot;</span></span><span>
</span><span id="line-195"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917732"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917732"><span class="hs-identifier hs-var">hs_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#idClosureText"><span class="hs-identifier hs-var">idClosureText</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917732"><span class="hs-identifier hs-var">hs_fn</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-comment">-- the expression we give to rts_eval</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><a href="#local-6989586621682917734"><span class="hs-identifier hs-type">expr_to_run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621682917734"><span class="annot"><span class="annottext">expr_to_run :: SDoc
</span><a href="#local-6989586621682917734"><span class="hs-identifier hs-var hs-var">expr_to_run</span></a></span></span><span>
</span><span id="line-200"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; (SDoc, SDoc, Type, CmmType) -&gt; SDoc)
-&gt; SDoc -&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; SDoc
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; (SDoc, SDoc, Type, CmmType) -&gt; SDoc
forall {b} {d}. SDoc -&gt; (SDoc, b, Type, d) -&gt; SDoc
</span><a href="#local-6989586621682917736"><span class="hs-identifier hs-var">appArg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917731"><span class="hs-identifier hs-var">the_cfun</span></a></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682917655"><span class="hs-identifier hs-var">arg_info</span></a></span><span>
</span><span id="line-201"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>          </span><span id="local-6989586621682917736"><span class="annot"><span class="annottext">appArg :: SDoc -&gt; (SDoc, b, Type, d) -&gt; SDoc
</span><a href="#local-6989586621682917736"><span class="hs-identifier hs-var hs-var">appArg</span></a></span></span><span> </span><span id="local-6989586621682917745"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917745"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682917746"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917746"><span class="hs-identifier hs-var">arg_cname</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917747"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917747"><span class="hs-identifier hs-var">arg_hty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">d
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$rts_apply&quot;</span></span><span>
</span><span id="line-204"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917745"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#mkHObj"><span class="hs-identifier hs-var">mkHObj</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917747"><span class="hs-identifier hs-var">arg_hty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917746"><span class="hs-identifier hs-var">arg_cname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-comment">-- finally, the whole darn thing</span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621682917649"><span class="annot"><span class="annottext">js_bits :: CStub
</span><a href="#local-6989586621682917649"><span class="hs-identifier hs-var hs-var">js_bits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">getCStub :: SDoc
</span><a href="GHC.Types.ForeignStubs.html#getCStub"><span class="hs-identifier hs-var">getCStub</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917751"><span class="hs-identifier hs-var">js_sdoc</span></a></span><span>
</span><span id="line-208"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getInitializers :: [CLabel]
</span><a href="GHC.Types.ForeignStubs.html#getInitializers"><span class="hs-identifier hs-var">getInitializers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CLabel]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-209"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getFinalizers :: [CLabel]
</span><a href="GHC.Types.ForeignStubs.html#getFinalizers"><span class="hs-identifier hs-var">getFinalizers</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CLabel]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-210"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>       </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682917751"><span class="annot"><span class="annottext">js_sdoc :: SDoc
</span><a href="#local-6989586621682917751"><span class="hs-identifier hs-var hs-var">js_sdoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#space"><span class="hs-identifier hs-var">space</span></a></span><span>
</span><span id="line-212"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917709"><span class="hs-identifier hs-var">fun_proto</span></a></span><span>
</span><span id="line-213"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-214"></span><span>                 </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#lbrace"><span class="hs-identifier hs-var">lbrace</span></a></span><span>
</span><span id="line-215"></span><span>                 </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;return&quot;</span></span><span>
</span><span id="line-216"></span><span>                     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$rts_eval_sync&quot;</span></span><span>
</span><span id="line-217"></span><span>                     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917646"><span class="hs-identifier hs-var">is_IO_res_ty</span></a></span><span>
</span><span id="line-218"></span><span>                                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917734"><span class="hs-identifier hs-var">expr_to_run</span></a></span><span>
</span><span id="line-219"></span><span>                                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$rts_toIO&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917734"><span class="hs-identifier hs-var">expr_to_run</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917680"><span class="hs-identifier hs-var">unboxResType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>                     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span>
</span><span id="line-222"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#rbrace"><span class="hs-identifier hs-var">rbrace</span></a></span><span>
</span><span id="line-223"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-224"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682917713"><span class="hs-identifier hs-var">fun_export</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#idClosureText"><span class="hs-identifier hs-type">idClosureText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-227"></span><span id="idClosureText"><span class="annot"><span class="annottext">idClosureText :: Id -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#idClosureText"><span class="hs-identifier hs-var hs-var">idClosureText</span></a></span></span><span> </span><span id="local-6989586621682917759"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917759"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isExportedId"><span class="hs-identifier hs-var">isExportedId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917759"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917761"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682917761"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917759"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917762"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682917762"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Module
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682917761"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682917763"><span class="annot"><span class="annottext">str :: String
</span><a href="#local-6989586621682917763"><span class="hs-identifier hs-var hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; SDoc
</span><a href="GHC.Types.Name.html#pprFullName"><span class="hs-identifier hs-var">pprFullName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682917762"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="GHC.Types.Name.html#localiseName"><span class="hs-identifier hs-var">localiseName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682917761"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../ghc-boot-9.10.2-inplace/src/GHC.Utils.Encoding.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682917763"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;idClosureText: unknown module&quot;</span></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><span class="hs-comment">-- | Desugaring of JavaScript foreign imports</span></span><span>
</span><span id="line-237"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsImport"><span class="hs-identifier hs-type">dsJsImport</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CImportSpec"><span class="hs-identifier hs-type">CImportSpec</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Safety"><span class="hs-identifier hs-type">Safety</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Foreign.Utils.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span id="dsJsImport"><span class="annot"><span class="annottext">dsJsImport :: Id
-&gt; Coercion
-&gt; CImportSpec
-&gt; CCallConv
-&gt; Safety
-&gt; Maybe Header
-&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsImport"><span class="hs-identifier hs-var hs-var">dsJsImport</span></a></span></span><span> </span><span id="local-6989586621682917770"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917770"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682917771"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917771"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span id="local-6989586621682917773"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917773"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682917774"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917774"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682917775"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682917775"><span class="hs-identifier hs-var hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917771"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-247"></span><span>       </span><span id="local-6989586621682917777"><span class="annot"><span class="annottext">fod :: FunctionOrData
</span><a href="#local-6989586621682917777"><span class="hs-identifier hs-var hs-var hs-var">fod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.Type.html#dropForAlls"><span class="hs-identifier hs-var">dropForAlls</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917775"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-248"></span><span>             </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917780"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917780"><span class="hs-identifier hs-var">tycon</span></a></span></span><span>
</span><span id="line-249"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique
</span><a href="GHC.Core.TyCon.html#tyConUnique"><span class="hs-identifier hs-var">tyConUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917780"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#funPtrTyConKey"><span class="hs-identifier hs-var">funPtrTyConKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-250"></span><span>                 </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span>
</span><span id="line-251"></span><span>             </span><span class="annot"><span class="annottext">Maybe TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span>
</span><span id="line-252"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621682917785"><span class="annot"><a href="#local-6989586621682917785"><span class="hs-identifier hs-var">_resTy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917786"><span class="annot"><a href="#local-6989586621682917786"><span class="hs-identifier hs-var">foRhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917775"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-253"></span><span class="hs-comment">--   ASSERT(fromJust resTy `eqType` addrPrimTy)    -- typechecker ensures this</span><span>
</span><span id="line-254"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682917788"><span class="annot"><a href="#local-6989586621682917788"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682917786"><span class="hs-identifier hs-var">foRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabelString -&gt; Maybe Arity -&gt; FunctionOrData -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-var">LitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917773"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Arity
</span><a href="#local-6989586621682917791"><span class="hs-identifier hs-var">stdcall_info</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="#local-6989586621682917777"><span class="hs-identifier hs-var">fod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>       </span><span id="local-6989586621682917792"><span class="annot"><a href="#local-6989586621682917792"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917788"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917771"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-256"></span><span>       </span><span id="local-6989586621682917791"><span class="annot"><a href="#local-6989586621682917791"><span class="hs-identifier hs-var hs-var">stdcall_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallConv -&gt; Type -&gt; Maybe Arity
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#fun_type_arg_stdcall_info"><span class="hs-identifier hs-var">fun_type_arg_stdcall_info</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917774"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917775"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682917770"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682917792"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsImport"><span class="hs-identifier hs-var">dsJsImport</span></a></span><span> </span><span id="local-6989586621682917795"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917795"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682917796"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917796"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CFunction"><span class="hs-identifier hs-type">CFunction</span></a></span><span> </span><span id="local-6989586621682917798"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682917798"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682917799"><span class="annot"><span class="annottext">cconv :: CCallConv
</span><a href="#local-6989586621682917799"><span class="hs-identifier hs-var">cconv</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#PrimCallConv"><span class="hs-identifier hs-var">PrimCallConv</span></a></span><span> </span><span id="local-6989586621682917801"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682917801"><span class="hs-identifier hs-var">safety</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Coercion -&gt; ForeignCall -&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.Prim.html#dsPrimCall"><span class="hs-identifier hs-var">dsPrimCall</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917795"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917796"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallSpec -&gt; ForeignCall
</span><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-var">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallTarget -&gt; CCallConv -&gt; Safety -&gt; CCallSpec
</span><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-var">CCallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682917798"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917799"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682917801"><span class="hs-identifier hs-var">safety</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsImport"><span class="hs-identifier hs-var">dsJsImport</span></a></span><span> </span><span id="local-6989586621682917805"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917805"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682917806"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917806"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CFunction"><span class="hs-identifier hs-type">CFunction</span></a></span><span> </span><span id="local-6989586621682917807"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682917807"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682917808"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917808"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span id="local-6989586621682917809"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682917809"><span class="hs-identifier hs-var">safety</span></a></span></span><span> </span><span id="local-6989586621682917810"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682917810"><span class="hs-identifier hs-var">mHeader</span></a></span></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; Coercion
-&gt; ForeignCall
-&gt; Maybe Header
-&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsCall"><span class="hs-identifier hs-var">dsJsCall</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917805"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917806"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallSpec -&gt; ForeignCall
</span><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-var">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallTarget -&gt; CCallConv -&gt; Safety -&gt; CCallSpec
</span><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-var">CCallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682917807"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917808"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682917809"><span class="hs-identifier hs-var">safety</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682917810"><span class="hs-identifier hs-var">mHeader</span></a></span><span>
</span><span id="line-264"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsImport"><span class="hs-identifier hs-var">dsJsImport</span></a></span><span> </span><span id="local-6989586621682917812"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917812"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682917813"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917813"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="annottext">CImportSpec
</span><a href="Language.Haskell.Syntax.Decls.html#CWrapper"><span class="hs-identifier hs-var">CWrapper</span></a></span><span> </span><span id="local-6989586621682917815"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917815"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Coercion -&gt; CCallConv -&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExportDynamic"><span class="hs-identifier hs-var">dsJsFExportDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917812"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917813"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917815"><span class="hs-identifier hs-var">cconv</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- fixme work in progress</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- FIXME (Sylvain 2022-03): possibility of code sharing with dsFExportDynamic?</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- Lot of duplication</span><span>
</span><span id="line-270"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExportDynamic"><span class="hs-identifier hs-type">dsJsFExportDynamic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-271"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-272"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-273"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Foreign.Utils.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span id="dsJsFExportDynamic"><span class="annot"><span class="annottext">dsJsFExportDynamic :: Id -&gt; Coercion -&gt; CCallConv -&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExportDynamic"><span class="hs-identifier hs-var hs-var">dsJsFExportDynamic</span></a></span></span><span> </span><span id="local-6989586621682917816"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917816"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682917817"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917817"><span class="hs-identifier hs-var">co0</span></a></span></span><span> </span><span id="local-6989586621682917818"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917818"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-276"></span><span>      </span><span id="local-6989586621682917819"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682917819"><span class="hs-identifier hs-var hs-var hs-var">ty</span></a></span></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917817"><span class="hs-identifier hs-var">co0</span></a></span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682917820"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917820"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682917821"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917821"><span class="hs-identifier hs-var hs-var">sans_foralls</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Id], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVars"><span class="hs-identifier hs-var">tcSplitForAllTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917819"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682917823"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917823"><span class="hs-identifier hs-var hs-var">arg_mult</span></a></span></span><span> </span><span id="local-6989586621682917824"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917824"><span class="hs-identifier hs-var hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917825"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917825"><span class="hs-identifier hs-var hs-var">fn_res_ty</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917821"><span class="hs-identifier hs-var">sans_foralls</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682917826"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917826"><span class="hs-identifier hs-var hs-var">io_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917827"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917827"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe (TyCon, Type) -&gt; (TyCon, Type)
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsJsFExportDynamic: IO type expected&quot;</span></span><span>
</span><span id="line-280"></span><span>                                        </span><span class="hs-comment">-- Must have an IO type; hence Just</span><span>
</span><span id="line-281"></span><span>                                        </span><span class="annot"><span class="annottext">(Maybe (TyCon, Type) -&gt; (TyCon, Type))
-&gt; Maybe (TyCon, Type) -&gt; (TyCon, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917825"><span class="hs-identifier hs-var">fn_res_ty</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621682917829"><span class="annot"><a href="#local-6989586621682917829"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621682917831"><span class="annot"><a href="#local-6989586621682917831"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682917832"><span class="annot"><a href="#local-6989586621682917832"><span class="hs-identifier hs-var hs-var">fe_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; CLabelString) -&gt; String -&gt; CLabelString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../ghc-boot-9.10.2-inplace/src/GHC.Utils.Encoding.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; String
</span><a href="GHC.Unit.Module.html#moduleStableString"><span class="hs-identifier hs-var">moduleStableString</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682917829"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; String
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#toJsName"><span class="hs-identifier hs-var">toJsName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917816"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-comment">-- Construct the label based on the passed id, don't use names</span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-comment">-- depending on Unique. See #13807 and Note [Unique Determinism].</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621682917835"><span class="annot"><a href="#local-6989586621682917835"><span class="hs-identifier hs-var">cback</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917823"><span class="hs-identifier hs-type">arg_mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917824"><span class="hs-identifier hs-type">arg_ty</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621682917837"><span class="annot"><a href="#local-6989586621682917837"><span class="hs-identifier hs-var">newStablePtrId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#newStablePtrName"><span class="hs-identifier hs-type">newStablePtrName</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span id="local-6989586621682917840"><span class="annot"><a href="#local-6989586621682917840"><span class="hs-identifier hs-var">stable_ptr_tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-type">dsLookupTyCon</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#stablePtrTyConName"><span class="hs-identifier hs-type">stablePtrTyConName</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-292"></span><span>        </span><span id="local-6989586621682917843"><span class="annot"><a href="#local-6989586621682917843"><span class="hs-identifier hs-var hs-var">stable_ptr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917840"><span class="hs-identifier hs-var">stable_ptr_tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917824"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621682917845"><span class="annot"><a href="#local-6989586621682917845"><span class="hs-identifier hs-var hs-var">export_ty</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Type
Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-var">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917843"><span class="hs-identifier hs-var">stable_ptr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917824"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621682917847"><span class="annot"><a href="#local-6989586621682917847"><span class="hs-identifier hs-var">bindIOId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#bindIOName"><span class="hs-identifier hs-type">bindIOName</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621682917849"><span class="annot"><a href="#local-6989586621682917849"><span class="hs-identifier hs-var">stbl_value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917843"><span class="hs-identifier hs-type">stable_ptr_ty</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682917851"><span class="annot"><a href="#local-6989586621682917851"><span class="hs-identifier hs-var">h_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917852"><span class="annot"><a href="#local-6989586621682917852"><span class="hs-identifier hs-var">c_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917853"><span class="annot"><a href="#local-6989586621682917853"><span class="hs-identifier hs-var">typestring</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917854"><span class="annot"><a href="#local-6989586621682917854"><span class="hs-identifier hs-var">args_size</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsFExport"><span class="hs-identifier hs-type">dsJsFExport</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917816"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier hs-type">mkRepReflCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917845"><span class="hs-identifier hs-type">export_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682917832"><span class="hs-identifier hs-type">fe_nm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917818"><span class="hs-identifier hs-type">cconv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-298"></span><span>         </span><span class="hs-comment">{-
          The arguments to the external function which will
          create a little bit of (template) code on the fly
          for allowing the (stable pointed) Haskell closure
          to be entered using an external calling convention
          (stdcall, ccall).
         -}</span><span>
</span><span id="line-305"></span><span>        </span><span id="local-6989586621682917856"><span class="annot"><a href="#local-6989586621682917856"><span class="hs-identifier hs-var hs-var">adj_args</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; CoreExpr
forall b. Platform -&gt; Integer -&gt; Expr b
</span><a href="GHC.Core.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682917831"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallConv -&gt; Arity
</span><a href="GHC.Types.ForeignCall.html#ccallConvToInt"><span class="hs-identifier hs-var">ccallConvToInt</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917818"><span class="hs-identifier hs-var">cconv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917849"><span class="hs-identifier hs-var">stbl_value</span></a></span><span>
</span><span id="line-307"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabelString -&gt; Maybe Arity -&gt; FunctionOrData -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-var">LitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682917832"><span class="hs-identifier hs-var">fe_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Arity
</span><a href="#local-6989586621682917860"><span class="hs-identifier hs-var">mb_sz_args</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitString"><span class="hs-identifier hs-var">mkLitString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682917853"><span class="hs-identifier hs-var">typestring</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>          </span><span class="hs-comment">-- name of external entry point providing these services.</span><span>
</span><span id="line-311"></span><span>          </span><span class="hs-comment">-- (probably in the RTS.)</span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621682917862"><span class="annot"><a href="#local-6989586621682917862"><span class="hs-identifier hs-var hs-var">adjustor</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;createAdjustor&quot;</span></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>          </span><span class="hs-comment">-- Determine the number of bytes of arguments to the stub function,</span><span>
</span><span id="line-315"></span><span>          </span><span class="hs-comment">-- so that we can attach the '@N' suffix to its label if it is a</span><span>
</span><span id="line-316"></span><span>          </span><span class="hs-comment">-- stdcall on Windows.</span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621682917860"><span class="annot"><a href="#local-6989586621682917860"><span class="hs-identifier hs-var hs-var">mb_sz_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917818"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>                        </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#StdCallConv"><span class="hs-identifier hs-var">StdCallConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Maybe Arity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682917854"><span class="hs-identifier hs-var">args_size</span></a></span><span>
</span><span id="line-319"></span><span>                        </span><span class="annot"><span class="annottext">CCallConv
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Arity
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621682917865"><span class="annot"><a href="#local-6989586621682917865"><span class="hs-identifier hs-var">ccall_adj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.Call.html#dsCCall"><span class="hs-identifier hs-type">dsCCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917862"><span class="hs-identifier hs-type">adjustor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917856"><span class="hs-identifier hs-type">adj_args</span></a></span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#PlayRisky"><span class="hs-identifier hs-type">PlayRisky</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917826"><span class="hs-identifier hs-type">io_tc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682917827"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-comment">-- PlayRisky: the adjustor doesn't allocate in the Haskell heap or do a callback</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682917868"><span class="annot"><a href="#local-6989586621682917868"><span class="hs-identifier hs-var hs-var">io_app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917820"><span class="hs-identifier hs-var">tvs</span></a></span><span>                  </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-325"></span><span>                 </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917835"><span class="hs-identifier hs-var">cback</span></a></span><span>                   </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-326"></span><span>                 </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917847"><span class="hs-identifier hs-var">bindIOId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917843"><span class="hs-identifier hs-var">stable_ptr_ty</span></a></span><span>
</span><span id="line-328"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917827"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-329"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917837"><span class="hs-identifier hs-var">newStablePtrId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917824"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917835"><span class="hs-identifier hs-var">cback</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-330"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917849"><span class="hs-identifier hs-var">stbl_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917865"><span class="hs-identifier hs-var">ccall_adj</span></a></span><span>
</span><span id="line-331"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621682917873"><span class="annot"><a href="#local-6989586621682917873"><span class="hs-identifier hs-var hs-var">fed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917816"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Activation -&gt; Id
</span><a href="GHC.Types.Id.html#setInlineActivation"><span class="hs-operator hs-var">`setInlineActivation`</span></a></span><span> </span><span class="annot"><span class="annottext">Activation
</span><a href="GHC.Types.Basic.html#NeverActive"><span class="hs-identifier hs-var">NeverActive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917868"><span class="hs-identifier hs-var">io_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917817"><span class="hs-identifier hs-var">co0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>               </span><span class="hs-comment">-- Never inline the f.e.d. function, because the litlit</span><span>
</span><span id="line-335"></span><span>               </span><span class="hs-comment">-- might not be in scope in other modules.</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682917873"><span class="hs-identifier hs-type">fed</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682917851"><span class="hs-identifier hs-type">h_code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682917852"><span class="hs-identifier hs-type">c_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#toJsName"><span class="hs-identifier hs-type">toJsName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-340"></span><span id="toJsName"><span class="annot"><span class="annottext">toJsName :: Id -&gt; String
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#toJsName"><span class="hs-identifier hs-var hs-var">toJsName</span></a></span></span><span> </span><span id="local-6989586621682917876"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917876"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprCode"><span class="hs-identifier hs-var">pprCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917876"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsCall"><span class="hs-identifier hs-type">dsJsCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#ForeignCall"><span class="hs-identifier hs-type">ForeignCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span id="dsJsCall"><span class="annot"><span class="annottext">dsJsCall :: Id
-&gt; Coercion
-&gt; ForeignCall
-&gt; Maybe Header
-&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#dsJsCall"><span class="hs-identifier hs-var hs-var">dsJsCall</span></a></span></span><span> </span><span id="local-6989586621682917881"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917881"><span class="hs-identifier hs-var">fn_id</span></a></span></span><span> </span><span id="local-6989586621682917882"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917882"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-type">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span id="local-6989586621682917883"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682917883"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682917884"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917884"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span id="local-6989586621682917885"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682917885"><span class="hs-identifier hs-var">safety</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682917886"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682917886"><span class="hs-identifier hs-var">_mDeclHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-346"></span><span>        </span><span id="local-6989586621682917887"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682917887"><span class="hs-identifier hs-var hs-var hs-var">ty</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917882"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682917888"><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682917888"><span class="hs-identifier hs-var hs-var">tv_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917889"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917889"><span class="hs-identifier hs-var hs-var">rho</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVarBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinders"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917887"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682917891"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917891"><span class="hs-identifier hs-var hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917892"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917892"><span class="hs-identifier hs-var hs-var">io_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917889"><span class="hs-identifier hs-var">rho</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621682917893"><span class="annot"><a href="#local-6989586621682917893"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; DsM [Id]
</span><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-var">newSysLocalsDs</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917891"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>  </span><span class="hs-comment">-- no FFI levity-polymorphism</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682917895"><span class="annot"><a href="#local-6989586621682917895"><span class="hs-identifier hs-var">val_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917896"><span class="annot"><a href="#local-6989586621682917896"><span class="hs-identifier hs-var">arg_wrappers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapAndUnzipM</span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#unboxJsArg"><span class="hs-identifier hs-type">unboxJsArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917893"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-354"></span><span>        </span><span id="local-6989586621682917899"><span class="annot"><a href="#local-6989586621682917899"><span class="hs-identifier hs-var hs-var">work_arg_ids</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917900"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682917900"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917900"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682917895"><span class="hs-identifier hs-var">val_args</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- All guaranteed to be vars</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682917901"><span class="annot"><a href="#local-6989586621682917901"><span class="hs-identifier hs-var">ccall_result_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917902"><span class="annot"><a href="#local-6989586621682917902"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#boxJsResult"><span class="hs-identifier hs-type">boxJsResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917892"><span class="hs-identifier hs-type">io_res_ty</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621682917904"><span class="annot"><a href="#local-6989586621682917904"><span class="hs-identifier hs-var">ccall_uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621682917906"><span class="annot"><a href="#local-6989586621682917906"><span class="hs-identifier hs-var">work_uniq</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621682917907"><span class="annot"><a href="#local-6989586621682917907"><span class="hs-identifier hs-var">simpl_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.Config.html#initSimpleOpts"><span class="hs-identifier hs-type">initSimpleOpts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-comment">-- Build the worker</span><span>
</span><span id="line-365"></span><span>        </span><span id="local-6989586621682917909"><span class="annot"><a href="#local-6989586621682917909"><span class="hs-identifier hs-var hs-var">fcall</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallSpec -&gt; ForeignCall
</span><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-var">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallTarget -&gt; CCallConv -&gt; Safety -&gt; CCallSpec
</span><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-var">CCallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682917883"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682917884"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682917885"><span class="hs-identifier hs-var">safety</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>        </span><span id="local-6989586621682917910"><span class="annot"><a href="#local-6989586621682917910"><span class="hs-identifier hs-var hs-var">worker_ty</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682917888"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTysMany"><span class="hs-identifier hs-var">mkVisFunTysMany</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; [Id] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917899"><span class="hs-identifier hs-var">work_arg_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917901"><span class="hs-identifier hs-var">ccall_result_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>        </span><span id="local-6989586621682917914"><span class="annot"><a href="#local-6989586621682917914"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVarBinder -&gt; Id) -&gt; [TyVarBinder] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; Id
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682917888"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span id="local-6989586621682917916"><span class="annot"><a href="#local-6989586621682917916"><span class="hs-identifier hs-var hs-var">the_ccall_app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; ForeignCall -&gt; [CoreExpr] -&gt; Type -&gt; CoreExpr
</span><a href="GHC.HsToCore.Foreign.Call.html#mkFCall"><span class="hs-identifier hs-var">mkFCall</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682917904"><span class="hs-identifier hs-var">ccall_uniq</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682917909"><span class="hs-identifier hs-var">fcall</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682917895"><span class="hs-identifier hs-var">val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917901"><span class="hs-identifier hs-var">ccall_result_ty</span></a></span><span>
</span><span id="line-369"></span><span>        </span><span id="local-6989586621682917918"><span class="annot"><a href="#local-6989586621682917918"><span class="hs-identifier hs-var hs-var">work_rhs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917914"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917899"><span class="hs-identifier hs-var">work_arg_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917916"><span class="hs-identifier hs-var">the_ccall_app</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>        </span><span id="local-6989586621682917919"><span class="annot"><a href="#local-6989586621682917919"><span class="hs-identifier hs-var hs-var">work_id</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; Unique -&gt; Type -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$wccall&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682917906"><span class="hs-identifier hs-var">work_uniq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917910"><span class="hs-identifier hs-var">worker_ty</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-comment">-- Build the wrapper</span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621682917921"><span class="annot"><a href="#local-6989586621682917921"><span class="hs-identifier hs-var hs-var">work_app</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; [Id] -&gt; CoreExpr
forall b. Expr b -&gt; [Id] -&gt; Expr b
</span><a href="GHC.Core.html#mkVarApps"><span class="hs-identifier hs-var">mkVarApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917919"><span class="hs-identifier hs-var">work_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917914"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682917895"><span class="hs-identifier hs-var">val_args</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span id="local-6989586621682917923"><span class="annot"><a href="#local-6989586621682917923"><span class="hs-identifier hs-var hs-var">wrapper_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [CoreExpr -&gt; CoreExpr] -&gt; CoreExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">($)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682917902"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917921"><span class="hs-identifier hs-var">work_app</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr]
</span><a href="#local-6989586621682917896"><span class="hs-identifier hs-var">arg_wrappers</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span id="local-6989586621682917925"><span class="annot"><a href="#local-6989586621682917925"><span class="hs-identifier hs-var hs-var">wrap_rhs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917914"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; [Id]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917893"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917923"><span class="hs-identifier hs-var">wrapper_body</span></a></span><span>
</span><span id="line-376"></span><span>        </span><span id="local-6989586621682917926"><span class="annot"><a href="#local-6989586621682917926"><span class="hs-identifier hs-var hs-var">wrap_rhs'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917925"><span class="hs-identifier hs-var">wrap_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917882"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-377"></span><span>        </span><span id="local-6989586621682917927"><span class="annot"><a href="#local-6989586621682917927"><span class="hs-identifier hs-var hs-var">fn_id_w_inl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917881"><span class="hs-identifier hs-var">fn_id</span></a></span><span>
</span><span id="line-378"></span><span>                       </span><span class="annot"><span class="annottext">Id -&gt; Unfolding -&gt; Id
</span><a href="GHC.Types.Id.html#setIdUnfolding"><span class="hs-operator hs-var">`setIdUnfolding`</span></a></span><span>
</span><span id="line-379"></span><span>                       </span><span class="annot"><span class="annottext">SimpleOpts -&gt; UnfoldingSource -&gt; Arity -&gt; CoreExpr -&gt; Unfolding
</span><a href="GHC.Core.Unfold.Make.html#mkInlineUnfoldingWithArity"><span class="hs-identifier hs-var">mkInlineUnfoldingWithArity</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621682917907"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldingSource
</span><a href="GHC.Types.Basic.html#VanillaSrc"><span class="hs-identifier hs-var">VanillaSrc</span></a></span><span>
</span><span id="line-380"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917893"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917926"><span class="hs-identifier hs-var">wrap_rhs'</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682917919"><span class="hs-identifier hs-type">work_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682917918"><span class="hs-identifier hs-type">work_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682917927"><span class="hs-identifier hs-type">fn_id_w_inl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682917926"><span class="hs-identifier hs-type">wrap_rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mkHObj"><span class="hs-identifier hs-type">mkHObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-386"></span><span id="mkHObj"><span class="annot"><span class="annottext">mkHObj :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#mkHObj"><span class="hs-identifier hs-var hs-var">mkHObj</span></a></span></span><span> </span><span id="local-6989586621682917932"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917932"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$rts_mk&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#showFFIType"><span class="hs-identifier hs-var">showFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917932"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#unpackHObj"><span class="hs-identifier hs-type">unpackHObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-389"></span><span id="unpackHObj"><span class="annot"><span class="annottext">unpackHObj :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#unpackHObj"><span class="hs-identifier hs-var hs-var">unpackHObj</span></a></span></span><span> </span><span id="local-6989586621682917934"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917934"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h$rts_get&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#showFFIType"><span class="hs-identifier hs-var">showFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917934"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#showStgType"><span class="hs-identifier hs-type">showStgType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-392"></span><span id="showStgType"><span class="annot"><span class="annottext">showStgType :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#showStgType"><span class="hs-identifier hs-var hs-var">showStgType</span></a></span></span><span> </span><span id="local-6989586621682917935"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917935"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Hs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#showFFIType"><span class="hs-identifier hs-var">showFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917935"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#showFFIType"><span class="hs-identifier hs-type">showFFIType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-395"></span><span id="showFFIType"><span class="annot"><span class="annottext">showFFIType :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#showFFIType"><span class="hs-identifier hs-var hs-var">showFFIType</span></a></span></span><span> </span><span id="local-6989586621682917936"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917936"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; CLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TyCon
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#typeTyCon"><span class="hs-identifier hs-var">typeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917936"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#typeTyCon"><span class="hs-identifier hs-type">typeTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-398"></span><span id="typeTyCon"><span class="annot"><span class="annottext">typeTyCon :: Type -&gt; TyCon
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#typeTyCon"><span class="hs-identifier hs-var hs-var">typeTyCon</span></a></span></span><span> </span><span id="local-6989586621682917940"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917940"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-comment">-- UnaryRep rep_ty &lt;- repType ty</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682917941"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917941"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917940"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- rep_ty</span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917941"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TyCon
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;typeTyCon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917940"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">{-
  We unbox arguments for JS calls a bit different from native code:
    - Bool is marshalled to true/false, not 0/1
    - All int types are narrowed, since JS floats have a greater range than Int32
 -}</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#unboxJsArg"><span class="hs-identifier hs-type">unboxJsArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>                  </span><span class="hs-comment">-- The supplied argument</span><span>
</span><span id="line-413"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>              </span><span class="hs-comment">-- To pass as the actual argument</span><span>
</span><span id="line-414"></span><span>                   </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>   </span><span class="hs-comment">-- Wrapper to unbox the arg</span><span>
</span><span id="line-415"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span id="unboxJsArg"><span class="annot"><span class="annottext">unboxJsArg :: CoreExpr
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreExpr, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#unboxJsArg"><span class="hs-identifier hs-var hs-var">unboxJsArg</span></a></span></span><span> </span><span id="local-6989586621682917945"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-comment">-- Primtive types: nothing to unbox</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isPrimitiveType"><span class="hs-identifier hs-var">isPrimitiveType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr, CoreExpr -&gt; CoreExpr)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreExpr, CoreExpr -&gt; CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682917948"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917948"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917948"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-comment">-- Recursive newtypes</span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682917949"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917949"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917950"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917950"><span class="hs-identifier hs-var">_rep_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Coercion, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier hs-var">topNormaliseNewType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreExpr, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#unboxJsArg"><span class="hs-identifier hs-var">unboxJsArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Coercion -&gt; CoreExpr
CoreExpr -&gt; Coercion -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#mkCast"><span class="hs-identifier hs-var">mkCast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682917949"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-comment">-- Booleans, do not convert to 0/1, only force them</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917953"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917953"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-427"></span><span>    </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917953"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#boolTyConKey"><span class="hs-identifier hs-var">boolTyConKey</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr, CoreExpr -&gt; CoreExpr)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreExpr, CoreExpr -&gt; CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-429"></span><span>              </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682917956"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917956"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Scaled Type -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917956"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917956"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917963"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917963"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917963"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#anyTyConKey"><span class="hs-identifier hs-var">anyTyConKey</span></a></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr, CoreExpr -&gt; CoreExpr)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreExpr, CoreExpr -&gt; CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-434"></span><span>              </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682917965"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917965"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Scaled Type -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917965"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917965"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-comment">-- Data types with a single constructor, which has a single, primitive-typed arg</span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-comment">-- This deals with Int, Float etc; also Ptr, ForeignPtr</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917966"><span class="hs-identifier hs-var">is_product_type</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682917968"><span class="hs-identifier hs-var">data_con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682917969"><span class="annot"><a href="#local-6989586621682917969"><span class="hs-identifier hs-var">case_bndr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-439"></span><span>         </span><span id="local-6989586621682917970"><span class="annot"><a href="#local-6989586621682917970"><span class="hs-identifier hs-var">prim_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917971"><span class="hs-identifier hs-type">data_con_arg_ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917970"><span class="hs-identifier hs-type">prim_arg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-441"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682917972"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917972"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917969"><span class="hs-identifier hs-var">case_bndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917972"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682917975"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917970"><span class="hs-identifier hs-var">prim_arg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917972"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-442"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-comment">-- Byte-arrays, both mutable and otherwise; hack warning</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-comment">-- We're looking for values of type ByteArray, MutableByteArray</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-comment">--    data ByteArray          ix = ByteArray        ix ix ByteArray#</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">--    data MutableByteArray s ix = MutableByteArray ix ix (MutableByteArray# s)</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682917966"><span class="hs-identifier hs-var">is_product_type</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682917968"><span class="hs-identifier hs-var">data_con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-450"></span><span>    </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621682917977"><span class="hs-identifier hs-var">maybe_arg3_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917978"><span class="hs-identifier hs-var">arg3_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>  </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#byteArrayPrimTyCon"><span class="hs-identifier hs-var">byteArrayPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-452"></span><span>     </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917978"><span class="hs-identifier hs-var">arg3_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>  </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#mutableByteArrayPrimTyCon"><span class="hs-identifier hs-var">mutableByteArrayPrimTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682917982"><span class="annot"><a href="#local-6989586621682917982"><span class="hs-identifier hs-var">case_bndr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-454"></span><span>       </span><span id="local-6989586621682917983"><span class="annot"><a href="#local-6989586621682917983"><span class="hs-identifier hs-var">vars</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">[</span><span id="local-6989586621682917984"><span class="annot"><a href="#local-6989586621682917984"><span class="hs-identifier hs-var">_l_var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917985"><span class="annot"><a href="#local-6989586621682917985"><span class="hs-identifier hs-var">_r_var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917986"><span class="annot"><a href="#local-6989586621682917986"><span class="hs-identifier hs-var">arr_cts_var</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-type">newSysLocalsDs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917987"><span class="hs-identifier hs-type">data_con_arg_tys</span></a></span><span>
</span><span id="line-455"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917986"><span class="hs-identifier hs-type">arr_cts_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-456"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682917988"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917988"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682917982"><span class="hs-identifier hs-var">case_bndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917988"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682917975"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682917983"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917988"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682917989"><span class="annot"><a href="#local-6989586621682917989"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM SrcSpan
</span><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-var">getSrcSpanDs</span></a></span><span>
</span><span id="line-461"></span><span>       </span><span class="annot"><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-type">pprPanic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;unboxJsArg: &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917989"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917947"><span class="hs-identifier hs-type">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621682917947"><span class="annot"><span class="annottext">arg_ty :: Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var hs-var">arg_ty</span></a></span></span><span>                                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682917945"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span id="local-6989586621682917991"><span class="annot"><span class="annottext">maybe_product_type :: Maybe (TyCon, [Type], DataCon, [Scaled Type])
</span><a href="#local-6989586621682917991"><span class="hs-identifier hs-var hs-var">maybe_product_type</span></a></span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, [Type], DataCon, [Scaled Type])
</span><a href="GHC.Core.DataCon.html#splitDataProductType_maybe"><span class="hs-identifier hs-var">splitDataProductType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917947"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621682917966"><span class="annot"><span class="annottext">is_product_type :: Bool
</span><a href="#local-6989586621682917966"><span class="hs-identifier hs-var hs-var">is_product_type</span></a></span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type], DataCon, [Scaled Type]) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type], DataCon, [Scaled Type])
</span><a href="#local-6989586621682917991"><span class="hs-identifier hs-var">maybe_product_type</span></a></span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917975"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682917975"><span class="hs-identifier hs-var">data_con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917987"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917987"><span class="hs-identifier hs-var">data_con_arg_tys</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type], DataCon, [Scaled Type])
</span><a href="#local-6989586621682917991"><span class="hs-identifier hs-var">maybe_product_type</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span id="local-6989586621682917968"><span class="annot"><span class="annottext">data_con_arity :: Arity
</span><a href="#local-6989586621682917968"><span class="hs-identifier hs-var hs-var">data_con_arity</span></a></span></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Arity
</span><a href="GHC.Core.DataCon.html#dataConSourceArity"><span class="hs-identifier hs-var">dataConSourceArity</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682917975"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682917971"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682917971"><span class="hs-identifier hs-var">data_con_arg_ty1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917987"><span class="hs-identifier hs-var">data_con_arg_tys</span></a></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682917994"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682917994"><span class="hs-identifier hs-var">data_con_arg_ty3</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682917987"><span class="hs-identifier hs-var">data_con_arg_tys</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621682917977"><span class="annot"><span class="annottext">maybe_arg3_tycon :: Maybe TyCon
</span><a href="#local-6989586621682917977"><span class="hs-identifier hs-var hs-var">maybe_arg3_tycon</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682917994"><span class="hs-identifier hs-var">data_con_arg_ty3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682917978"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917978"><span class="hs-identifier hs-var">arg3_tycon</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621682917977"><span class="hs-identifier hs-var">maybe_arg3_tycon</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="hs-comment">-- Takes the result of the user-level ccall:</span><span>
</span><span id="line-476"></span><span class="hs-comment">--      either (IO t),</span><span>
</span><span id="line-477"></span><span class="hs-comment">--      or maybe just t for an side-effect-free call</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- Returns a wrapper for the primitive ccall itself, along with the</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- type of the result of the primitive ccall.  This result type</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- will be of the form</span><span>
</span><span id="line-481"></span><span class="hs-comment">--      State# RealWorld -&gt; (# State# RealWorld, t' #)</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- where t' is the unwrapped form of t.  If t is simply (), then</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- the result type will be</span><span>
</span><span id="line-484"></span><span class="hs-comment">--      State# RealWorld -&gt; (# State# RealWorld #)</span><span>
</span><span id="line-485"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#boxJsResult"><span class="hs-identifier hs-type">boxJsResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span id="boxJsResult"><span class="annot"><span class="annottext">boxJsResult :: Type -&gt; DsM (Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#boxJsResult"><span class="hs-identifier hs-var hs-var">boxJsResult</span></a></span></span><span> </span><span id="local-6989586621682917995"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917995"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682917996"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917996"><span class="hs-identifier hs-var">io_tycon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682917997"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917997"><span class="hs-identifier hs-var">io_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917995"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-488"></span><span>        </span><span class="hs-comment">-- isIOType_maybe handles the case where the type is a</span><span>
</span><span id="line-489"></span><span>        </span><span class="hs-comment">-- simple wrapping of IO.  E.g.</span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-comment">--      newtype Wrap a = W (IO a)</span><span>
</span><span id="line-491"></span><span>        </span><span class="hs-comment">-- No coercion necessary because its a non-recursive newtype</span><span>
</span><span id="line-492"></span><span>        </span><span class="hs-comment">-- (If we wanted to handle a *recursive* newtype too, we'd need</span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-comment">-- another case, and a coercion.)</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-comment">-- The result is IO t, so wrap the result in an IO constructor</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682917998"><span class="annot"><a href="#local-6989586621682917998"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917997"><span class="hs-identifier hs-var">io_res_ty</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682917999"><span class="annot"><a href="#local-6989586621682917999"><span class="hs-identifier hs-var hs-var">return_result</span></a></span></span><span> </span><span id="local-6989586621682918000"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918000"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621682918001"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918001"><span class="hs-identifier hs-var">ans</span></a></span></span><span>
</span><span id="line-497"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreUnboxedTuple"><span class="hs-identifier hs-var">mkCoreUnboxedTuple</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918000"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918001"><span class="hs-identifier hs-var">ans</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918003"><span class="annot"><a href="#local-6989586621682918003"><span class="hs-identifier hs-var">ccall_res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918004"><span class="annot"><a href="#local-6989586621682918004"><span class="hs-identifier hs-var">the_alt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mk_alt"><span class="hs-identifier hs-type">mk_alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917999"><span class="hs-identifier hs-type">return_result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682917998"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682918006"><span class="annot"><a href="#local-6989586621682918006"><span class="hs-identifier hs-var">state_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-type">realWorldStatePrimTy</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682918008"><span class="annot"><a href="#local-6989586621682918008"><span class="hs-identifier hs-var hs-var">io_data_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; DataCon
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682917996"><span class="hs-identifier hs-var">io_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>              </span><span id="local-6989586621682918011"><span class="annot"><a href="#local-6989586621682918011"><span class="hs-identifier hs-var hs-var">toIOCon</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682918008"><span class="hs-identifier hs-var">io_data_con</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>              </span><span id="local-6989586621682918013"><span class="annot"><a href="#local-6989586621682918013"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621682918014"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918014"><span class="hs-identifier hs-var">the_call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-506"></span><span>                              </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918011"><span class="hs-identifier hs-var">toIOCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>                                     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682917997"><span class="hs-identifier hs-var">io_res_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-508"></span><span>                                       </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918006"><span class="hs-identifier hs-var">state_id</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-509"></span><span>                                       </span><span class="annot"><span class="annottext">CoreExpr -&gt; Scaled Type -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918014"><span class="hs-identifier hs-var">the_call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918006"><span class="hs-identifier hs-var">state_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918003"><span class="hs-identifier hs-var">ccall_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreAlt -&gt; Type
</span><a href="GHC.Core.Utils.html#coreAltType"><span class="hs-identifier hs-var">coreAltType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreAlt
</span><a href="#local-6989586621682918004"><span class="hs-identifier hs-var">the_alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>                                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreAlt
</span><a href="#local-6989586621682918004"><span class="hs-identifier hs-var">the_alt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-513"></span><span>                                     </span><span class="hs-special">]</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-type">realWorldStatePrimTy</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-type">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682918003"><span class="hs-identifier hs-type">ccall_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682918013"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#boxJsResult"><span class="hs-identifier hs-var">boxJsResult</span></a></span><span> </span><span id="local-6989586621682918017"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918017"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- It isn't IO, so do unsafePerformIO</span><span>
</span><span id="line-519"></span><span>       </span><span class="hs-comment">-- It's not conveniently available, so we inline it</span><span>
</span><span id="line-520"></span><span>       </span><span id="local-6989586621682918018"><span class="annot"><a href="#local-6989586621682918018"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918017"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-521"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682918019"><span class="annot"><a href="#local-6989586621682918019"><span class="hs-identifier hs-var">ccall_res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918020"><span class="annot"><a href="#local-6989586621682918020"><span class="hs-identifier hs-var">the_alt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mk_alt"><span class="hs-identifier hs-type">mk_alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682918021"><span class="hs-identifier hs-type">return_result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682918018"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-522"></span><span>       </span><span class="hs-keyword">let</span><span>
</span><span id="line-523"></span><span>           </span><span id="local-6989586621682918022"><span class="annot"><a href="#local-6989586621682918022"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682918023"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918023"><span class="hs-identifier hs-var">the_call</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Scaled Type -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918023"><span class="hs-identifier hs-var">the_call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Types.Id.Make.html#realWorldPrimId"><span class="hs-identifier hs-var">realWorldPrimId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918019"><span class="hs-identifier hs-var">ccall_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreAlt -&gt; Type
</span><a href="GHC.Core.Utils.html#coreAltType"><span class="hs-identifier hs-var">coreAltType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreAlt
</span><a href="#local-6989586621682918020"><span class="hs-identifier hs-var">the_alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>                                           </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreAlt
</span><a href="#local-6989586621682918020"><span class="hs-identifier hs-var">the_alt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-527"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-type">realWorldStatePrimTy</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-type">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682918019"><span class="hs-identifier hs-type">ccall_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682918022"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-529"></span><span>    </span><span id="local-6989586621682918021"><span class="annot"><span class="annottext">return_result :: p -&gt; p -&gt; p
</span><a href="#local-6989586621682918021"><span class="hs-identifier hs-var hs-var">return_result</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682918025"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682918025"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621682918025"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mk_alt"><span class="hs-identifier hs-type">mk_alt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span id="mk_alt"><span class="annot"><span class="annottext">mk_alt :: (CoreExpr -&gt; CoreExpr -&gt; CoreExpr)
-&gt; (Maybe Type, CoreExpr -&gt; CoreExpr) -&gt; DsM (Type, CoreAlt)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#mk_alt"><span class="hs-identifier hs-var hs-var">mk_alt</span></a></span></span><span> </span><span id="local-6989586621682918027"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918027"><span class="hs-identifier hs-var">return_result</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918028"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918028"><span class="hs-identifier hs-var">wrap_result</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- The ccall returns ()</span><span>
</span><span id="line-536"></span><span>       </span><span id="local-6989586621682918029"><span class="annot"><a href="#local-6989586621682918029"><span class="hs-identifier hs-var">state_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-var">realWorldStatePrimTy</span></a></span><span>
</span><span id="line-537"></span><span>       </span><span class="hs-keyword">let</span><span>
</span><span id="line-538"></span><span>             </span><span id="local-6989586621682918030"><span class="annot"><a href="#local-6989586621682918030"><span class="hs-identifier hs-var hs-var">the_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918027"><span class="hs-identifier hs-var">return_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918029"><span class="hs-identifier hs-var">state_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918028"><span class="hs-identifier hs-var">wrap_result</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;jsBoxResult&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>             </span><span id="local-6989586621682918031"><span class="annot"><a href="#local-6989586621682918031"><span class="hs-identifier hs-var hs-var">ccall_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkTupleTy"><span class="hs-identifier hs-var">mkTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-var">realWorldStatePrimTy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-541"></span><span>             </span><span id="local-6989586621682918034"><span class="annot"><a href="#local-6989586621682918034"><span class="hs-identifier hs-var hs-var">the_alt</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Arity -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918029"><span class="hs-identifier hs-var">state_id</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918030"><span class="hs-identifier hs-var">the_rhs</span></a></span><span>
</span><span id="line-542"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682918031"><span class="hs-identifier hs-type">ccall_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682918034"><span class="hs-identifier hs-type">the_alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mk_alt"><span class="hs-identifier hs-var">mk_alt</span></a></span><span> </span><span id="local-6989586621682918036"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918036"><span class="hs-identifier hs-var">return_result</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682918037"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918037"><span class="hs-identifier hs-var">prim_res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918038"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918038"><span class="hs-identifier hs-var">wrap_result</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>                </span><span class="hs-comment">-- The ccall returns a non-() value</span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918037"><span class="hs-identifier hs-var">prim_res_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682918040"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918040"><span class="hs-identifier hs-var hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; [Type]) -&gt; Maybe [Type] -&gt; Maybe [Type]
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#dropRuntimeRepArgs"><span class="hs-identifier hs-var">dropRuntimeRepArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe [Type]
</span><a href="GHC.Core.Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918037"><span class="hs-identifier hs-var">prim_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>        </span><span id="local-6989586621682918043"><span class="annot"><span class="annottext">arity :: Arity
</span><a href="#local-6989586621682918043"><span class="hs-identifier hs-var hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918040"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621682918045"><span class="annot"><a href="#local-6989586621682918045"><span class="hs-identifier hs-var">args_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; DsM Id) -&gt; [Type] -&gt; DsM [Id]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918040"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-551"></span><span>    </span><span id="local-6989586621682918047"><span class="annot"><a href="#local-6989586621682918047"><span class="hs-identifier hs-var">state_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-type">realWorldStatePrimTy</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-553"></span><span>        </span><span id="local-6989586621682918048"><span class="annot"><a href="#local-6989586621682918048"><span class="hs-identifier hs-var hs-var">result_tup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreUnboxedTuple"><span class="hs-identifier hs-var">mkCoreUnboxedTuple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; [Id] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682918045"><span class="hs-identifier hs-var">args_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>        </span><span id="local-6989586621682918049"><span class="annot"><a href="#local-6989586621682918049"><span class="hs-identifier hs-var hs-var">the_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918036"><span class="hs-identifier hs-var">return_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918047"><span class="hs-identifier hs-var">state_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918038"><span class="hs-identifier hs-var">wrap_result</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918048"><span class="hs-identifier hs-var">result_tup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>        </span><span id="local-6989586621682918050"><span class="annot"><a href="#local-6989586621682918050"><span class="hs-identifier hs-var hs-var">ccall_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkTupleTy"><span class="hs-identifier hs-var">mkTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-var">realWorldStatePrimTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918040"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>        </span><span id="local-6989586621682918051"><span class="annot"><a href="#local-6989586621682918051"><span class="hs-identifier hs-var hs-var">the_alt</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Arity -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682918043"><span class="hs-identifier hs-var">arity</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918047"><span class="hs-identifier hs-var">state_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; [Id] -&gt; [Id]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682918045"><span class="hs-identifier hs-var">args_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>                          </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918049"><span class="hs-identifier hs-var">the_rhs</span></a></span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682918050"><span class="hs-identifier hs-type">ccall_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682918051"><span class="hs-identifier hs-type">the_alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-563"></span><span>    </span><span id="local-6989586621682918052"><span class="annot"><a href="#local-6989586621682918052"><span class="hs-identifier hs-var">result_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918037"><span class="hs-identifier hs-var">prim_res_ty</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span id="local-6989586621682918053"><span class="annot"><a href="#local-6989586621682918053"><span class="hs-identifier hs-var">state_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-type">realWorldStatePrimTy</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-566"></span><span>        </span><span id="local-6989586621682918054"><span class="annot"><a href="#local-6989586621682918054"><span class="hs-identifier hs-var hs-var">the_rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918036"><span class="hs-identifier hs-var">return_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918053"><span class="hs-identifier hs-var">state_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918038"><span class="hs-identifier hs-var">wrap_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918052"><span class="hs-identifier hs-var">result_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>        </span><span id="local-6989586621682918055"><span class="annot"><a href="#local-6989586621682918055"><span class="hs-identifier hs-var hs-var">ccall_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkTupleTy"><span class="hs-identifier hs-var">mkTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-var">realWorldStatePrimTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918037"><span class="hs-identifier hs-var">prim_res_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-569"></span><span>        </span><span id="local-6989586621682918056"><span class="annot"><a href="#local-6989586621682918056"><span class="hs-identifier hs-var hs-var">the_alt</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Arity -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918053"><span class="hs-identifier hs-var">state_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918052"><span class="hs-identifier hs-var">result_id</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918054"><span class="hs-identifier hs-var">the_rhs</span></a></span><span>
</span><span id="line-570"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682918055"><span class="hs-identifier hs-type">ccall_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682918056"><span class="hs-identifier hs-type">the_alt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#fun_type_arg_stdcall_info"><span class="hs-identifier hs-type">fun_type_arg_stdcall_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-573"></span><span id="fun_type_arg_stdcall_info"><span class="annot"><span class="annottext">fun_type_arg_stdcall_info :: CCallConv -&gt; Type -&gt; Maybe Arity
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#fun_type_arg_stdcall_info"><span class="hs-identifier hs-var hs-var">fun_type_arg_stdcall_info</span></a></span></span><span> </span><span id="local-6989586621682918057"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682918057"><span class="hs-identifier hs-var">_other_conv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Arity
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-type">jsResultWrapper</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>           </span><span class="hs-comment">-- Type of the expected result, if any</span><span>
</span><span id="line-579"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-comment">-- Wrapper for the result</span><span>
</span><span id="line-580"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span class="hs-comment">-- resultWrapper deals with the result *value*</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- E.g. foreign import foo :: Int -&gt; IO T</span><span>
</span><span id="line-583"></span><span class="hs-comment">-- Then resultWrapper deals with marshalling the 'T' part</span><span>
</span><span id="line-584"></span><span id="jsResultWrapper"><span class="annot"><span class="annottext">jsResultWrapper :: Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var hs-var">jsResultWrapper</span></a></span></span><span> </span><span id="local-6989586621682918058"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-comment">-- Base case 1a: unboxed tuples</span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918059"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918059"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918060"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918060"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918059"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-comment">{- &amp;&amp; False -}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682918063"><span class="annot"><span class="annottext">args' :: [Type]
</span><a href="#local-6989586621682918063"><span class="hs-identifier hs-var hs-var hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#dropRuntimeRepArgs"><span class="hs-identifier hs-var">dropRuntimeRepArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918060"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682918064"><span class="annot"><a href="#local-6989586621682918064"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918065"><span class="annot"><a href="#local-6989586621682918065"><span class="hs-identifier hs-var">wrappers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Maybe Type, CoreExpr -&gt; CoreExpr)]
-&gt; ([Maybe Type], [CoreExpr -&gt; CoreExpr])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(Maybe Type, CoreExpr -&gt; CoreExpr)]
 -&gt; ([Maybe Type], [CoreExpr -&gt; CoreExpr]))
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) [(Maybe Type, CoreExpr -&gt; CoreExpr)]
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) ([Maybe Type], [CoreExpr -&gt; CoreExpr])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr))
-&gt; [Type]
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) [(Maybe Type, CoreExpr -&gt; CoreExpr)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918063"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-590"></span><span>    </span><span id="local-6989586621682918067"><span class="annot"><a href="#local-6989586621682918067"><span class="hs-identifier hs-var">matched</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682918064"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682918068"><span class="annot"><a href="#local-6989586621682918068"><span class="hs-identifier hs-var hs-var">tys'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Type] -&gt; [Type]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Type]
</span><a href="#local-6989586621682918064"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-comment">-- arity   = length args'</span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-comment">-- resCon  = tupleDataCon Unboxed (length args)</span><span>
</span><span id="line-594"></span><span>        </span><span id="local-6989586621682918072"><span class="annot"><a href="#local-6989586621682918072"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;jsResultWrapper: used Id with result type Nothing&quot;</span></span><span>
</span><span id="line-595"></span><span>        </span><span class="annot"><a href="#local-6989586621682918073"><span class="hs-identifier hs-type">resWrap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-596"></span><span>        </span><span id="local-6989586621682918073"><span class="annot"><a href="#local-6989586621682918073"><span class="hs-identifier hs-var hs-var">resWrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreUnboxedTuple"><span class="hs-identifier hs-var">mkCoreUnboxedTuple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; Maybe Id -&gt; CoreExpr)
-&gt; [CoreExpr -&gt; CoreExpr] -&gt; [Maybe Id] -&gt; [CoreExpr]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682918075"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918075"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918075"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr)
-&gt; (Maybe Id -&gt; CoreExpr) -&gt; Maybe Id -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; (Maybe Id -&gt; Id) -&gt; Maybe Id -&gt; CoreExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe Id -&gt; Id
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Id
forall {a}. a
</span><a href="#local-6989586621682918072"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr]
</span><a href="#local-6989586621682918065"><span class="hs-identifier hs-var">wrappers</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Id]
</span><a href="#local-6989586621682918067"><span class="hs-identifier hs-var">matched</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-598"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682918068"><span class="hs-identifier hs-type">tys'</span></a></span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918073"><span class="hs-identifier hs-var">resWrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682918078"><span class="annot"><a href="#local-6989586621682918078"><span class="hs-identifier hs-var hs-var">innerArity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918068"><span class="hs-identifier hs-var">tys'</span></a></span><span>
</span><span id="line-601"></span><span>                 </span><span id="local-6989586621682918079"><span class="annot"><a href="#local-6989586621682918079"><span class="hs-identifier hs-var hs-var">innerTy</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkTupleTy"><span class="hs-identifier hs-var">mkTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918068"><span class="hs-identifier hs-var">tys'</span></a></span><span>
</span><span id="line-602"></span><span>                 </span><span id="local-6989586621682918080"><span class="annot"><a href="#local-6989586621682918080"><span class="hs-identifier hs-var hs-var">innerCon</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Arity -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682918078"><span class="hs-identifier hs-var">innerArity</span></a></span><span>
</span><span id="line-603"></span><span>                 </span><span class="annot"><a href="#local-6989586621682918081"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-604"></span><span>                 </span><span id="local-6989586621682918081"><span class="annot"><a href="#local-6989586621682918081"><span class="hs-identifier hs-var hs-var">inner</span></a></span></span><span> </span><span id="local-6989586621682918082"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918082"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Scaled Type -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918082"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918079"><span class="hs-identifier hs-var">innerTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-605"></span><span>                                         </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682918080"><span class="hs-identifier hs-var">innerCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>                                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe Id] -&gt; [Id]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Id]
</span><a href="#local-6989586621682918067"><span class="hs-identifier hs-var">matched</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>                                              </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918073"><span class="hs-identifier hs-var">resWrap</span></a></span><span>
</span><span id="line-608"></span><span>                                         </span><span class="hs-special">]</span><span>
</span><span id="line-609"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682918079"><span class="hs-identifier hs-type">innerTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682918081"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-comment">-- Base case 1b: primitive types</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isPrimitiveType"><span class="hs-identifier hs-var">isPrimitiveType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Type, CoreExpr -&gt; CoreExpr)
-&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682918083"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918083"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918083"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-comment">-- Base case 1c: boxed tuples</span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-comment">-- fixme: levity args?</span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918084"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918084"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918085"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918085"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isBoxedTupleTyCon"><span class="hs-identifier hs-var">isBoxedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918084"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-618"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682918087"><span class="annot"><span class="annottext">args' :: [Type]
</span><a href="#local-6989586621682918087"><span class="hs-identifier hs-var hs-var hs-var">args'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#dropRuntimeRepArgs"><span class="hs-identifier hs-var">dropRuntimeRepArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918085"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-619"></span><span>          </span><span id="local-6989586621682918088"><span class="annot"><span class="annottext">innerTy :: Type
</span><a href="#local-6989586621682918088"><span class="hs-identifier hs-var hs-var hs-var">innerTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkTupleTy"><span class="hs-identifier hs-var">mkTupleTy</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918087"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-620"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682918089"><span class="annot"><a href="#local-6989586621682918089"><span class="hs-identifier hs-var">inner_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918090"><span class="annot"><a href="#local-6989586621682918090"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918088"><span class="hs-identifier hs-var">innerTy</span></a></span><span>
</span><span id="line-621"></span><span>      </span><span id="local-6989586621682918091"><span class="annot"><a href="#local-6989586621682918091"><span class="hs-identifier hs-var">matched</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-type">ManyTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682918087"><span class="hs-identifier hs-type">args'</span></a></span><span>
</span><span id="line-622"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682918092"><span class="annot"><a href="#local-6989586621682918092"><span class="hs-identifier hs-var hs-var">inner</span></a></span></span><span> </span><span id="local-6989586621682918093"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918093"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Scaled Type -&gt; Type -&gt; [CoreAlt] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918090"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918093"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918088"><span class="hs-identifier hs-var">innerTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-623"></span><span>                               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; CoreAlt
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Arity -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall a. [a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918087"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>                                     </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682918091"><span class="hs-identifier hs-var">matched</span></a></span><span>
</span><span id="line-625"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreTup"><span class="hs-identifier hs-var">mkCoreTup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; [Id] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682918091"><span class="hs-identifier hs-var">matched</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>                                </span><span class="hs-comment">-- mkCoreConApps (tupleDataCon Boxed (length args)) (map Type args ++ map Var matched)</span><span>
</span><span id="line-627"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-628"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682918089"><span class="hs-identifier hs-type">inner_res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682918092"><span class="hs-identifier hs-type">inner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-comment">-- Base case 2: the unit type ()</span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918095"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918095"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><a href="#local-6989586621682918096"><span class="hs-identifier hs-var">maybe_tc_app</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918095"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Types.html#unitTyConKey"><span class="hs-identifier hs-var">unitTyConKey</span></a></span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Type, CoreExpr -&gt; CoreExpr)
-&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.html#unitDataConId"><span class="hs-identifier hs-var">unitDataConId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-comment">-- Base case 3: the boolean type</span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918099"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918099"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><a href="#local-6989586621682918096"><span class="hs-identifier hs-var">maybe_tc_app</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918099"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#boolTyConKey"><span class="hs-identifier hs-var">boolTyConKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-636"></span><span class="hs-comment">--    result_id &lt;- newSysLocalDs boolTy</span><span>
</span><span id="line-637"></span><span>    </span><span id="local-6989586621682918100"><span class="annot"><a href="#local-6989586621682918100"><span class="hs-identifier hs-var">ccall_uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-638"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682918101"><span class="annot"><a href="#local-6989586621682918101"><span class="hs-identifier hs-var hs-var">forceBool</span></a></span></span><span> </span><span id="local-6989586621682918102"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918102"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; CLabelString -&gt; [CoreExpr] -&gt; Type -&gt; CoreExpr
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#mkJsCall"><span class="hs-identifier hs-var">mkJsCall</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682918100"><span class="hs-identifier hs-var">ccall_uniq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;((x) =&gt; { return !(!x); })&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918102"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span>
</span><span id="line-640"></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#intPrimTy"><span class="hs-identifier hs-type">intPrimTy</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682918105"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918105"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918101"><span class="hs-identifier hs-var">forceBool</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918105"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-comment">-- Base case 4: the any type</span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918106"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918106"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><a href="#local-6989586621682918096"><span class="hs-identifier hs-var">maybe_tc_app</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918106"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#anyTyConKey"><span class="hs-identifier hs-var">anyTyConKey</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Type, CoreExpr -&gt; CoreExpr)
-&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682918107"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918107"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918107"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-comment">-- Newtypes</span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918108"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682918108"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918109"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918109"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Coercion, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier hs-var">topNormaliseNewType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918110"><span class="annot"><a href="#local-6989586621682918110"><span class="hs-identifier hs-var">maybe_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918111"><span class="annot"><a href="#local-6989586621682918111"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918109"><span class="hs-identifier hs-var">rep_ty</span></a></span><span>
</span><span id="line-649"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682918110"><span class="hs-identifier hs-type">maybe_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682918112"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918112"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkCastDs"><span class="hs-identifier hs-var">mkCastDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918111"><span class="hs-identifier hs-var">wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918112"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682918108"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span>  </span><span class="hs-comment">-- The type might contain foralls (eg. for dummy type arguments,</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-comment">-- referring to 'Ptr a' is legal).</span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918115"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918115"><span class="hs-identifier hs-var">tyvar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918116"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918116"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Id, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918118"><span class="annot"><a href="#local-6989586621682918118"><span class="hs-identifier hs-var">maybe_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918119"><span class="annot"><a href="#local-6989586621682918119"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918116"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-655"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682918118"><span class="hs-identifier hs-type">maybe_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682918120"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918120"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682918115"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918119"><span class="hs-identifier hs-var">wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918120"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-comment">-- Data types with a single constructor, which has a single arg</span><span>
</span><span id="line-658"></span><span>  </span><span class="hs-comment">-- This includes types like Ptr and ForeignPtr</span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918121"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682918121"><span class="hs-identifier hs-var">_tycon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918122"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918122"><span class="hs-identifier hs-var">tycon_arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918123"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682918123"><span class="hs-identifier hs-var">data_con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918124"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682918124"><span class="hs-identifier hs-var">data_con_arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, [Type], DataCon, [Scaled Type])
</span><a href="GHC.Core.DataCon.html#splitDataProductType_maybe"><span class="hs-identifier hs-var">splitDataProductType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><span class="annottext">DataCon -&gt; Arity
</span><a href="GHC.Core.DataCon.html#dataConSourceArity"><span class="hs-identifier hs-var">dataConSourceArity</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682918123"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682918125"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682918125"><span class="hs-identifier hs-var hs-var">unwrapped_res_ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682918124"><span class="hs-identifier hs-var">data_con_arg_tys</span></a></span><span>
</span><span id="line-662"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682918126"><span class="annot"><a href="#local-6989586621682918126"><span class="hs-identifier hs-var">maybe_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682918127"><span class="annot"><a href="#local-6989586621682918127"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#jsResultWrapper"><span class="hs-identifier hs-var">jsResultWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682918125"><span class="hs-identifier hs-var">unwrapped_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span>
</span><span id="line-664"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682918126"><span class="hs-identifier hs-type">maybe_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682918128"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918128"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682918123"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; CoreExpr) -&gt; [Type] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682918122"><span class="hs-identifier hs-var">tycon_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; [CoreExpr] -&gt; [CoreExpr]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682918127"><span class="hs-identifier hs-var">wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682918128"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;jsResultWrapper&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-670"></span><span>    </span><span id="local-6989586621682918096"><span class="annot"><span class="annottext">maybe_tc_app :: Maybe (TyCon, [Type])
</span><a href="#local-6989586621682918096"><span class="hs-identifier hs-var hs-var">maybe_tc_app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918058"><span class="hs-identifier hs-var">result_ty</span></a></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="hs-comment">-- low-level primitive JavaScript call:</span><span>
</span><span id="line-673"></span><span class="annot"><a href="GHC.HsToCore.Foreign.JavaScript.html#mkJsCall"><span class="hs-identifier hs-type">mkJsCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-674"></span><span id="mkJsCall"><span class="annot"><span class="annottext">mkJsCall :: Unique -&gt; CLabelString -&gt; [CoreExpr] -&gt; Type -&gt; CoreExpr
</span><a href="GHC.HsToCore.Foreign.JavaScript.html#mkJsCall"><span class="hs-identifier hs-var hs-var">mkJsCall</span></a></span></span><span> </span><span id="local-6989586621682918129"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682918129"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682918130"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682918130"><span class="hs-identifier hs-var">tgt</span></a></span></span><span> </span><span id="local-6989586621682918131"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682918131"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682918132"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918132"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; ForeignCall -&gt; [CoreExpr] -&gt; Type -&gt; CoreExpr
</span><a href="GHC.HsToCore.Foreign.Call.html#mkFCall"><span class="hs-identifier hs-var">mkFCall</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682918129"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682918133"><span class="hs-keyword hs-var">ccall</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682918131"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682918132"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621682918133"><span class="annot"><span class="annottext">ccall :: ForeignCall
</span><a href="#local-6989586621682918133"><span class="hs-keyword hs-var hs-var">ccall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallSpec -&gt; ForeignCall
</span><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-var">CCall</span></a></span><span> </span><span class="annot"><span class="annottext">(CCallSpec -&gt; ForeignCall) -&gt; CCallSpec -&gt; ForeignCall
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CCallTarget -&gt; CCallConv -&gt; Safety -&gt; CCallSpec
</span><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-var">CCallSpec</span></a></span><span>
</span><span id="line-677"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceText -&gt; CLabelString -&gt; Maybe Unit -&gt; Bool -&gt; CCallTarget
</span><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-var">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682918130"><span class="hs-identifier hs-var">tgt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unit -&gt; Maybe Unit
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="GHC.Unit.Types.html#primUnit"><span class="hs-identifier hs-var">primUnit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>              </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#JavaScriptCallConv"><span class="hs-identifier hs-var">JavaScriptCallConv</span></a></span><span>
</span><span id="line-679"></span><span>              </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlayRisky"><span class="hs-identifier hs-var">PlayRisky</span></a></span><span>
</span><span id="line-680"></span></pre></body></html>