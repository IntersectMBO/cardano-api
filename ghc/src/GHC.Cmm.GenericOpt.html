<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- (c) The University of Glasgow 1993-2004</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE UnboxedTuples #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html"><span class="hs-identifier">GHC.Cmm.GenericOpt</span></a></span><span>
</span><span id="line-12"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmToCmm"><span class="hs-identifier">cmmToCmm</span></a></span><span>
</span><span id="line-13"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier">head</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html"><span class="hs-identifier">GHC.CmmToAsm.PIC</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html"><span class="hs-identifier">GHC.CmmToAsm.Config</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Types.html"><span class="hs-identifier">GHC.CmmToAsm.Types</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.BlockId.html"><span class="hs-identifier">GHC.Cmm.BlockId</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Block</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Opt.html"><span class="hs-identifier">GHC.Cmm.Opt</span></a></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.Opt.html#cmmMachOpFold"><span class="hs-identifier">cmmMachOpFold</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.1.0-inplace/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- Generic Cmm optimiser</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">{-
Here we do:

  (a) Constant folding
  (c) Position independent code and dynamic linking
        (i)  introduce the appropriate indirections
             and position independent refs
        (ii) compile a list of imported symbols
  (d) Some arch-specific optimizations

(a) will be moving to the new Hoopl pipeline, however, (c) and
(d) are only needed by the native backend and will continue to live
here.

Ideas for other things we could do (put these in Hoopl please!):

  - shortcut jumps-to-jumps
  - simple CSE: if an expr is assigned to a temp, then replace later occs of
    that expr with the temp, until the expr is no longer valid (can push through
    temp assignments, and certain assigns to mem...)
-}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmToCmm"><span class="hs-identifier hs-type">cmmToCmm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span id="cmmToCmm"><span class="annot"><span class="annottext">cmmToCmm :: NCGConfig -&gt; RawCmmDecl -&gt; (RawCmmDecl, [CLabel])
</span><a href="GHC.Cmm.GenericOpt.html#cmmToCmm"><span class="hs-identifier hs-var hs-var">cmmToCmm</span></a></span></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682675782"><span class="annot"><span class="annottext">top :: RawCmmDecl
</span><a href="#local-6989586621682675782"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmData"><span class="hs-identifier hs-type">CmmData</span></a></span><span> </span><span class="annot"><span class="annottext">Section
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RawCmmStatics
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RawCmmDecl
</span><a href="#local-6989586621682675782"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmToCmm"><span class="hs-identifier hs-var">cmmToCmm</span></a></span><span> </span><span id="local-6989586621682675784"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675784"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621682675786"><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621682675786"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682675787"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682675787"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682675788"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621682675788"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span id="local-6989586621682675789"><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682675789"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CmmOptM RawCmmDecl -&gt; (RawCmmDecl, [CLabel])
forall a. NCGConfig -&gt; CmmOptM a -&gt; (a, [CLabel])
</span><a href="GHC.Cmm.GenericOpt.html#runCmmOpt"><span class="hs-identifier hs-var">runCmmOpt</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675784"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmOptM RawCmmDecl -&gt; (RawCmmDecl, [CLabel]))
-&gt; CmmOptM RawCmmDecl -&gt; (RawCmmDecl, [CLabel])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-60"></span><span>      </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675791"><span class="annot"><a href="#local-6989586621682675791"><span class="hs-identifier hs-var">blocks'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CmmBlock -&gt; CmmOptM CmmBlock) -&gt; [CmmBlock] -&gt; CmmOptM [CmmBlock]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CmmBlock -&gt; CmmOptM CmmBlock
</span><a href="GHC.Cmm.GenericOpt.html#cmmBlockConFold"><span class="hs-identifier hs-var">cmmBlockConFold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGraph -&gt; [CmmBlock]
</span><a href="GHC.Cmm.html#toBlockList"><span class="hs-identifier hs-var">toBlockList</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGraph
</span><a href="#local-6989586621682675789"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675786"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675787"><span class="hs-identifier hs-type">lbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675788"><span class="hs-identifier hs-type">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#ofBlockList"><span class="hs-identifier hs-type">ofBlockList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#g_entry"><span class="hs-identifier hs-var">g_entry</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675789"><span class="hs-identifier hs-type">graph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682675791"><span class="hs-identifier hs-type">blocks'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">type</span><span> </span><span id="OptMResult"><span class="annot"><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-var">OptMResult</span></a></span></span><span> </span><span id="local-6989586621682675797"><span class="annot"><a href="#local-6989586621682675797"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><a href="#local-6989586621682675797"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-type">OptMResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682675675"><span id="local-6989586621682675676"><span class="annot"><a href="#local-6989586621682675675"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682675676"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><a href="#local-6989586621682675675"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682675676"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">#)</span></span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">pattern</span><span> </span><span id="OptMResult"><span id="%24mOptMResult"><span id="%24bOptMResult"><span class="annot"><span class="annottext">$mOptMResult :: forall {r} {a} {b}.
(# a, b #) -&gt; (a -&gt; b -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bOptMResult :: forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-var hs-var hs-var">OptMResult</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621682675801"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675802"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682675801"><span class="annot"><a href="#local-6989586621682675801"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682675802"><span class="annot"><a href="#local-6989586621682675802"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-67"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-pragma hs-type">OptMResult</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">newtype</span><span> </span><span id="CmmOptM"><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-var">CmmOptM</span></a></span></span><span> </span><span id="local-6989586621682675698"><span class="annot"><a href="#local-6989586621682675698"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CmmOptM"><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-var">CmmOptM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-type">OptMResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675698"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682675805"><span id="local-6989586621682675807"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; CmmOptM a -&gt; CmmOptM b)
-&gt; (forall a b. a -&gt; CmmOptM b -&gt; CmmOptM a) -&gt; Functor CmmOptM
forall a b. a -&gt; CmmOptM b -&gt; CmmOptM a
forall a b. (a -&gt; b) -&gt; CmmOptM a -&gt; CmmOptM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; CmmOptM a -&gt; CmmOptM b
fmap :: forall a b. (a -&gt; b) -&gt; CmmOptM a -&gt; CmmOptM b
$c&lt;$ :: forall a b. a -&gt; CmmOptM b -&gt; CmmOptM a
&lt;$ :: forall a b. a -&gt; CmmOptM b -&gt; CmmOptM a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682675816"><span id="local-6989586621682675820"><span id="local-6989586621682675823"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621682675826"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; CmmOptM a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621682675827"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682675827"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NCGConfig -&gt; [CLabel] -&gt; OptMResult a) -&gt; CmmOptM a
forall a. (NCGConfig -&gt; [CLabel] -&gt; OptMResult a) -&gt; CmmOptM a
</span><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-var">CmmOptM</span></a></span><span> </span><span class="annot"><span class="annottext">((NCGConfig -&gt; [CLabel] -&gt; OptMResult a) -&gt; CmmOptM a)
-&gt; (NCGConfig -&gt; [CLabel] -&gt; OptMResult a) -&gt; CmmOptM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">NCGConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682675828"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675828"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; [CLabel] -&gt; OptMResult a
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-var">OptMResult</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682675827"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675828"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621682675830"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. CmmOptM (a -&gt; b) -&gt; CmmOptM a -&gt; CmmOptM b
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmOptM (a -&gt; b) -&gt; CmmOptM a -&gt; CmmOptM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682675836"><span id="local-6989586621682675839"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span id="local-6989586621682675842"><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; OptMResult a
</span><a href="#local-6989586621682675842"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682675843"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. CmmOptM a -&gt; (a -&gt; CmmOptM b) -&gt; CmmOptM b
</span><span class="hs-operator hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621682675844"><span class="annot"><span class="annottext">a -&gt; CmmOptM b
</span><a href="#local-6989586621682675844"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="annottext">(NCGConfig -&gt; [CLabel] -&gt; OptMResult b) -&gt; CmmOptM b
forall a. (NCGConfig -&gt; [CLabel] -&gt; OptMResult a) -&gt; CmmOptM a
</span><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-var">CmmOptM</span></a></span><span> </span><span class="annot"><span class="annottext">((NCGConfig -&gt; [CLabel] -&gt; OptMResult b) -&gt; CmmOptM b)
-&gt; (NCGConfig -&gt; [CLabel] -&gt; OptMResult b) -&gt; CmmOptM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682675845"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675845"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682675846"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675846"><span class="hs-identifier hs-var">imports0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; OptMResult a
</span><a href="#local-6989586621682675842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675845"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675846"><span class="hs-identifier hs-var">imports0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-80"></span><span>                  </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-type">OptMResult</span></a></span><span> </span><span id="local-6989586621682675847"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682675847"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682675848"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675848"><span class="hs-identifier hs-var">imports1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; CmmOptM b
</span><a href="#local-6989586621682675844"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682675847"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-82"></span><span>                      </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span id="local-6989586621682675849"><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; OptMResult b
</span><a href="#local-6989586621682675849"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; OptMResult b
</span><a href="#local-6989586621682675849"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675845"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675848"><span class="hs-identifier hs-var">imports1</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#CmmMakeDynamicReferenceM"><span class="hs-identifier hs-type">CmmMakeDynamicReferenceM</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621682675854"><span class="annot"><span class="annottext">addImport :: CLabel -&gt; CmmOptM ()
</span><a href="#local-6989586621682675854"><span class="hs-identifier hs-var hs-var hs-var">addImport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmOptM ()
</span><a href="GHC.Cmm.GenericOpt.html#addImportCmmOpt"><span class="hs-identifier hs-var">addImportCmmOpt</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#addImportCmmOpt"><span class="hs-identifier hs-type">addImportCmmOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span id="addImportCmmOpt"><span class="annot"><span class="annottext">addImportCmmOpt :: CLabel -&gt; CmmOptM ()
</span><a href="GHC.Cmm.GenericOpt.html#addImportCmmOpt"><span class="hs-identifier hs-var hs-var">addImportCmmOpt</span></a></span></span><span> </span><span id="local-6989586621682675857"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682675857"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NCGConfig -&gt; [CLabel] -&gt; OptMResult ()) -&gt; CmmOptM ()
forall a. (NCGConfig -&gt; [CLabel] -&gt; OptMResult a) -&gt; CmmOptM a
</span><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-var">CmmOptM</span></a></span><span> </span><span class="annot"><span class="annottext">((NCGConfig -&gt; [CLabel] -&gt; OptMResult ()) -&gt; CmmOptM ())
-&gt; (NCGConfig -&gt; [CLabel] -&gt; OptMResult ()) -&gt; CmmOptM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">NCGConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682675858"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675858"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; [CLabel] -&gt; OptMResult ()
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-var">OptMResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682675857"><span class="hs-identifier hs-var">lbl</span></a></span><span class="annot"><span class="annottext">CLabel -&gt; [CLabel] -&gt; [CLabel]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675858"><span class="hs-identifier hs-var">imports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#getCmmOptConfig"><span class="hs-identifier hs-type">getCmmOptConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-91"></span><span id="getCmmOptConfig"><span class="annot"><span class="annottext">getCmmOptConfig :: CmmOptM NCGConfig
</span><a href="GHC.Cmm.GenericOpt.html#getCmmOptConfig"><span class="hs-identifier hs-var hs-var">getCmmOptConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NCGConfig -&gt; [CLabel] -&gt; OptMResult NCGConfig)
-&gt; CmmOptM NCGConfig
forall a. (NCGConfig -&gt; [CLabel] -&gt; OptMResult a) -&gt; CmmOptM a
</span><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-var">CmmOptM</span></a></span><span> </span><span class="annot"><span class="annottext">((NCGConfig -&gt; [CLabel] -&gt; OptMResult NCGConfig)
 -&gt; CmmOptM NCGConfig)
-&gt; (NCGConfig -&gt; [CLabel] -&gt; OptMResult NCGConfig)
-&gt; CmmOptM NCGConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682675860"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675860"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621682675861"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675861"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; OptMResult NCGConfig
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-var">OptMResult</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675860"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675861"><span class="hs-identifier hs-var">imports</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span id="local-6989586621682675655"><span class="annot"><a href="GHC.Cmm.GenericOpt.html#runCmmOpt"><span class="hs-identifier hs-type">runCmmOpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675655"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682675655"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-94"></span><span id="runCmmOpt"><span class="annot"><span class="annottext">runCmmOpt :: forall a. NCGConfig -&gt; CmmOptM a -&gt; (a, [CLabel])
</span><a href="GHC.Cmm.GenericOpt.html#runCmmOpt"><span class="hs-identifier hs-var hs-var">runCmmOpt</span></a></span></span><span> </span><span id="local-6989586621682675862"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675862"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span id="local-6989586621682675863"><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; OptMResult a
</span><a href="#local-6989586621682675863"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; [CLabel] -&gt; OptMResult a
</span><a href="#local-6989586621682675863"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675862"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#OptMResult"><span class="hs-identifier hs-type">OptMResult</span></a></span><span> </span><span id="local-6989586621682675864"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682675864"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621682675865"><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675865"><span class="hs-identifier hs-var">imports</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682675864"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CLabel]
</span><a href="#local-6989586621682675865"><span class="hs-identifier hs-var">imports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmBlockConFold"><span class="hs-identifier hs-type">cmmBlockConFold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span>
</span><span id="line-99"></span><span id="cmmBlockConFold"><span class="annot"><span class="annottext">cmmBlockConFold :: CmmBlock -&gt; CmmOptM CmmBlock
</span><a href="GHC.Cmm.GenericOpt.html#cmmBlockConFold"><span class="hs-identifier hs-var hs-var">cmmBlockConFold</span></a></span></span><span> </span><span id="local-6989586621682675866"><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682675866"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682675867"><span class="annot"><span class="annottext">CmmNode 'Closed 'Open
</span><a href="#local-6989586621682675867"><span class="hs-identifier hs-var hs-var">entry</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682675868"><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682675868"><span class="hs-identifier hs-var hs-var">middle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682675869"><span class="annot"><span class="annottext">CmmNode 'Open 'Closed
</span><a href="#local-6989586621682675869"><span class="hs-identifier hs-var hs-var">last</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmBlock
-&gt; (CmmNode 'Closed 'Open, Block CmmNode 'Open 'Open,
    CmmNode 'Open 'Closed)
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n 'Closed 'Closed
-&gt; (n 'Closed 'Open, Block n 'Open 'Open, n 'Open 'Closed)
</span><a href="GHC.Cmm.Dataflow.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmBlock
</span><a href="#local-6989586621682675866"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span id="local-6989586621682675871"><span class="annot"><span class="annottext">stmts :: [CmmNode 'Open 'Open]
</span><a href="#local-6989586621682675871"><span class="hs-identifier hs-var hs-var hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open -&gt; [CmmNode 'Open 'Open]
forall (n :: Extensibility -&gt; Extensibility -&gt; *).
Block n 'Open 'Open -&gt; [n 'Open 'Open]
</span><a href="GHC.Cmm.Dataflow.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a></span><span> </span><span class="annot"><span class="annottext">Block CmmNode 'Open 'Open
</span><a href="#local-6989586621682675868"><span class="hs-identifier hs-var">middle</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621682675873"><span class="annot"><a href="#local-6989586621682675873"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CmmNode 'Open 'Open -&gt; CmmOptM (CmmNode 'Open 'Open))
-&gt; [CmmNode 'Open 'Open] -&gt; CmmOptM [CmmNode 'Open 'Open]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CmmNode 'Open 'Open -&gt; CmmOptM (CmmNode 'Open 'Open)
forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; CmmOptM (CmmNode e x)
</span><a href="GHC.Cmm.GenericOpt.html#cmmStmtConFold"><span class="hs-identifier hs-var">cmmStmtConFold</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmNode 'Open 'Open]
</span><a href="#local-6989586621682675871"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621682675875"><span class="annot"><a href="#local-6989586621682675875"><span class="hs-identifier hs-var">last'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmStmtConFold"><span class="hs-identifier hs-type">cmmStmtConFold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675869"><span class="hs-identifier hs-type">last</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#blockJoin"><span class="hs-identifier hs-type">blockJoin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675867"><span class="hs-identifier hs-type">entry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Dataflow.Block.html#blockFromList"><span class="hs-identifier hs-type">blockFromList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675873"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682675875"><span class="hs-identifier hs-type">last'</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- This does three optimizations, but they're very quick to check, so we don't</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- bother turning them off even when the Hoopl code is active.  Since</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- this is on the old Cmm representation, we can't reuse the code either:</span><span>
</span><span id="line-109"></span><span class="hs-comment">--  * reg = reg      --&gt; nop</span><span>
</span><span id="line-110"></span><span class="hs-comment">--  * if 0 then jump --&gt; nop</span><span>
</span><span id="line-111"></span><span class="hs-comment">--  * if 1 then jump --&gt; jump</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- We might be tempted to skip this step entirely of not Opt_PIC, but</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- there is some PowerPC code for the non-PIC case, which would also</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- have to be separated.</span><span>
</span><span id="line-115"></span><span id="local-6989586621682675716"><span id="local-6989586621682675717"><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmStmtConFold"><span class="hs-identifier hs-type">cmmStmtConFold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675716"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675717"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Node.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675716"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675717"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-116"></span><span id="cmmStmtConFold"><span class="annot"><span class="annottext">cmmStmtConFold :: forall (e :: Extensibility) (x :: Extensibility).
CmmNode e x -&gt; CmmOptM (CmmNode e x)
</span><a href="GHC.Cmm.GenericOpt.html#cmmStmtConFold"><span class="hs-identifier hs-var hs-var">cmmStmtConFold</span></a></span></span><span> </span><span id="local-6989586621682675879"><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682675879"><span class="hs-identifier hs-var">stmt</span></a></span></span><span>
</span><span id="line-117"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682675879"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-type">CmmAssign</span></a></span><span> </span><span id="local-6989586621682675887"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682675887"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621682675888"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675888"><span class="hs-identifier hs-var">src</span></a></span></span><span>
</span><span id="line-119"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675889"><span class="annot"><a href="#local-6989586621682675889"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-var">cmmExprConFold</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675888"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-120"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682675889"><span class="hs-identifier hs-type">src'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-121"></span><span>                   </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span id="local-6989586621682675893"><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682675893"><span class="hs-identifier hs-var">reg'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682675887"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmReg -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682675893"><span class="hs-identifier hs-var">reg'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; CmmNode 'Open 'Open
</span><a href="GHC.Cmm.Node.html#CmmComment"><span class="hs-identifier hs-var">CmmComment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nop&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>                   </span><span id="local-6989586621682675896"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675896"><span class="hs-identifier hs-var">new_src</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr -&gt; CmmNode 'Open 'Open
</span><a href="GHC.Cmm.Node.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="#local-6989586621682675887"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675896"><span class="hs-identifier hs-var">new_src</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span id="local-6989586621682675903"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675903"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682675904"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675904"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621682675905"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682675905"><span class="hs-identifier hs-var">align</span></a></span></span><span>
</span><span id="line-125"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675906"><span class="annot"><a href="#local-6989586621682675906"><span class="hs-identifier hs-var">addr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-var">cmmExprConFold</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675903"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-126"></span><span>                 </span><span id="local-6989586621682675907"><span class="annot"><a href="#local-6989586621682675907"><span class="hs-identifier hs-var">src'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-type">cmmExprConFold</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-type">DataReference</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675904"><span class="hs-identifier hs-type">src</span></a></span><span>
</span><span id="line-127"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmStore"><span class="hs-identifier hs-type">CmmStore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675906"><span class="hs-identifier hs-type">addr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675907"><span class="hs-identifier hs-type">src'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675905"><span class="hs-identifier hs-type">align</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCall"><span class="hs-identifier hs-type">CmmCall</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cml_target :: CmmNode 'Open 'Closed -&gt; CmmExpr
</span><a href="GHC.Cmm.Node.html#cml_target"><span class="hs-identifier hs-var">cml_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682675914"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675914"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-130"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675915"><span class="annot"><a href="#local-6989586621682675915"><span class="hs-identifier hs-var">addr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-var">cmmExprConFold</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#JumpReference"><span class="hs-identifier hs-var">JumpReference</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675914"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-131"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682675879"><span class="hs-identifier hs-type">stmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#cml_target"><span class="hs-identifier hs-var">cml_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682675915"><span class="hs-identifier hs-type">addr'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span> </span><span id="local-6989586621682675928"><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682675928"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621682675929"><span class="annot"><span class="annottext">[CmmFormal]
</span><a href="#local-6989586621682675929"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span id="local-6989586621682675930"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682675930"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-134"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675931"><span class="annot"><a href="#local-6989586621682675931"><span class="hs-identifier hs-var">target'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682675928"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-135"></span><span>                              </span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span> </span><span id="local-6989586621682675933"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675933"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682675934"><span class="annot"><span class="annottext">ForeignConvention
</span><a href="#local-6989586621682675934"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>                                </span><span id="local-6989586621682675935"><span class="annot"><a href="#local-6989586621682675935"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-var">cmmExprConFold</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675933"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-137"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675935"><span class="hs-identifier hs-type">e'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675934"><span class="hs-identifier hs-type">conv</span></a></span><span>
</span><span id="line-138"></span><span>                              </span><span class="annot"><a href="GHC.Cmm.Node.html#PrimTarget"><span class="hs-identifier hs-type">PrimTarget</span></a></span><span> </span><span class="annot"><span class="annottext">CallishMachOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>                                </span><span class="annot"><span class="annottext">ForeignTarget -&gt; CmmOptM ForeignTarget
forall a. a -&gt; CmmOptM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ForeignTarget
</span><a href="#local-6989586621682675928"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-140"></span><span>                 </span><span id="local-6989586621682675938"><span class="annot"><a href="#local-6989586621682675938"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-type">cmmExprConFold</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-type">DataReference</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682675930"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-141"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-type">CmmUnsafeForeignCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675931"><span class="hs-identifier hs-type">target'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675929"><span class="hs-identifier hs-type">regs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675938"><span class="hs-identifier hs-type">args'</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmCondBranch"><span class="hs-identifier hs-type">CmmCondBranch</span></a></span><span> </span><span id="local-6989586621682675947"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675947"><span class="hs-identifier hs-var">test</span></a></span></span><span> </span><span id="local-6989586621682675948"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675948"><span class="hs-identifier hs-var">true</span></a></span></span><span> </span><span id="local-6989586621682675949"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675949"><span class="hs-identifier hs-var">false</span></a></span></span><span> </span><span id="local-6989586621682675950"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682675950"><span class="hs-identifier hs-var">likely</span></a></span></span><span>
</span><span id="line-144"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675951"><span class="annot"><a href="#local-6989586621682675951"><span class="hs-identifier hs-var">test'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-var">cmmExprConFold</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675947"><span class="hs-identifier hs-var">test</span></a></span><span>
</span><span id="line-145"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682675951"><span class="hs-identifier hs-type">test'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-146"></span><span>                   </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CmmNode 'Open 'Closed
</span><a href="GHC.Cmm.Node.html#CmmBranch"><span class="hs-identifier hs-var">CmmBranch</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675949"><span class="hs-identifier hs-var">false</span></a></span><span>
</span><span id="line-147"></span><span>                   </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; CmmNode 'Open 'Closed
</span><a href="GHC.Cmm.Node.html#CmmBranch"><span class="hs-identifier hs-var">CmmBranch</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675948"><span class="hs-identifier hs-var">true</span></a></span><span>
</span><span id="line-148"></span><span>                   </span><span id="local-6989586621682675955"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675955"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmExpr
-&gt; BlockId -&gt; BlockId -&gt; Maybe Bool -&gt; CmmNode 'Open 'Closed
</span><a href="GHC.Cmm.Node.html#CmmCondBranch"><span class="hs-identifier hs-var">CmmCondBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675951"><span class="hs-identifier hs-var">test'</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675948"><span class="hs-identifier hs-var">true</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675949"><span class="hs-identifier hs-var">false</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682675950"><span class="hs-identifier hs-var">likely</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmSwitch"><span class="hs-identifier hs-type">CmmSwitch</span></a></span><span> </span><span id="local-6989586621682675961"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675961"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682675962"><span class="annot"><span class="annottext">SwitchTargets
</span><a href="#local-6989586621682675962"><span class="hs-identifier hs-var">ids</span></a></span></span><span>
</span><span id="line-151"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675963"><span class="annot"><a href="#local-6989586621682675963"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-var">cmmExprConFold</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675961"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-152"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html#CmmSwitch"><span class="hs-identifier hs-type">CmmSwitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675963"><span class="hs-identifier hs-type">expr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675962"><span class="hs-identifier hs-type">ids</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>        </span><span id="local-6989586621682675964"><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682675964"><span class="hs-identifier hs-var">other</span></a></span></span><span>
</span><span id="line-155"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmNode e x -&gt; CmmOptM (CmmNode e x)
forall a. a -&gt; CmmOptM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CmmNode e x
</span><a href="#local-6989586621682675964"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-type">cmmExprConFold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#ReferenceKind"><span class="hs-identifier hs-type">ReferenceKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-158"></span><span id="cmmExprConFold"><span class="annot"><span class="annottext">cmmExprConFold :: ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprConFold"><span class="hs-identifier hs-var hs-var">cmmExprConFold</span></a></span></span><span> </span><span id="local-6989586621682675965"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675965"><span class="hs-identifier hs-var">referenceKind</span></a></span></span><span> </span><span id="local-6989586621682675966"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675966"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621682675967"><span class="annot"><a href="#local-6989586621682675967"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmOptM NCGConfig
</span><a href="GHC.Cmm.GenericOpt.html#getCmmOptConfig"><span class="hs-identifier hs-var">getCmmOptConfig</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682675968"><span class="annot"><a href="#local-6989586621682675968"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgDoConstantFolding"><span class="hs-identifier hs-var">ncgDoConstantFolding</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675967"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675966"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-163"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprCon"><span class="hs-identifier hs-var">cmmExprCon</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675967"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675966"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-type">cmmExprNative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675965"><span class="hs-identifier hs-type">referenceKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675968"><span class="hs-identifier hs-type">expr'</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprCon"><span class="hs-identifier hs-type">cmmExprCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-168"></span><span id="cmmExprCon"><span class="annot"><span class="annottext">cmmExprCon :: NCGConfig -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprCon"><span class="hs-identifier hs-var hs-var">cmmExprCon</span></a></span></span><span> </span><span id="local-6989586621682675973"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675973"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span id="local-6989586621682675975"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675975"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682675976"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682675976"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682675977"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682675977"><span class="hs-identifier hs-var">align</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmType -&gt; AlignmentSpec -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprCon"><span class="hs-identifier hs-var">cmmExprCon</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675973"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675975"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682675976"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682675977"><span class="hs-identifier hs-var">align</span></a></span><span>
</span><span id="line-169"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprCon"><span class="hs-identifier hs-var">cmmExprCon</span></a></span><span> </span><span id="local-6989586621682675978"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675978"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682675980"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682675980"><span class="hs-identifier hs-var">mop</span></a></span></span><span> </span><span id="local-6989586621682675981"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682675981"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; MachOp -&gt; [CmmExpr] -&gt; CmmExpr
</span><a href="GHC.Cmm.Opt.html#cmmMachOpFold"><span class="hs-identifier hs-var">cmmMachOpFold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675978"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682675980"><span class="hs-identifier hs-var">mop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CmmExpr -&gt; CmmExpr) -&gt; [CmmExpr] -&gt; [CmmExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprCon"><span class="hs-identifier hs-var">cmmExprCon</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675978"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682675981"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprCon"><span class="hs-identifier hs-var">cmmExprCon</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682675983"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675983"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675983"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- handles both PIC and non-PIC cases... a very strange mixture</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- of things to do.</span><span>
</span><span id="line-175"></span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-type">cmmExprNative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#ReferenceKind"><span class="hs-identifier hs-type">ReferenceKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.GenericOpt.html#CmmOptM"><span class="hs-identifier hs-type">CmmOptM</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-176"></span><span id="cmmExprNative"><span class="annot"><span class="annottext">cmmExprNative :: ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-var hs-var">cmmExprNative</span></a></span></span><span> </span><span id="local-6989586621682675984"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675984"><span class="hs-identifier hs-var">referenceKind</span></a></span></span><span> </span><span id="local-6989586621682675985"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675985"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-177"></span><span>     </span><span id="local-6989586621682675986"><span class="annot"><a href="#local-6989586621682675986"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmmOptM NCGConfig
</span><a href="GHC.Cmm.GenericOpt.html#getCmmOptConfig"><span class="hs-identifier hs-var">getCmmOptConfig</span></a></span><span>
</span><span id="line-178"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682675987"><span class="annot"><a href="#local-6989586621682675987"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675986"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-179"></span><span>         </span><span id="local-6989586621682675988"><span class="annot"><a href="#local-6989586621682675988"><span class="hs-identifier hs-var hs-var">arch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682675987"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-180"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682675985"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-181"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span id="local-6989586621682675990"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675990"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682675991"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682675991"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span id="local-6989586621682675992"><span class="annot"><span class="annottext">AlignmentSpec
</span><a href="#local-6989586621682675992"><span class="hs-identifier hs-var">align</span></a></span></span><span>
</span><span id="line-182"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675993"><span class="annot"><a href="#local-6989586621682675993"><span class="hs-identifier hs-var">addr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-var">cmmExprNative</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682675990"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-183"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLoad"><span class="hs-identifier hs-type">CmmLoad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675993"><span class="hs-identifier hs-type">addr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675991"><span class="hs-identifier hs-type">rep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675992"><span class="hs-identifier hs-type">align</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span id="local-6989586621682675994"><span class="annot"><span class="annottext">MachOp
</span><a href="#local-6989586621682675994"><span class="hs-identifier hs-var">mop</span></a></span></span><span> </span><span id="local-6989586621682675995"><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682675995"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682675996"><span class="annot"><a href="#local-6989586621682675996"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; CmmOptM CmmExpr) -&gt; [CmmExpr] -&gt; CmmOptM [CmmExpr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-var">cmmExprNative</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CmmExpr]
</span><a href="#local-6989586621682675995"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-187"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-type">CmmMachOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675994"><span class="hs-identifier hs-type">mop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675996"><span class="hs-identifier hs-type">args'</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a></span><span> </span><span id="local-6989586621682675998"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675998"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-var">cmmExprNative</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675984"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockId -&gt; CLabel
</span><a href="GHC.Cmm.BlockId.html#infoTblLbl"><span class="hs-identifier hs-var">infoTblLbl</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621682675998"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>          </span><span class="hs-comment">-- we must convert block Ids to CLabels here, because we</span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-comment">-- might have to do the PIC transformation.  Hence we must</span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-comment">-- not modify BlockIds beyond this point.</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-type">CmmLabel</span></a></span><span> </span><span id="local-6989586621682676001"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682676001"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; ReferenceKind -&gt; CLabel -&gt; CmmOptM CmmExpr
forall (m :: * -&gt; *).
CmmMakeDynamicReferenceM m =&gt;
NCGConfig -&gt; ReferenceKind -&gt; CLabel -&gt; m CmmExpr
</span><a href="GHC.CmmToAsm.PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675986"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675984"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682676001"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-type">CmmLabelOff</span></a></span><span> </span><span id="local-6989586621682676004"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682676004"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621682676005"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682676005"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682676006"><span class="annot"><a href="#local-6989586621682676006"><span class="hs-identifier hs-var">dynRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; ReferenceKind -&gt; CLabel -&gt; CmmOptM CmmExpr
forall (m :: * -&gt; *).
CmmMakeDynamicReferenceM m =&gt;
NCGConfig -&gt; ReferenceKind -&gt; CLabel -&gt; m CmmExpr
</span><a href="GHC.CmmToAsm.PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675986"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675984"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621682676004"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-199"></span><span>                </span><span class="hs-comment">-- need to optimize here, since it's late</span><span>
</span><span id="line-200"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Opt.html#cmmMachOpFold"><span class="hs-identifier hs-type">cmmMachOpFold</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675987"><span class="hs-identifier hs-type">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-type">MO_Add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-type">wordWidth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675987"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-201"></span><span>                    </span><span class="annot"><a href="#local-6989586621682676006"><span class="hs-identifier hs-type">dynRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-202"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmInt"><span class="hs-identifier hs-type">CmmInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="annot"><a href="#local-6989586621682676005"><span class="hs-identifier hs-type">off</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-type">wordWidth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682675987"><span class="hs-identifier hs-type">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-comment">-- On powerpc (non-PIC), it's easier to jump directly to a label than</span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-comment">-- to use the register table, so we replace these registers</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-comment">-- with the corresponding labels:</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-identifier hs-type">GlobalRegUse</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#EagerBlackholeInfo"><span class="hs-identifier hs-var">EagerBlackholeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621682675988"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchPPC</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675986"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-var">cmmExprNative</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675984"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; CmmOptM CmmExpr) -&gt; CmmExpr -&gt; CmmOptM CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-211"></span><span>             </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__stg_EAGER_BLACKHOLE_info&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-identifier hs-type">GlobalRegUse</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#GCEnter1"><span class="hs-identifier hs-var">GCEnter1</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621682675988"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchPPC</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675986"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-var">cmmExprNative</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675984"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; CmmOptM CmmExpr) -&gt; CmmExpr -&gt; CmmOptM CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-215"></span><span>             </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__stg_gc_enter_1&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-type">CmmGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Reg.html#GlobalRegUse"><span class="hs-identifier hs-type">GlobalRegUse</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#GCFun"><span class="hs-identifier hs-var">GCFun</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621682675988"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier hs-var">ArchPPC</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621682675986"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReferenceKind -&gt; CmmExpr -&gt; CmmOptM CmmExpr
</span><a href="GHC.Cmm.GenericOpt.html#cmmExprNative"><span class="hs-identifier hs-var">cmmExprNative</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621682675984"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; CmmOptM CmmExpr) -&gt; CmmExpr -&gt; CmmOptM CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-219"></span><span>             </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FastString -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;__stg_gc_fun&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621682676019"><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682676019"><span class="hs-identifier hs-var">other</span></a></span></span><span>
</span><span id="line-222"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; CmmOptM CmmExpr
forall a. a -&gt; CmmOptM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CmmExpr
</span><a href="#local-6989586621682676019"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-223"></span></pre></body></html>